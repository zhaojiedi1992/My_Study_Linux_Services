

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>My_Study_Linux_Services v0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> My_Study_Linux_Services
          

          
          </a>

          
            
            
              <div class="version">
                v0.1
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><p class="caption"><span class="caption-text">Linux基础服务</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-DHCP/index">1. dhcp服务</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-DHCP/dhcp">1.1. DHCP服务搭建</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-Rsync同步/index">2. Rsync同步</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-Rsync同步/rsync简介">2.1. rsync入门</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-Rsync同步/linux推送到linux">2.2. linux同步到linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-Rsync同步/linux推送到window">2.3. linux推送到window</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-Rsync同步/window推送到linux">2.4. window推送到linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-Rsync同步/window推送到window">2.5. window推送到window</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-自动化安装/index">3. 自动化安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化安装/光盘自动化安装">3.1. 光盘自动化安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化安装/pxe+kickstart自动化安装">3.2. pxe+kickstart自动化安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化安装/cobble自动化安装">3.3. cobble自动化安装</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-自动化运维/index">4. 自动化运维</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化运维/pssh">4.1. pssh</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化运维/pexpect">4.2. pexpect</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化运维/paramiko">4.3. paramiko</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化运维/fabric">4.4. fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化运维/ansible">4.5. ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-自动化运维/saltstack">4.6. saltstack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-安全监控/index">5. 安全监控</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-安全监控/aide">5.1. aide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-远程登陆/index">6. 远程登陆</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-远程登陆/ssh">6.1. ssh</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-远程登陆/telnet">6.2. telnet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-DNS/index">7. DNS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-DNS/bind">7.1. bind</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-DNS/unbound">7.2. unbound</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-DNS/阿里云dns">7.3. 阿里云dns</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-数据库/index">8. 数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-数据库/数据库基础">8.1. 数据库基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-数据库/sql语句">8.2. sql语句</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-数据库/mysql/mysql安装">8.3. mysql安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-数据库/mysql/mysql终端入门">8.4. mysql终端入门</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-数据库/mysql/mysql入门">8.5. mysql入门</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-WEB/index">9. WEB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-WEB/nginx">9.1. nginx</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-版本控制/index">10. 版本控制</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-版本控制/git">10.1. git</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-版本控制/gitlab">10.2. gitlab</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-版本控制/bitbucket">10.3. bitbucket</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">My_Study_Linux_Services</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>My_Study_Linux_Services v0.1 documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="linux">
<h1>Linux服务<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-DHCP/index"></span><div class="section" id="dhcp">
<h2>1. dhcp服务<a class="headerlink" href="#dhcp" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-DHCP/dhcp"></span><div class="section" id="dhcp">
<span id="topics-dhcp"></span><h3>1.1. DHCP服务搭建<a class="headerlink" href="#dhcp" title="Permalink to this headline">¶</a></h3>
<div class="section" id="vmwaredhcp">
<h4>1.1.1. 关闭vmware的dhcp功能<a class="headerlink" href="#vmwaredhcp" title="Permalink to this headline">¶</a></h4>
<p>默认情况下vmware会提供dhcp功能，为了不影响我们后续的自己搭建dhcp功能，建议先关闭vmware的dhcp功能。</p>
<p>关闭vmwaredhcp功能具体步骤: 【菜单栏】-&gt;【编辑】-&gt;【虚拟网络编辑器】-&gt;【更改设置】,如下图：</p>
<img alt="_images/虚拟网络编辑器.png" src="_images/虚拟网络编辑器.png" />
<p>设置虚拟机的网络方式具体步骤： 【虚拟机右键】-&gt;【虚拟机设置】-&gt;【网络适配器】，如下图：</p>
<img alt="_images/仅主机模式.png" src="_images/仅主机模式.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">我这个主机是最小化安装的，环境都没有配置，下面有写环境配置相关的， 自行跳过。</p>
</div>
</div>
<div class="section" id="yumselinux">
<h4>1.1.2. 配置yum源、禁用selinux和防火墙<a class="headerlink" href="#yumselinux" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>1.1.2.1. 查看网络配置<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost network-scripts<span class="o">]</span><span class="c1"># cat ifcfg-eth0</span>
<span class="nv">DEVICE</span><span class="o">=</span>eth0
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="nv">ONBOOT</span><span class="o">=</span>yes
<span class="nv">NM_CONTROLLED</span><span class="o">=</span>no
<span class="nv">BOOTPROTO</span><span class="o">=</span>static
<span class="nv">IPADDR</span><span class="o">=</span><span class="m">192</span>.168.46.6
<span class="nv">PREFIX</span><span class="o">=</span><span class="m">24</span>
<span class="nv">GATEWAY</span><span class="o">=</span><span class="m">192</span>.168.46.1

<span class="o">[</span>root@localhost network-scripts<span class="o">]</span><span class="c1"># cat ifcfg-eth1</span>
<span class="nv">DEVICE</span><span class="o">=</span>eth1
<span class="nv">TYPE</span><span class="o">=</span>Ethernet
<span class="nv">ONBOOT</span><span class="o">=</span>yes
<span class="nv">NM_CONTROLLED</span><span class="o">=</span>no
<span class="nv">BOOTPROTO</span><span class="o">=</span>dhcp
</pre></div>
</div>
</div>
<div class="section" id="yum">
<h5>1.1.2.2. yum 配置<a class="headerlink" href="#yum" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost network-scripts<span class="o">]</span><span class="c1"># cd /etc/yum.repos.d/</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># ls</span>
CentOS-Base.repo  CentOS-Debuginfo.repo  CentOS-fasttrack.repo  CentOS-Media.repo  CentOS-Vault.repo
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># cd</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># cd /etc/yum.repos.d/</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># ls</span>
CentOS-Base.repo  CentOS-Debuginfo.repo  CentOS-fasttrack.repo  CentOS-Media.repo  CentOS-Vault.repo
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># mkdir bak                   # 创建备份目录</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># mv *.repo bak/              # 备份文件</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># ls</span>
bak
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># vim cdrom.repo              # 编辑cdrom.repo</span>
-bash: vim: <span class="nb">command</span> not found
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># vi cdrom.repo               # 编辑cdrom.repo</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># cat cdrom.repo              # 查看cdrom</span>
<span class="o">[</span>base<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>base
<span class="nv">baseurl</span><span class="o">=</span>file:///mnt/cdrom
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
<span class="nv">enable</span><span class="o">=</span><span class="m">1</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># mkdir /mnt/cdrom            # 创建挂载点</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># mount /dev/cdrom  /mnt/cdrom  # 挂载</span>
mount: block device /dev/sr0 is write-protected, mounting read-only
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># yum clean all                 # 清空缓存</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># yum makecache                 # 生成yum缓存</span>
</pre></div>
</div>
</div>
<div class="section" id="selinux">
<h5>1.1.2.3. selinux和防火墙关闭<a class="headerlink" href="#selinux" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># sed -i &#39;s@SELINUX=enforcing@SELINUX=disabled@&#39; /etc/sysconfig/selinux</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># setenforce 0</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># service iptables stop</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># chkconfig iptables off</span>
</pre></div>
</div>
</div>
<div class="section" id="vim">
<h5>1.1.2.4. vim安装<a class="headerlink" href="#vim" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># yum install vim -y            # 安装vim</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4>1.1.3. dhcp的安装<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># yum install dhcp -y           # 安装dhcp</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># rpm -ql dhcp                  # 查看dhcp服务</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>1.1.4. dhcp的配置<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>dhcp的8种报文</p>
<img alt="_images/dhcp报文.png" src="_images/dhcp报文.png" />
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost dhcp<span class="o">]</span><span class="c1"># cd /etc/dhcp                         # 进入dhcp工作目录</span>
<span class="o">[</span>root@localhost dhcp<span class="o">]</span><span class="c1"># cp /usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample dhcpd.conf</span>
<span class="o">[</span>root@localhost dhcp<span class="o">]</span><span class="c1"># vim dhcpd.conf                       # 编辑主配置文件</span>
<span class="o">[</span>root@localhost dhcp<span class="o">]</span><span class="c1"># cat dhcpd.conf                       # 查看dhcp文件</span>
<span class="c1"># dhcpd.conf</span>
<span class="c1">#</span>
<span class="c1"># Sample configuration file for ISC dhcpd</span>
<span class="c1">#</span>

<span class="c1"># option definitions common to all supported networks...</span>
option domain-name <span class="s2">&quot;linuxpanda.tech&quot;</span><span class="p">;</span>
option domain-name-servers ns1.linuxpanda.tech, ns2.linuxpanda.tech<span class="p">;</span>

default-lease-time <span class="m">86400</span><span class="p">;</span>
max-lease-time <span class="m">864000</span><span class="p">;</span>

<span class="c1"># 这个地方配置动态ip范围</span>
subnet <span class="m">192</span>.168.46.0 netmask <span class="m">255</span>.255.255.0 <span class="o">{</span>
range dynamic-bootp <span class="m">192</span>.168.46.100 <span class="m">192</span>.168.46.200 <span class="p">;</span>
option routers <span class="m">192</span>.168.46.6 <span class="p">;</span>
<span class="o">}</span>

<span class="c1"># 这个地方配置静态的ip</span>
host boss <span class="o">{</span>
hardware ethernet <span class="m">08</span>:00:07:26:c0:a5<span class="p">;</span>
fixed-address <span class="m">192</span>.168.46.2 <span class="p">;</span>
<span class="o">}</span>

<span class="o">[</span>root@localhost dhcp<span class="o">]</span><span class="c1"># service dhcpd restart</span>
Shutting down dhcpd:                                       <span class="o">[</span>  OK  <span class="o">]</span>
Starting dhcpd:                                            <span class="o">[</span>  OK  <span class="o">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果dhcpd启动失败，可以从/var/log/message文件的后30行获取帮助信息。</p>
</div>
</div>
<div class="section" id="id4">
<h4>1.1.5. dhcp的测试<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>在另外一个虚拟机里面测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># dhclient -d                                         # 前台执行dhcp命令</span>
Internet Systems Consortium DHCP Client <span class="m">4</span>.2.5
Copyright <span class="m">2004</span>-2013 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/

Listening on LPF/ens37/00:0c:29:ad:b0:fc
Sending on   LPF/ens37/00:0c:29:ad:b0:fc
Listening on LPF/ens33/00:0c:29:ad:b0:f2
Sending on   LPF/ens33/00:0c:29:ad:b0:f2
Sending on   Socket/fallback
DHCPDISCOVER on ens37 to <span class="m">255</span>.255.255.255 port <span class="m">67</span> interval <span class="m">7</span> <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x5b54a061<span class="o">)</span>
DHCPDISCOVER on ens33 to <span class="m">255</span>.255.255.255 port <span class="m">67</span> interval <span class="m">8</span> <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x3d839dcc<span class="o">)</span>
DHCPDISCOVER on ens37 to <span class="m">255</span>.255.255.255 port <span class="m">67</span> interval <span class="m">18</span> <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x5b54a061<span class="o">)</span>
DHCPREQUEST on ens37 to <span class="m">255</span>.255.255.255 port <span class="m">67</span> <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x5b54a061<span class="o">)</span>
DHCPOFFER from <span class="m">172</span>.18.0.1
DHCPACK from <span class="m">172</span>.18.0.1 <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x5b54a061<span class="o">)</span>
bound to <span class="m">172</span>.18.102.149 -- renewal in <span class="m">43001</span> seconds.
DHCPDISCOVER on ens33 to <span class="m">255</span>.255.255.255 port <span class="m">67</span> interval <span class="m">15</span> <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x3d839dcc<span class="o">)</span>
DHCPREQUEST on ens33 to <span class="m">255</span>.255.255.255 port <span class="m">67</span> <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x3d839dcc<span class="o">)</span>
DHCPOFFER from <span class="m">192</span>.168.46.6
DHCPACK from <span class="m">192</span>.168.46.6 <span class="o">(</span><span class="nv">xid</span><span class="o">=</span>0x3d839dcc<span class="o">)</span>
bound to <span class="m">192</span>.168.46.100 -- renewal in <span class="m">40804</span> seconds.
</pre></div>
</div>
<p>从上面的测试中，我们可以看出来ens33这个hostonly网卡的ip绑定了192.168.46.100这个ip,是我们dhcp服务器range的第一个ip。</p>
</div>
<div class="section" id="dhcpd">
<h4>1.1.6. dhcpd的详细参数<a class="headerlink" href="#dhcpd" title="Permalink to this headline">¶</a></h4>
<p>关于dhcpd的详细配置，我们可以使用”man dhcpd.conf”命令快速获取帮助，我这里简单介绍下常用参数</p>
</div>
<div class="section" id="id5">
<h4>1.1.7. dhcp的主要文件<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># rpm -ql dhcp                                # 查看dhcp server的主要文件</span>
/etc/dhcp                                                       <span class="c1"># dhcp主配置目录</span>
/etc/dhcp/dhcpd.conf                                            <span class="c1"># dhcpd的主配置文件</span>
/etc/rc.d/init.d/dhcpd                                          <span class="c1"># dhcpd的init文件</span>
/usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample                     <span class="c1"># dhcp的样例配置文件</span>
/var/lib/dhcpd/dhcpd.leases                                     <span class="c1"># dhcp分配的ip记录信息文件</span>

<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># rpm -ql dhclient                            # dhcp客户端的主要文件</span>
/sbin/dhclient                                                  <span class="c1"># dhcp客户端软件</span>
/var/lib/dhclient                                               <span class="c1"># dhcp获取的ip记录信息文件</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-Rsync同步/index"></span><div class="section" id="rsync">
<h2>2. Rsync同步<a class="headerlink" href="#rsync" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-Rsync同步/rsync简介"></span><div class="section" id="rsync">
<span id="topics-rsync"></span><h3>2.1. rsync入门<a class="headerlink" href="#rsync" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>2.1.1. rsync简介<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Rsync是一个很棒的小工具，在你的机器上很容易设置。而不是有一个脚本的FTP会话，或其他形式的文件传输脚本  rsync只复制文件的差异，实际上差异就是已经改变的文件，如果你想要的安全可以通过ssh。但它的意思是：</p>
<ul class="simple">
<li>区别 - 只传输实际更改的文件，而不是整个文件。这使得更新速度更快，尤其是在像调制解调器这样的慢速链路上。即使只更改了一个字节，FTP也会传输整个文件。</li>
<li>压缩 - 差异的细小部分随即进行压缩，进一步节省文件传输时间并减少网络负载。</li>
<li>安全外壳 - 你的安全意识就是这样，你应该都使用它。来自rsync的流通过ssh协议来加密会话，而不是rsh，这也是一个选项。</li>
</ul>
<p>作为备份/镜像工具，rsync是相当通用的，提供了超出上述的许多功能。以下是一些rsync的其他主要功能：</p>
<ul class="simple">
<li>支持复制链接，设备，所有者，组和权限</li>
<li>排除和排除类似于GNU tar的选项</li>
<li>CVS排除模式，用于忽略CVS将忽略的相同文件</li>
<li>不需要root权限</li>
<li>管理文件传输以最小化延迟成本</li>
<li>支持匿名或认证的rsync服务器(理想的镜像)</li>
</ul>
</div>
<div class="section" id="id2">
<h4>2.1.2. rsync是如何工作的<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>rsync是cs架构的，也就是必须有客户端和服务端的，您必须通过以守护进程模式运行rsync(命令行中的”rsync –daemon”)并设置一个简短易用的配置文件（/etc/rsyncd.conf）来将一台或另一台机器设置为”rsync服务器” ）。</p>
<p>任何安装了rsync的机器都可以与运行rsync守护进程的机器同步。您可以使用它来进行备份，镜像文件系统，分发文件或任意数量的类似操作。通过使用只传输文件之间的差异（类似于补丁文件）的”rsync算法”，然后压缩它们 - 您将得到一个非常高效的系统。</p>
</div>
<div class="section" id="rsyncd">
<h4>2.1.3. rsyncd的主要参数设置<a class="headerlink" href="#rsyncd" title="Permalink to this headline">¶</a></h4>
<p>我们使用一天服务器指定为rsync的服务器，需要运行rsync指定–daemon以守护进程运行并且需要给它提供一个配置文件，这个配置就是、/etc/rsyncd.conf文件。</p>
<p>主要的全局的参数</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>motd file                # 这个是欢迎提示信息，指定的是文件名，把内容写到这个文件里面
pid file                 # 守护进程的运行pid文件
port                     # 运行端口，默认是873
address                  # 默认是监听在所有ip上的，有时候我们只需要监听在内部ip上就需要改变这个值
</pre></div>
</div>
<p>主要的模块参数</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>comment              # 注释信息
path                 # 需要同步的路径，这个参数必须指定的。
use chroot           # 如果为true，rsync守护进程将在与客户端开始文件传输的时候切换到指定路径运行，提供更高的安全性。
charset              # 存储文件名的字符集
max connections      # 指定最大连接数
log file             # 日志文件路径
syslog facility      # 运行你指定系统日志工具名称的，默认是daemon,你可以设置其他值，比如auth, authpriv, cron, daemon, ftp,
                        kern, lpr, mail, news, security, syslog, user, uucp, local0-7.
max verbosity        # 这个参数是控制日志级别的，数值范围1-4，默认1，越大日志信息越丰富。同步文件夹大的时候，建议设置默认值1，避免日志文件过大。
lock file            # 锁文件，默认是/var/run/rsyncd.lock.
read only            # 这个是只读的，默认都是只读的。
write only           # 这个参数控制客户端是否可以下载的，默认是可以下载的，不建议修改。
list                 # 此参数确定当客户要求提供可用模块列表时，是否列出此模块
uid                  # 守护进程以那个用户身份运行
gid                  # 守护进程以那个用户组运行
exclude              # 该参数采用空格分隔的守护进程排除模式列表
include              # 该参数采用空格分隔的守护进程包含模式列表
exclude from         # 类似exclude，不过需要写到文件里面，每行一个，这个参数写文件名
include from         # 类似include，不过需要写到文件里面，每行一个，这个参数写文件名
incoming chmod       # 对进入文件chmod修改权限的
outgoing chmod       # 对出去的文件chmod修改权限的。
auth users           # 认证的用户
secrets file         # 密码文件，配合auth users使用，格式为&quot;username:password&quot; 或者 &quot;@groupname:password&quot;
strict modes         # 是否检查密码文件的权限，默认值true,适应windows操作系统运行rsync
hosts allow          # 运行的主机，格式直接也是比较多的。常用格式如下
                        192.168.2.2
                        192.168.2.2/24
                        192.168.2.2/255.255.255.0
                        主机名
hosts deny           # 不允许的主机
ignore errors        # 忽略i/o错误
ignore nonoreadable  # 这告诉rsync守护程序完全忽略用户不可读的文件
transfer logging     # 这个参数使得每个文件的日志记录下载和上传的格式有点类似于ftp守护进程所使用的格式
log format           # 日志格式的，特别多，参考https://rsync.samba.org/ftp/rsync/rsyncd.conf.html
timeout              # 此参数允许您覆盖客户端选择此模块的I / O超时。 使用这个参数你可以确保rsync不会永远等待死客户端，默认600s
dont compress        # 不压缩
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>2.1.4. 样例的配置文件<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">uid</span> <span class="o">=</span> root
<span class="nv">gid</span> <span class="o">=</span> root
use <span class="nv">chroot</span> <span class="o">=</span> yes
max <span class="nv">connections</span> <span class="o">=</span> <span class="m">4</span>
syslog <span class="nv">facility</span> <span class="o">=</span> local5
pid <span class="nv">file</span> <span class="o">=</span> /var/run/rsyncd.pid

<span class="o">[</span>ftp<span class="o">]</span>
        <span class="nv">path</span> <span class="o">=</span> /var/ftp/pub
        <span class="nv">comment</span> <span class="o">=</span> whole ftp area <span class="o">(</span>approx <span class="m">6</span>.1 GB<span class="o">)</span>

<span class="o">[</span>sambaftp<span class="o">]</span>
        <span class="nv">path</span> <span class="o">=</span> /var/ftp/./pub/samba
        <span class="nv">comment</span> <span class="o">=</span> Samba ftp area <span class="o">(</span>approx <span class="m">300</span> MB<span class="o">)</span>

<span class="o">[</span>rsyncftp<span class="o">]</span>
        <span class="nv">path</span> <span class="o">=</span> /var/ftp/./pub/rsync
        <span class="nv">comment</span> <span class="o">=</span> rsync ftp area <span class="o">(</span>approx <span class="m">6</span> MB<span class="o">)</span>

<span class="o">[</span>sambawww<span class="o">]</span>
        <span class="nv">path</span> <span class="o">=</span> /public_html/samba
        <span class="nv">comment</span> <span class="o">=</span> Samba WWW pages <span class="o">(</span>approx <span class="m">240</span> MB<span class="o">)</span>

<span class="o">[</span>cvs<span class="o">]</span>
        <span class="nv">path</span> <span class="o">=</span> /data/cvs
        <span class="nv">comment</span> <span class="o">=</span> CVS repository <span class="o">(</span>requires authentication<span class="o">)</span>
        auth <span class="nv">users</span> <span class="o">=</span> tridge, susan
        secrets <span class="nv">file</span> <span class="o">=</span> /etc/rsyncd.secrets
</pre></div>
</div>
<p>密码文件样例：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>tridge:mypass
susan:herpass
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">密码文件格式为username:password,且这个用户不必要在系统存在，密码文件权限为600。</p>
</div>
</div>
</div>
<span id="document-Rsync同步/linux推送到linux"></span><div class="section" id="linuxlinux">
<h3>2.2. linux同步到linux<a class="headerlink" href="#linuxlinux" title="Permalink to this headline">¶</a></h3>
<p>linux同步到linux这个情况相对其他情况是最简单的。</p>
<div class="section" id="id1">
<h4>2.2.1. 环境介绍<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>2个机器</li>
<li>centos7(172.18.46.7),centos6(172.18.46.6)</li>
<li>centos7(/app/web)===&gt;centos6(/app/web)</li>
</ul>
<p>我们要完成的功能是centos7开发人员生成的web数据放到centos7的/app/web目录后，centos6能自动拉取centos7的目录保持一致。</p>
<p>rsync我们知道是分客户端和服务端的，那具体对于上面的情况可以怎么安排呢？</p>
<p>方案1： 我们在centos7上搭建服务端，centos6作为客户端，然后centos6去主动拉取centos7的数据。</p>
<p>方案2： 我们在centos6上搭建服务端，centos7作为客户端，然后centos7主动把自己的文件推送到centos6上去。</p>
<p>我们下面的文章主要按照方案2来实施。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">不管如何，拉取和推送都是在客户端完成的。</p>
</div>
</div>
<div class="section" id="id2">
<h4>2.2.2. 服务端的配置<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="section" id="rsync">
<h5>2.2.2.1. 安装rsync软件<a class="headerlink" href="#rsync" title="Permalink to this headline">¶</a></h5>
<p>查看是否安装</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ rpm -ql rsync
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ yum -y install rsync

<span class="o">[</span>root@centos69 ~<span class="o">]</span>$ rpm -ql rsync
<span class="o">[</span>root@centos69 ~<span class="o">]</span>$ yum -y install rsync
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>2.2.2.2. 启用rsync<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p>在centos7上启用rsyncd(服务端进程)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ systemctl status rsyncd
● rsyncd.service - fast remote file copy program daemon
Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/rsyncd.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
Active: inactive <span class="o">(</span>dead<span class="o">)</span>
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ systemctl <span class="nb">enable</span> rsyncd
Created symlink from /etc/systemd/system/multi-user.target.wants/rsyncd.service to /usr/lib/systemd/system/rsyncd.service.
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ systemctl start rsyncd
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ systemctl status rsyncd
● rsyncd.service - fast remote file copy program daemon
Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/rsyncd.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
Active: active <span class="o">(</span>running<span class="o">)</span> since Sun <span class="m">2018</span>-01-07 <span class="m">19</span>:04:02 CST<span class="p">;</span> 6s ago
Main PID: <span class="m">38913</span> <span class="o">(</span>rsync<span class="o">)</span>
CGroup: /system.slice/rsyncd.service
        └─38913 /usr/bin/rsync --daemon --no-detach
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ netstat -tunlp  <span class="p">|</span>grep <span class="m">873</span>
tcp        <span class="m">0</span>      <span class="m">0</span> <span class="m">0</span>.0.0.0:873             <span class="m">0</span>.0.0.0:*               LISTEN      <span class="m">38913</span>/rsync
tcp6       <span class="m">0</span>      <span class="m">0</span> :::873                  :::*                    LISTEN      <span class="m">38913</span>/rsync
</pre></div>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">rsyncd服务监听在873端口，如果有防火墙请放行或者关闭。</p>
</div>
</div>
<div class="section" id="rsyncd">
<h5>2.2.2.3. 编辑rsyncd的配置文件<a class="headerlink" href="#rsyncd" title="Permalink to this headline">¶</a></h5>
<p>编辑rsyncd的配置文件(可能没有)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ vim /etc/rsyncd.conf
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ cat /etc/rsyncd.conf
<span class="nv">uid</span> <span class="o">=</span> root
<span class="nv">gid</span> <span class="o">=</span> root
user <span class="nv">chroot</span> <span class="o">=</span> no
max <span class="nv">connections</span> <span class="o">=</span> <span class="m">200</span>
<span class="nv">timeout</span> <span class="o">=</span> <span class="m">600</span>
pid <span class="nv">file</span> <span class="o">=</span> /var/run/rsyncd.pid
lock <span class="nv">file</span> <span class="o">=</span> /var/run/rsyncd.lock
log <span class="nv">file</span> <span class="o">=</span> /var/run/rsyncd.log

<span class="o">[</span>web<span class="o">]</span>
<span class="nv">path</span> <span class="o">=</span> /app/web/
ignore errors
<span class="nb">read</span> <span class="nv">only</span> <span class="o">=</span> no
<span class="nv">list</span> <span class="o">=</span> no
hosts <span class="nv">allow</span> <span class="o">=</span> <span class="m">172</span>.18.0.0/16
auth <span class="nv">users</span> <span class="o">=</span> web
secrets <span class="nv">file</span> <span class="o">=</span> /etc/rsyncd.pass
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>2.2.2.4. 创建服务器密码文件<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>密码文件的格式是：username:password</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ <span class="o">(</span><span class="nb">umask</span> <span class="m">266</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;web:web&quot;</span> &gt; /etc/rsyncd.pass<span class="o">)</span>
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ cat /etc/rsyncd.pass
web:web
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ ll /etc/rsyncd.pass
-r--------. <span class="m">1</span> root root <span class="m">8</span> Jan  <span class="m">7</span> <span class="m">19</span>:16 /etc/rsyncd.pass
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>2.2.2.5. 创建一个同步目录<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>这个目录用于后面客户端给推送</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ mkdir /app/web
</pre></div>
</div>
<p>这个目录注意权限问题。</p>
</div>
<div class="section" id="id6">
<h5>2.2.2.6. 重启服务<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ systemctl restart rsyncd
<span class="o">[</span>root@centos74 ~<span class="o">]</span>$ systemctl status rsyncd
● rsyncd.service - fast remote file copy program daemon
Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/rsyncd.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
Active: active <span class="o">(</span>running<span class="o">)</span> since Sun <span class="m">2018</span>-01-07 <span class="m">19</span>:30:12 CST<span class="p">;</span> 9s ago
Main PID: <span class="m">39375</span> <span class="o">(</span>rsync<span class="o">)</span>
CGroup: /system.slice/rsyncd.service
        └─39375 /usr/bin/rsync --daemon --no-detach
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h4>2.2.3. 客户端端的配置<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id8">
<h5>2.2.3.1. 安装rsync软件<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<p>查看是否安装</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos69 ~<span class="o">]</span>$ rpm -ql rsync
<span class="o">[</span>root@centos69 ~<span class="o">]</span>$ yum -y install rsync
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h5>2.2.3.2. 创建同步密码文件<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<p>由于我们的服务端有密码配置，客户端需要密码才能同步我们服务端的数据，且ip在服务端的运行范围内。</p>
<p>密码文件格式： passwd</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos66 ~<span class="o">]</span>$ <span class="o">(</span><span class="nb">umask</span> <span class="m">066</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;web&quot;</span> &gt; /etc/rsync.pass<span class="o">)</span>
<span class="o">[</span>root@centos66 ~<span class="o">]</span>$ cat /etc/rsync.pass
web
<span class="o">[</span>root@centos66 ~<span class="o">]</span>$ ll /etc/rsync.pass
-rw------- <span class="m">1</span> root root <span class="m">4</span> Dec <span class="m">26</span> <span class="m">08</span>:23 /etc/rsync.pass
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里我们只需要指定密码即可，不用用户名。</p>
</div>
</div>
<div class="section" id="id10">
<h5>2.2.3.3. 初步测试同步<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos66 app<span class="o">]</span>$ rsync -avz web@72.18.46.7::web --password-file<span class="o">=</span>/etc/rsync.pass  /app/web
receiving incremental file list
./
sysconfig/
sysconfig/.zip
sysconfig/anaconda
sysconfig/atd
.................这里省去了很多文件..................................
sysconfig/rhn/clientCaps.d/

sent <span class="m">1934</span> bytes  received <span class="m">1170218</span> bytes  <span class="m">2344304</span>.00 bytes/sec
total size is <span class="m">1322779</span>  speedup is <span class="m">1</span>.13
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h4>2.2.4. 写脚本完成自动拉取服务器数据<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>安装inotify-tool工具</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos66 yum.repos.d<span class="o">]</span>$ yum install inotify-tools
</pre></div>
</div>
<p>编写rsync脚本</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">user</span><span class="o">=</span>web
<span class="nv">remote_module</span><span class="o">=</span>web
<span class="nv">local_dir</span><span class="o">=</span>/app/web/
<span class="nv">ip</span><span class="o">=</span><span class="m">72</span>.18.46.7
<span class="nv">password_file</span><span class="o">=</span>/etc/rsync.pass

/usr/bin/inotifywait -mrq --timefmt <span class="s1">&#39;%d/%m/%y%H:%M&#39;</span> --format <span class="s1">&#39;%T %w %f&#39;</span> -e modify,delete,create,attrib <span class="nv">$local_dir</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> DATE TIME DIR FILE<span class="p">;</span><span class="k">do</span>
        <span class="nv">filechange</span><span class="o">=</span><span class="si">${</span><span class="nv">DIR</span><span class="si">}${</span><span class="nv">FILE</span><span class="si">}</span>
        <span class="c1"># 拉取服务器数据</span>
        <span class="c1">#/usr/bin/rsync -avz --delete --progress --password-file=$password_file    $user@$ip::$remote_module   $local_dir &amp;</span>
        <span class="c1"># 推送本机的数据</span>
        /usr/bin/rsync -avz --delete --progress --password-file<span class="o">=</span><span class="nv">$password_file</span>     <span class="nv">$local_dir</span> <span class="nv">$user</span>@<span class="nv">$ip</span>::<span class="nv">$remote_module</span>   <span class="p">&amp;</span>

        <span class="nv">date_str</span><span class="o">=</span>/var/log/rsync_<span class="k">$(</span>date <span class="s2">&quot;+%F&quot;</span><span class="k">)</span>.log
        <span class="nb">echo</span> <span class="s2">&quot;At </span><span class="si">${</span><span class="nv">TIME</span><span class="si">}</span><span class="s2"> on </span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">, file </span><span class="nv">$filechange</span><span class="s2"> was backed up via rsynce&quot;</span> &gt;&gt; <span class="nv">$date_str</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>2.2.5. 配置计划任务<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>将上面的脚本放到while true里面即可，或者修改脚本为sysv脚本。</p>
</div>
</div>
<span id="document-Rsync同步/linux推送到window"></span><div class="section" id="linuxwindow">
<span id="topics-linux2window"></span><h3>2.3. linux推送到window<a class="headerlink" href="#linuxwindow" title="Permalink to this headline">¶</a></h3>
<p>在看这个文章的时候，请确保你看完了 <a class="reference internal" href="index.html#topics-rsync"><span class="std std-ref">rsync入门</span></a>。</p>
<p>这个文章的主要讲解如何使用rsync来把window的是文件同步到linux上去。</p>
<div class="section" id="id1">
<h4>2.3.1. 环境介绍<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>2个机器</li>
<li>centos7(192.168.1.109)，windows10(192.168.1.104)</li>
<li>centos(/app/web)===&gt;window(c:appweb)</li>
</ul>
<p>我们要完成的功能是centos7的数据更新后，自动推送到window机器上面。</p>
<p>这里我们选择windows作为服务端，centos7作为客户端，然后centos7去监控本地数据推送给window数据。</p>
</div>
<div class="section" id="id2">
<h4>2.3.2. 服务端的配置<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="section" id="cygwin">
<h5>2.3.2.1. 下载cygwin<a class="headerlink" href="#cygwin" title="Permalink to this headline">¶</a></h5>
<p>windows下是没有rync的， 需要安装软件来提供rsync功能的。</p>
<p>我们下载 <a class="reference external" href="http://cygwin.com/setup-x86_64.exe">cygwin64.exe</a> , 详细的地址可以访问 <a class="reference external" href="http://x.cygwin.com/">cywin官网</a></p>
<p>安装步骤截图：</p>
<img alt="_images/第一步.png" src="_images/第一步.png" />
<img alt="_images/第二步.png" src="_images/第二步.png" />
<img alt="_images/第三步.png" src="_images/第三步.png" />
<img alt="_images/第四步.png" src="_images/第四步.png" />
<img alt="_images/第五步.png" src="_images/第五步.png" />
<img alt="_images/第七步.png" src="_images/第七步.png" />
<img alt="_images/安装rsync.png" src="_images/安装rsync.png" />
<img alt="_images/第九步.png" src="_images/第九步.png" />
<img alt="_images/第十步.png" src="_images/第十步.png" />
<img alt="_images/完成.png" src="_images/完成.png" />
<img alt="_images/验证rsync.png" src="_images/验证rsync.png" />
<p>安装完毕cygwin之后，其实就是一个linux环境， 剩下的工作和linux和linux同步基本没有太大区别了。</p>
</div>
</div>
<div class="section" id="rsyncd">
<h4>2.3.3. 编辑rsyncd的配置文件<a class="headerlink" href="#rsyncd" title="Permalink to this headline">¶</a></h4>
<p>rsyncd的配置文件在“C:cygwin64etcrsyncd.conf”(需要自己创建conf文件)</p>
<p>使用记事本编辑这个conf文件</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>uid = test
gid = None
user chroot = no
max connections = 200
timeout = 600
pid file = /var/run/rsyncd.pid
lock file = /var/run/rsyncd.lock
log file = /var/run/rsyncd.log

[web]
path = /cygdriver/c/app/web/
ignore errors
read only = no
list = no
hosts allow = 192.168.1.0/24
auth users = web
secrets file = /etc/rsyncd.pass
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">我的uid是test，你的根据你的情况进行修改，如果不知道可以打开cygwin64Terminal终端，输入 echo $USER查看。</p>
</div>
<div class="section" id="id3">
<h5>2.3.3.1. 创建服务器密码文件<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p>上面指定了密码文件位置为/etc/rsync.pass，我们需要创建这个文件。</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>web:web
</pre></div>
</div>
<p>使用cygwin64Terminal修改这个密码文件的权限为600。</p>
<img alt="_images/修改权限.png" src="_images/修改权限.png" />
</div>
<div class="section" id="rsync">
<h5>2.3.3.2. 启动rsync服务<a class="headerlink" href="#rsync" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 使用cygwin64Terminal 去启动rsync的服务进程</span>
rsync --daemon
psaux aux <span class="p">|</span>grep rsync
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>2.3.3.3. 创建一个同步目录<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>这个目录用于后面客户端给推送</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos74 ~<span class="o">]</span>$ mkdir /app/web
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>2.3.3.4. 修改目录权限。<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>window的权限和我们安装的cygwin有点不同的，需要在window上给我们的用户权限，我的是test用户。</p>
<img alt="_images/修改目录权限.png" src="_images/修改目录权限.png" />
</div>
</div>
<div class="section" id="id6">
<h4>2.3.4. 客户端配置<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id7">
<h5>2.3.4.1. 安装rsync软件<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>查看是否安装</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost web <span class="o">]</span>$ rpm -ql rsync
<span class="o">[</span>root@localhost web<span class="o">]</span>$ yum -y install rsync
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>2.3.4.2. 先验证下服务端是否可以访问<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost web<span class="o">]</span><span class="c1"># telnet 192.168.1.104 873</span>
Trying <span class="m">192</span>.168.1.104...
Connected to <span class="m">192</span>.168.1.104.
Escape character is <span class="s1">&#39;^]&#39;</span>.
@RSYNCD: <span class="m">31</span>.0
</pre></div>
</div>
<p>出现了RSYNC的字样说明服务端的rsync服务是开启的了。</p>
</div>
<div class="section" id="id9">
<h5>2.3.4.3. 创建同步密码文件<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<p>由于我们的服务端有密码配置，客户端需要密码才能同步我们服务端的数据，且ip在服务端的运行范围内。</p>
<p>密码文件格式： passwd</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos66 ~<span class="o">]</span>$ <span class="o">(</span><span class="nb">umask</span> <span class="m">066</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;web&quot;</span> &gt; /etc/rsync.pass<span class="o">)</span>
<span class="o">[</span>root@centos66 ~<span class="o">]</span>$ cat /etc/rsync.pass
web
<span class="o">[</span>root@centos66 ~<span class="o">]</span>$ ll /etc/rsync.pass
-rw------- <span class="m">1</span> root root <span class="m">4</span> Dec <span class="m">26</span> <span class="m">08</span>:23 /etc/rsync.pass
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里我们只需要指定密码即可，不用用户名。</p>
</div>
</div>
<div class="section" id="id10">
<h5>2.3.4.4. 初步测试同步<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost web<span class="o">]</span><span class="c1"># rsync -avz web@192.168.1.104::web --password-file=/etc/rsync.pass /app/web</span>
receiving incremental file list
file has vanished: <span class="s2">&quot;/proc&quot;</span> <span class="o">(</span>in web<span class="o">)</span>
file has vanished: <span class="s2">&quot;/cygdrive/c&quot;</span> <span class="o">(</span>in web<span class="o">)</span>
./
新建 RTF 文档.rtf
cygdrive/
dev/

sent <span class="m">124</span> bytes  received <span class="m">598</span> bytes  <span class="m">131</span>.27 bytes/sec
total size is <span class="m">7</span>  speedup is <span class="m">0</span>.01
rsync warning: some files vanished before they could be transferred <span class="o">(</span>code <span class="m">24</span><span class="o">)</span> at main.c<span class="o">(</span><span class="m">1518</span><span class="o">)</span> <span class="o">[</span><span class="nv">generator</span><span class="o">=</span><span class="m">3</span>.0.9<span class="o">]</span>
<span class="o">[</span>root@localhost web<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">4</span>
dr-xr-xr-x. <span class="m">2</span> <span class="m">197609</span> <span class="m">197121</span>   <span class="m">6</span> Jan <span class="m">14</span> <span class="m">10</span>:24 cygdrive
dr-xr-xr-x. <span class="m">2</span> <span class="m">197609</span> <span class="m">197121</span> <span class="m">238</span> Jan <span class="m">14</span> <span class="m">10</span>:24 dev
-rwxrwx---. <span class="m">1</span> <span class="m">197609</span> <span class="m">197121</span>   <span class="m">0</span> Jan <span class="m">14</span> <span class="m">09</span>:41 test.txt
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里我不知道为何也罢cygdrive和dev这个目录同步过来了。 不知道为啥的.</p>
</div>
</div>
</div>
<div class="section" id="id11">
<h4>2.3.5. 写脚本完成自动拉取服务器数据<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>安装inotify-tool工具</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos66 yum.repos.d<span class="o">]</span>$ yum install inotify-tools
</pre></div>
</div>
<p>编写rsync脚本</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">user</span><span class="o">=</span>web
<span class="nv">remote_module</span><span class="o">=</span>web
<span class="nv">local_dir</span><span class="o">=</span>/app/web/
<span class="nv">ip</span><span class="o">=</span><span class="m">192</span>.168.1.104
<span class="nv">password_file</span><span class="o">=</span>/etc/rsync.pass


/usr/bin/inotifywait -mrq --timefmt <span class="s1">&#39;%d/%m/%y%H:%M&#39;</span> --format <span class="s1">&#39;%T %w %f&#39;</span> -e modify,delete,create,attrib <span class="nv">$local_dir</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> DATE TIME DIR FILE<span class="p">;</span><span class="k">do</span>

        <span class="nv">filechange</span><span class="o">=</span><span class="si">${</span><span class="nv">DIR</span><span class="si">}${</span><span class="nv">FILE</span><span class="si">}</span>
        <span class="c1"># 拉取服务器数据</span>
        <span class="c1">#/usr/bin/rsync -avz --delete --progress --password-file=$password_file    $user@$ip::$remote_module   $local_dir &amp;</span>
        <span class="c1"># 推送本机的数据</span>
        /usr/bin/rsync -avz --delete --progress --password-file<span class="o">=</span><span class="nv">$password_file</span>     <span class="nv">$local_dir</span> <span class="nv">$user</span>@<span class="nv">$ip</span>::<span class="nv">$remote_module</span>   <span class="p">&amp;</span>

        <span class="nv">date_str</span><span class="o">=</span>/var/log/rsync_<span class="k">$(</span>date <span class="s2">&quot;+%F&quot;</span><span class="k">)</span>.log
        <span class="nb">echo</span> <span class="s2">&quot;At </span><span class="si">${</span><span class="nv">TIME</span><span class="si">}</span><span class="s2"> on </span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">, file </span><span class="nv">$filechange</span><span class="s2"> was backed up via rsynce&quot;</span> &gt;&gt; <span class="nv">$date_str</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>2.3.6. 配置计划任务<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>将上面的脚本放到while true里面即可，或者修改脚本为sysv脚本。</p>
</div>
</div>
<span id="document-Rsync同步/window推送到linux"></span><div class="section" id="windowlinux">
<h3>2.4. window推送到linux<a class="headerlink" href="#windowlinux" title="Permalink to this headline">¶</a></h3>
<p>这个基本和linux推送到window差的不多。 <a class="reference internal" href="index.html#topics-linux2window"><span class="std std-ref">linux推送到window</span></a>
这个基本和linux推送到window差的不多。 <a class="reference internal" href="index.html#topics-linux2window"><span class="std std-ref">linux推送到window</span></a></p>
</div>
<span id="document-Rsync同步/window推送到window"></span><div class="section" id="windowwindow">
<h3>2.5. window推送到window<a class="headerlink" href="#windowwindow" title="Permalink to this headline">¶</a></h3>
<p>这个基本和linux推送到window差的不多。 <a class="reference internal" href="index.html#topics-linux2window"><span class="std std-ref">linux推送到window</span></a></p>
</div>
</div>
</div>
<span id="document-自动化安装/index"></span><div class="section" id="id1">
<h2>3. 自动化安装<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-自动化安装/光盘自动化安装"></span><div class="section" id="topics-cdrom">
<span id="id1"></span><h3>3.1. 光盘自动化安装<a class="headerlink" href="#topics-cdrom" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ks">
<h4>3.1.1. 制作ks文件<a class="headerlink" href="#ks" title="Permalink to this headline">¶</a></h4>
<p>ks的文件制作是比较麻烦的，但是我们在系统安装完毕的时候会生成当前系统的默认安装配置”/root/anaconda-ks.cfg”，
我们可以直接在这个文件的基础上稍作修改即可。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ls</span>
anaconda-ks.cfg  install.log  install.log.syslog
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># cp anaconda-ks.cfg  anaconda-ks.cfg.bak</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># vim anaconda-ks.cfg</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># yum list all |grep kickstart</span>
pykickstart.noarch                       <span class="m">1</span>.74.22-1.el6                     base
system-config-kickstart.noarch           <span class="m">2</span>.8.6.6-1.el6                     base
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># yum install pykickstart -y</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ksvalidator  anaconda-ks.cfg</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># cat anaconda-ks.cfg</span>

<span class="c1"># Kickstart file automatically generated by anaconda.</span>

<span class="c1">#version=DEVEL</span>
install
cdrom
reboot
text
<span class="c1">#xconfig  --startxonboot</span>
<span class="c1">#eula --agreed</span>
lang en_US.UTF-8
firstboot --disable
keyboard us
network --onboot no --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted <span class="nv">$6$NE46h0OLL1e8dgDc$6</span>Kpz4orvUP87oYdbaHefWtUbD12ITS5RIJPouwHn.LrluP2T9280aoFf9Cs5yvnJ9XIZJHnlV26oa1ECe39Bs1
firewall --disabled
authconfig --enableshadow --passalgo<span class="o">=</span>sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location<span class="o">=</span>mbr --driveorder<span class="o">=</span>sda --append<span class="o">=</span><span class="s2">&quot;crashkernel=auto rhgb quiet&quot;</span>
<span class="c1"># The following is the partition information you requested</span>
<span class="c1"># Note that any partitions you deleted are not expressed</span>
<span class="c1"># here so unless you clear all partitions first, this is</span>
<span class="c1"># not guaranteed to work</span>
clearpart --all --drives<span class="o">=</span>sda
zerombr

part /boot --fstype<span class="o">=</span>ext4 --size<span class="o">=</span><span class="m">500</span>
part pv.008002  --size<span class="o">=</span><span class="m">200000</span>
volgroup VolGroup --pesize<span class="o">=</span><span class="m">4096</span> pv.008002
logvol /home --fstype<span class="o">=</span>ext4 --name<span class="o">=</span>lv_home --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">100</span>
logvol / --fstype<span class="o">=</span>ext4 --name<span class="o">=</span>lv_root --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">1024</span> --maxsize<span class="o">=</span><span class="m">51200</span>
logvol swap --name<span class="o">=</span>lv_swap --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">1984</span> --maxsize<span class="o">=</span><span class="m">1984</span>


<span class="c1">#repo --name=&quot;CentOS&quot;  --baseurl=cdrom:sr0 --cost=100</span>

%packages
@core
@server-policy
@workstation-policy
%end

%post
touch /root/post.file
%end
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">如果lvm的pv设置超过了后续安装的磁盘大小，就使用磁盘的全部空间。</p>
</div>
<p>这里为了方便看出我修改了那些。提供一个vimdiff命令对比图：</p>
<img alt="_images/ks.png" src="_images/ks.png" />
<p>ks的主要几项说明</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>cdrom                         # 光盘启动
reboot                        # 安装完毕自动重启
text                          # 字符安装
firstboot --disable           # 第一次启动初始化工作禁用
rootpw                        # 这个行是定义root密码的，可以通过openssl passwd -1 生成
clearpart --all --drives=sda  # 清空磁盘分区
zerombr                       # 清空mbr信息
%post%end                     # 安装后脚本，这个时候系统已经安装完毕了，写bash脚本即可
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>3.1.2. 创建自制目录<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># mount /dev/cdrom /mnt/cdrom                         # 挂载光盘</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># mkdir /app -pv                                      # 创建一个光盘刻录目录</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># cp -av /mnt/cdrom /app/centos6                      # 把原有光盘数据copy过来</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># cd /app/centos6/                                    # 进入工作目录</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># ll</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># find /app/centos6/ -name TRANS.TBL            # 查看TRANS.TBL文件</span>
/app/centos6/TRANS.TBL
/app/centos6/isolinux/TRANS.TBL
/app/centos6/repodata/TRANS.TBL
/app/centos6/EFI/TRANS.TBL
/app/centos6/EFI/BOOT/TRANS.TBL
/app/centos6/images/TRANS.TBL
/app/centos6/images/pxeboot/TRANS.TBL
/app/centos6/Packages/TRANS.TBL
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># find /app/centos6/ -name TRANS.TBL -exec rm -rf {} \; # 删除文件</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># rm -rf repodata/*                                     # 删除文件</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># cp /mnt/cdrom/repodata/43*  repodata/</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># yum install createrepo -y                             # 安装createrepo工具</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># createrepo  -g repodata/43*  . # 生成仓库</span>
Spawning worker <span class="m">0</span> with <span class="m">6706</span> pkgs
Workers Finished
Gathering worker results

Saving Primary metadata
Saving file lists metadata
Saving other metadata
Generating sqlite DBs
Sqlite DBs <span class="nb">complete</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># ls -1  repodata/*                                      # 查看下目录的文件是不是都自动生成了</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># mkdir ks                                               # 创建ks目录</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># cp /root/anaconda-ks.cfg ks/ks.cfg                     # 把我们制作好的ks文件复制过来</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># vim isolinux/isolinux.cfg                              # 编辑启动菜单</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># cat isolinux/isolinux.cfg                              # 查看</span>
default vesamenu.c32
<span class="c1">#prompt 1</span>
timeout <span class="m">600</span>

menu title Welcome to CentOS <span class="m">6</span>.9 From LinuxPanda Tech

label linux
  menu label ^Install Auto From Cdrom
  kernel vmlinuz
  append <span class="nv">initrd</span><span class="o">=</span>initrd.img <span class="nv">ks</span><span class="o">=</span>cdrom:/ks/ks.cfg
label rescue
  menu label ^Rescue installed system
  kernel vmlinuz
  append <span class="nv">initrd</span><span class="o">=</span>initrd.img rescue
label <span class="nb">local</span>
  menu label Boot from ^local drive
  menu default
  localboot 0xffff

<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># yum install mkisofs -y                                # 安装mkisofs这个工具，用于制作iso</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># mkisofs -R -J -T -v --no-emul-boot --boot-load-size 4 --boot-info-table \</span>
-V <span class="s2">&quot;CentOS 6.9 x86_64 boot&quot;</span> -b isolinux/isolinux.bin -c isolinux/boot.cat -o /var/ftp/pub/centos6.iso /app/centos6/
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># ll /root/boot.iso  -h                                 # 文件太大了。 使用ftp传送出来</span>
-rw-r--r--. <span class="m">1</span> root root <span class="m">5</span>.8G Jan <span class="m">10</span> <span class="m">20</span>:40 /root/boot.iso
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># yum install vsftpd                                    # 安装ftp工具</span>
<span class="o">[</span>root@localhost centos6<span class="o">]</span><span class="c1"># service vsftpd restart                                # 启动ftp功能</span>
</pre></div>
</div>
</div>
<div class="section" id="iso">
<h4>3.1.3. 下载iso镜像<a class="headerlink" href="#iso" title="Permalink to this headline">¶</a></h4>
<p>我这里通过浏览器下载，地址是ftp://192.168.46.6/pub/boot.iso。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果不能访问，你确保你的selinux和防火墙是禁用的。</p>
</div>
</div>
<div class="section" id="id3">
<h4>3.1.4. 测试光盘<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>创建一个新的虚拟机，选择镜像文件为刚才下载的iso文件。进行启动。</p>
<p>选择光盘：</p>
<img alt="_images/选择光盘.png" src="_images/选择光盘.png" />
<p>启动界面：</p>
<img alt="_images/启动菜单.png" src="_images/启动菜单.png" />
<p>安装进度截图：</p>
<img alt="_images/安装进度.png" src="_images/安装进度.png" />
<p>登陆截图：</p>
<img alt="_images/登陆界面.png" src="_images/登陆界面.png" />
</div>
</div>
<span id="document-自动化安装/pxe+kickstart自动化安装"></span><div class="section" id="pxe-kickstart">
<span id="topics-pxe"></span><h3>3.2. pxe+kickstart自动化安装<a class="headerlink" href="#pxe-kickstart" title="Permalink to this headline">¶</a></h3>
<p>pxe的工作原理：</p>
<ol class="arabic simple">
<li>Client向PXE Server上的DHCP发送IP地址请求消息，DHCP检测Client是否合法
（主要是检测Client的网卡MAC地址），如果合法则返回Client的IP地址，
同时将启动文件pxelinux.0的位置信息一并传送给Client</li>
<li>Client向PXE Server上的TFTP发送获取pxelinux.0请求消息，TFTP接收到消息之后
再向Client发送pxelinux.0大小信息，试探Client是否满意，当TFTP收到Client发回的同意大小信息之后，
正式向Client发送pxelinux.0</li>
<li>Client执行接收到的pxelinux.0文件</li>
<li>Client向TFTP Server发送针对本机的配置信息文件（在TFTP 服务的pxelinux.cfg目录下），
TFTP将配置文件发回Client，继而Client根据配置文件执行后续操作。</li>
<li>Client向TFTP发送Linux内核请求信息，TFTP接收到消息之后将内核文件发送给Client</li>
<li>Client向TFTP发送根文件请求信息，TFTP接收到消息之后返回Linux根文件系统</li>
<li>Client启动Linux内核</li>
<li>Client下载安装源文件，读取自动化安装脚本</li>
</ol>
<div class="section" id="dhcp">
<h4>3.2.1. 配置dhcp服务器<a class="headerlink" href="#dhcp" title="Permalink to this headline">¶</a></h4>
<p>详细的可以参考 <a class="reference internal" href="index.html#topics-dhcp"><span class="std std-ref">DHCP服务搭建</span></a></p>
<p>我们需要在原有的dhcp的配置稍作修改，最终dhcp配置如下 ：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># vim /etc/dhcp/dhcpd.conf</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cat /etc/dhcp/dhcpd.conf</span>
<span class="c1"># dhcpd.conf</span>
<span class="c1">#</span>
<span class="c1"># Sample configuration file for ISC dhcpd</span>
<span class="c1">#</span>

<span class="c1"># option definitions common to all supported networks...</span>
option domain-name <span class="s2">&quot;linuxpanda.tech&quot;</span><span class="p">;</span>
option domain-name-servers ns1.linuxpanda.tech, ns2.linuxpanda.tech<span class="p">;</span>

default-lease-time <span class="m">86400</span><span class="p">;</span>
max-lease-time <span class="m">864000</span><span class="p">;</span>

subnet <span class="m">192</span>.168.46.0 netmask <span class="m">255</span>.255.255.0 <span class="o">{</span>
range dynamic-bootp <span class="m">192</span>.168.46.100 <span class="m">192</span>.168.46.200 <span class="p">;</span>
option routers <span class="m">192</span>.168.46.6 <span class="p">;</span>
filename <span class="s2">&quot;pxelinux.0&quot;</span><span class="p">;</span>
next-server <span class="m">192</span>.168.46.6<span class="p">;</span>
<span class="o">}</span>

host boss <span class="o">{</span>
hardware ethernet <span class="m">08</span>:00:07:26:c0:a5<span class="p">;</span>
fixed-address <span class="m">192</span>.168.46.2 <span class="p">;</span>
<span class="o">}</span>

<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># service dhcpd restart</span>
Shutting down dhcpd:                                       <span class="o">[</span>  OK  <span class="o">]</span>
Starting dhcpd:                                            <span class="o">[</span>  OK  <span class="o">]</span>
</pre></div>
</div>
<p>其中filename指明了引导文件名称，next-server提供了文件服务器的地址。</p>
</div>
<div class="section" id="tfp-server">
<h4>3.2.2. tfp-server的下载安装<a class="headerlink" href="#tfp-server" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># yum install tftp-server -y</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># rpm -ql tftp-server</span>
/etc/xinetd.d/tftp
/usr/sbin/in.tftpd
............其他文件.................
/var/lib/tftpboot
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># service xinetd start</span>
Starting xinetd:                                           <span class="o">[</span>  OK  <span class="o">]</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># chkconfig tftp on</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ss -tunl |grep 69</span>
udp    UNCONN     <span class="m">0</span>      <span class="m">0</span>                      *:69
</pre></div>
</div>
<p>tftp依赖于xinet的，我们需要启动下xinetd 。</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">这个地方只能使用tftp-server，不能使用其他的ftp软件。</p>
</div>
</div>
<div class="section" id="httpd">
<h4>3.2.3. 安装httpd服务<a class="headerlink" href="#httpd" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># yum install httpd</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># mkdir /var/www/html/centos/{6,7} -pv</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># chkconfig  httpd on</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># service httpd start</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">上面提示域名有点问题，暂时不用关心。</p>
</div>
</div>
<div class="section" id="id1">
<h4>3.2.4. 挂载光盘<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>我们之前添加过centos6的光盘，这里再添加一个centos7的光盘。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># ls /dev/sr*                                   # 查看我们添加的光盘</span>
/dev/sr0
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># find /sys/devices/ -name scan                # 找scan文件</span>
/sys/devices/pci0000:00/0000:00:07.1/host1/scsi_host/host1/scan
/sys/devices/pci0000:00/0000:00:07.1/host2/scsi_host/host2/scan
/sys/devices/pci0000:00/0000:00:10.0/host0/scsi_host/host0/scan
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># for i in `find /sys/devices/ -name scan` ; do echo &quot;- - -&quot; &gt; $i ; done # 启用下硬件识别</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># ls /dev/sr*                                  # 再次查看光盘信息，发现光盘已经被识别出来了。</span>
/dev/sr0  /dev/sr1
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># mount /dev/sr0 /var/www/html/centos/6/       # 挂载centos6</span>
mount: block device /dev/sr0 is write-protected, mounting read-only
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># mount /dev/sr1 /var/www/html/centos/7/       # 挂载centos7</span>
mount: block device /dev/sr1 is write-protected, mounting read-only
</pre></div>
</div>
<p>我们这里都挂载好了，需要在宿主机上测试下httpd服务，宿主机测试http://192.168.46.6/centos/是否能访问。</p>
</div>
<div class="section" id="ks">
<h4>3.2.5. 构建ks文件<a class="headerlink" href="#ks" title="Permalink to this headline">¶</a></h4>
<p>我这里需要构建4个ks文件， centos6系统2个，centos7系统2个。</p>
<p>我这里在centos6操作,centos7的ks文件需要在centos7上制作，远程复制到这个机器上来。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># cat ks6-mini.cfg</span>
<span class="c1"># Kickstart file automatically generated by anaconda.</span>

<span class="c1">#version=DEVEL</span>
install
url --url<span class="o">=</span>http://192.168.46.6/centos/6
reboot
text
<span class="c1">#xconfig  --startxonboot</span>
<span class="c1">#eula --agreed</span>
lang en_US.UTF-8
firstboot --disable
keyboard us
network --onboot no --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted <span class="nv">$6$NE46h0OLL1e8dgDc$6</span>Kpz4orvUP87oYdbaHefWtUbD12ITS5RIJPouwHn.LrluP2T9280aoFf9Cs5yvnJ9XIZJHnlV26oa1ECe39Bs1
firewall --disabled
authconfig --enableshadow --passalgo<span class="o">=</span>sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location<span class="o">=</span>mbr --driveorder<span class="o">=</span>sda --append<span class="o">=</span><span class="s2">&quot;crashkernel=auto rhgb quiet&quot;</span>
<span class="c1"># The following is the partition information you requested</span>
<span class="c1"># Note that any partitions you deleted are not expressed</span>
<span class="c1"># here so unless you clear all partitions first, this is</span>
<span class="c1"># not guaranteed to work</span>
clearpart --all --drives<span class="o">=</span>sda
zerombr

part /boot --fstype<span class="o">=</span>ext4 --size<span class="o">=</span><span class="m">500</span>
part pv.008002  --size<span class="o">=</span><span class="m">200000</span>
volgroup VolGroup --pesize<span class="o">=</span><span class="m">4096</span> pv.008002
logvol /home --fstype<span class="o">=</span>ext4 --name<span class="o">=</span>lv_home --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">100</span>
logvol / --fstype<span class="o">=</span>ext4 --name<span class="o">=</span>lv_root --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">1024</span> --maxsize<span class="o">=</span><span class="m">51200</span>
logvol swap --name<span class="o">=</span>lv_swap --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">1984</span> --maxsize<span class="o">=</span><span class="m">1984</span>


<span class="c1">#repo --name=&quot;CentOS&quot;  --baseurl=cdrom:sr0 --cost=100</span>

%packages
@core
@server-policy
@workstation-policy
%end

%post
touch /root/post.file
%end


<span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># cat ks6-desktop.cfg</span>
<span class="c1"># Kickstart file automatically generated by anaconda.</span>

<span class="c1">#version=DEVEL</span>
install
url --url<span class="o">=</span>http://192.168.46.6/centos/6
reboot
text
xconfig  --startxonboot
<span class="c1">#eula --agreed</span>
lang en_US.UTF-8
firstboot --disable
keyboard us
network --onboot no --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted <span class="nv">$6$NE46h0OLL1e8dgDc$6</span>Kpz4orvUP87oYdbaHefWtUbD12ITS5RIJPouwHn.LrluP2T9280aoFf9Cs5yvnJ9XIZJHnlV26oa1ECe39Bs1
firewall --disabled
authconfig --enableshadow --passalgo<span class="o">=</span>sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location<span class="o">=</span>mbr --driveorder<span class="o">=</span>sda --append<span class="o">=</span><span class="s2">&quot;crashkernel=auto rhgb quiet&quot;</span>
<span class="c1"># The following is the partition information you requested</span>
<span class="c1"># Note that any partitions you deleted are not expressed</span>
<span class="c1"># here so unless you clear all partitions first, this is</span>
<span class="c1"># not guaranteed to work</span>
clearpart --all --drives<span class="o">=</span>sda
zerombr

part /boot --fstype<span class="o">=</span>ext4 --size<span class="o">=</span><span class="m">500</span>
part pv.008002  --size<span class="o">=</span><span class="m">200000</span>
volgroup VolGroup --pesize<span class="o">=</span><span class="m">4096</span> pv.008002
logvol /home --fstype<span class="o">=</span>ext4 --name<span class="o">=</span>lv_home --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">100</span>
logvol / --fstype<span class="o">=</span>ext4 --name<span class="o">=</span>lv_root --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">1024</span> --maxsize<span class="o">=</span><span class="m">51200</span>
logvol swap --name<span class="o">=</span>lv_swap --vgname<span class="o">=</span>VolGroup --grow --size<span class="o">=</span><span class="m">1984</span> --maxsize<span class="o">=</span><span class="m">1984</span>


<span class="c1">#repo --name=&quot;CentOS&quot;  --baseurl=cdrom:sr0 --cost=100</span>

%packages
@base
@core
@debugging
@basic-desktop
@desktop-platform
@directory-client
@fonts
@general-desktop
@graphical-admin-tools
@input-methods
@internet-applications
@internet-browser
@legacy-x
@network-file-system-client
@x11
%end

%post
touch /root/post.file
%end

<span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># cat ks7-mini.cfg</span>
<span class="c1">#version=DEVEL</span>
<span class="c1"># System authorization information</span>
auth --enableshadow --passalgo<span class="o">=</span>sha512
<span class="c1"># Use CDROM installation media</span>
url --url<span class="o">=</span>http://192.168.46.6/centos/7
<span class="c1"># Use graphical install</span>
firewall --disabled
selinux --disabled
text
reboot
<span class="c1"># Run the Setup Agent on first boot</span>
firstboot --disable
ignoredisk --only-use<span class="o">=</span>sda
<span class="c1"># Keyboard layouts</span>
keyboard --vckeymap<span class="o">=</span>us --xlayouts<span class="o">=</span><span class="s1">&#39;us&#39;</span>
<span class="c1"># System language</span>
lang en_US.UTF-8

<span class="c1"># Network information</span>
network  --bootproto<span class="o">=</span>dhcp --device<span class="o">=</span>ens33 --onboot<span class="o">=</span>on --ipv6<span class="o">=</span>auto --activate
network  --hostname<span class="o">=</span>centos7.magedu.com

<span class="c1"># Root password</span>
rootpw --iscrypted <span class="nv">$6$pjgOq</span>.zzypK4qeve<span class="nv">$KrCLntLJyyvUPWElz5BIVztGXDov8Vj</span>.gJaNTQ6gzeUHeC0KTeiMLPzScbCja37wJ58mzGgKeGooAMqZD7A2h/
<span class="c1"># System services</span>
services --disabled<span class="o">=</span><span class="s2">&quot;chronyd&quot;</span>
<span class="c1"># System timezone</span>
timezone Asia/Shanghai --isUtc --nontp
user --name<span class="o">=</span>zhao --password<span class="o">=</span><span class="nv">$6$4</span>FY9k21GGia3q98C<span class="nv">$p8NRwX2</span>/9w/MEqi03ASVe9aoyehDLRsnqV6QrkM3o38nLQW5Ox7cRvFWg8weQYoyPz85ro8D000tnVgGz225q0 --iscrypted --gecos<span class="o">=</span><span class="s2">&quot;zhao&quot;</span>
<span class="c1"># X Window System configuration information</span>
xconfig  --startxonboot
<span class="c1"># System bootloader configuration</span>
bootloader --location<span class="o">=</span>mbr --boot-drive<span class="o">=</span>sda
<span class="c1"># Partition clearing information</span>
zerombr
clearpart --all --initlabel
autopart --type<span class="o">=</span>lvm
<span class="c1"># Disk partitioning information</span>
<span class="c1">#part swap --fstype=&quot;swap&quot; --ondisk=sda --size=2048</span>
<span class="c1">#part /boot --fstype=&quot;xfs&quot; --ondisk=sda --size=1024</span>
<span class="c1">#part / --fstype=&quot;xfs&quot; --ondisk=sda --size=51200</span>
<span class="c1">#part /app --fstype=&quot;xfs&quot; --ondisk=sda --size=20480</span>
eula --agreed
%packages
@^minimal
@core
%end

%addon com_redhat_kdump --disable --reserve-mb<span class="o">=</span><span class="s1">&#39;auto&#39;</span>

%end

%anaconda
pwpolicy root --minlen<span class="o">=</span><span class="m">6</span> --minquality<span class="o">=</span><span class="m">1</span> --notstrict --nochanges --notempty
pwpolicy user --minlen<span class="o">=</span><span class="m">6</span> --minquality<span class="o">=</span><span class="m">1</span> --notstrict --nochanges --emptyok
pwpolicy luks --minlen<span class="o">=</span><span class="m">6</span> --minquality<span class="o">=</span><span class="m">1</span> --notstrict --nochanges --notempty
%end

<span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># cat ks7-desktop.cfg</span>
<span class="c1">#version=DEVEL</span>
<span class="c1"># System authorization information</span>
auth --enableshadow --passalgo<span class="o">=</span>sha512
<span class="c1"># Use CDROM installation media</span>
url --url<span class="o">=</span>http://192.168.46.6/centos/7
<span class="c1"># Use graphical install</span>
firewall --disabled
selinux --disabled
text
reboot
<span class="c1"># Run the Setup Agent on first boot</span>
firstboot --disable
ignoredisk --only-use<span class="o">=</span>sda
<span class="c1"># Keyboard layouts</span>
keyboard --vckeymap<span class="o">=</span>us --xlayouts<span class="o">=</span><span class="s1">&#39;us&#39;</span>
<span class="c1"># System language</span>
lang en_US.UTF-8

<span class="c1"># Network information</span>
network  --bootproto<span class="o">=</span>dhcp --device<span class="o">=</span>ens33 --onboot<span class="o">=</span>on --ipv6<span class="o">=</span>auto --activate
network  --hostname<span class="o">=</span>centos7.magedu.com

<span class="c1"># Root password</span>
rootpw --iscrypted <span class="nv">$6$pjgOq</span>.zzypK4qeve<span class="nv">$KrCLntLJyyvUPWElz5BIVztGXDov8Vj</span>.gJaNTQ6gzeUHeC0KTeiMLPzScbCja37wJ58mzGgKeGooAMqZD7A2h/
<span class="c1"># System services</span>
services --disabled<span class="o">=</span><span class="s2">&quot;chronyd&quot;</span>
<span class="c1"># System timezone</span>
timezone Asia/Shanghai --isUtc --nontp
user --name<span class="o">=</span>zhao --password<span class="o">=</span><span class="nv">$6$4</span>FY9k21GGia3q98C<span class="nv">$p8NRwX2</span>/9w/MEqi03ASVe9aoyehDLRsnqV6QrkM3o38nLQW5Ox7cRvFWg8weQYoyPz85ro8D000tnVgGz225q0 --iscrypted --gecos<span class="o">=</span><span class="s2">&quot;zhao&quot;</span>
<span class="c1"># X Window System configuration information</span>
xconfig  --startxonboot
<span class="c1"># System bootloader configuration</span>
bootloader --location<span class="o">=</span>mbr --boot-drive<span class="o">=</span>sda
<span class="c1"># Partition clearing information</span>
zerombr
clearpart --all --initlabel
autopart --type<span class="o">=</span>lvm
<span class="c1"># Disk partitioning information</span>
<span class="c1">#part swap --fstype=&quot;swap&quot; --ondisk=sda --size=2048</span>
<span class="c1">#part /boot --fstype=&quot;xfs&quot; --ondisk=sda --size=1024</span>
<span class="c1">#part / --fstype=&quot;xfs&quot; --ondisk=sda --size=51200</span>
<span class="c1">#part /app --fstype=&quot;xfs&quot; --ondisk=sda --size=20480</span>
eula --agreed
%packages
@base
@core
@dial-up
@fonts
@gnome-desktop
@guest-agents
@guest-desktop-agents
@internet-browser
@multimedia
@network-file-system-client
@networkmanager-submodules
@x11
%end

%addon com_redhat_kdump --disable --reserve-mb<span class="o">=</span><span class="s1">&#39;auto&#39;</span>

%end

%anaconda
pwpolicy root --minlen<span class="o">=</span><span class="m">6</span> --minquality<span class="o">=</span><span class="m">1</span> --notstrict --nochanges --notempty
pwpolicy user --minlen<span class="o">=</span><span class="m">6</span> --minquality<span class="o">=</span><span class="m">1</span> --notstrict --nochanges --emptyok
pwpolicy luks --minlen<span class="o">=</span><span class="m">6</span> --minquality<span class="o">=</span><span class="m">1</span> --notstrict --nochanges --notempty
%end

%post
systemctl set-default multi-user.target
systemctl disable initial-setup-graphical.service
%end

<span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># ll                                    # 这里发现权限有点问题，400的文件权限apache是无法访问的，修改下。</span>
total <span class="m">16</span>
-rw-------. <span class="m">1</span> root root <span class="m">1479</span> Jan <span class="m">10</span> <span class="m">23</span>:14 ks6-desktop.cfg
-rw-------. <span class="m">1</span> root root <span class="m">1300</span> Jan <span class="m">10</span> <span class="m">22</span>:51 ks6-mini.cfg
-rw-r--r--. <span class="m">1</span> root root <span class="m">1927</span> Jan <span class="m">10</span> <span class="m">23</span>:13 ks7-desktop.cfg
-rw-r--r--. <span class="m">1</span> root root <span class="m">1774</span> Jan <span class="m">10</span> <span class="m">23</span>:10 ks7-mini.cfg
<span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># chmod 644 *</span>
</pre></div>
</div>
<p>一共四个文件。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ks文件的编写可以手工编写的，建议是使用system-config-kickstart图形界面加载/root/anaconda-ks.cfg修改另存。</p>
</div>
</div>
<div class="section" id="tftp">
<h4>3.2.6. 填充tftp目录内容<a class="headerlink" href="#tftp" title="Permalink to this headline">¶</a></h4>
<p>pxe的配置需要几个文件的：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>initrd.img              # 根文件系统
vmlinuz                 # 内核
menu.c32                # 启动菜单
pxelinux.0              # pxelinux
pxelinux.cfg/default    # pxelinux配置文件
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ks<span class="o">]</span><span class="c1"># cd /var/lib/tftpboot/</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># mkdir {6,7}</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cp /var/www/html/centos/6/isolinux/{vmlinuz,initrd.img} 6/</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cp /var/www/html/centos/7/isolinux/{vmlinuz,initrd.img} 7/</span>

<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># mkdir pxelinux.cfg</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cp /var/www/html/centos/7/isolinux/isolinux.cfg ./pxelinux.cfg/default</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># vim pxelinux.cfg/default</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cat pxelinux.cfg/default</span>
default menu.c32
timeout <span class="m">600</span>

menu title CentOS <span class="m">6</span> or <span class="m">7</span> <span class="p">|</span> made by zhaojiedi1992@linuxpanda.tech

label centos7-mini
  menu label Install CentOS <span class="m">7</span>-mini
  kernel <span class="m">6</span>/vmlinuz
  append <span class="nv">initrd</span><span class="o">=</span><span class="m">7</span>/initrd.img <span class="nv">ks</span><span class="o">=</span>http://192.168.46.6/ks/ks7-mini.cfg

label centos7-Desktop
  menu label Install CentOS <span class="m">7</span>-desktop
  kernel <span class="m">6</span>/vmlinuz
  append <span class="nv">initrd</span><span class="o">=</span><span class="m">7</span>/initrd.img <span class="nv">ks</span><span class="o">=</span>http://192.168.46.6/ks/ks7-desktop.cfg

label centos6-mini
  menu label Install CentOS <span class="m">6</span>-mini
  kernel <span class="m">6</span>/vmlinuz
  append <span class="nv">initrd</span><span class="o">=</span><span class="m">6</span>/initrd.img <span class="nv">ks</span><span class="o">=</span>http:192.168.46.6//ks/ks6-mini.cfg

label centos6-desktop
  menu label Install CentOS <span class="m">6</span>-desktop
  kernel <span class="m">6</span>/vmlinuz
  append <span class="nv">initrd</span><span class="o">=</span><span class="m">6</span>/initrd.img <span class="nv">ks</span><span class="o">=</span>http://192.168.46.6/ks/ks6-desktop.cfg

label <span class="nb">local</span>
  menu default
  menu label Boot from ^local drive
  localboot 0xffff


<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cp /usr/share/syslinux/pxelinux.0 .</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># cp /usr/share/syslinux/menu.c32 .</span>
<span class="o">[</span>root@localhost tftpboot<span class="o">]</span><span class="c1"># tree</span>
.
├── <span class="m">6</span>
│   ├── initrd.img
│   └── vmlinuz
├── <span class="m">7</span>
│   ├── initrd.img
│   └── vmlinuz
├── menu.c32
├── pxelinux.0
└── pxelinux.cfg
    └── default

<span class="m">3</span> directories, <span class="m">7</span> files
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>3.2.7. 系统网络安装<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>进入bios设置启动项目硬盘第一个，cdrom第二个，网络第三个即可。</p>
<p>安装菜单页面：</p>
<img alt="_images/安装centos6图形.png" src="_images/安装centos6图形.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">如果你要选择图形化安装，建议内存调整为1.2G</p>
</div>
</div>
</div>
<span id="document-自动化安装/cobble自动化安装"></span><div class="section" id="cobble">
<span id="topics-cobble"></span><h3>3.3. cobble自动化安装<a class="headerlink" href="#cobble" title="Permalink to this headline">¶</a></h3>
<p>前面2个实验 <a class="reference internal" href="index.html#topics-cdrom"><span class="std std-ref">光盘自动化安装</span></a> 和 <a class="reference internal" href="index.html#topics-pxe"><span class="std std-ref">pxe+kickstart自动化安装</span></a> 的自动化安装， 不过还是比较麻烦的，
这里使用cobble来自动化安装。</p>
<p>下面的操作在centos7上操作</p>
<div class="section" id="id1">
<h4>3.3.1. 安装前准备<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>关闭防火墙和selinux</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># systemctl stop firewalld</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># systemctl disable firewalld</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># getenforce</span>
Enforcing
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># setenforce 0</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># sed -i &#39;s@SELINUX=enforcing@SELINUX=disabled@&#39; /etc/sysconfig/selinux</span>
</pre></div>
</div>
<p>配置一个静态ip，我们需要为别的客户机器分发ip的，必须保证自己的ip是静态的。</p>
</div>
<div class="section" id="id2">
<h4>3.3.2. 安装软件包<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># yum install cobbler-web cobbler dhcp -y</span>

<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># systemctl start cobblerd</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># systemctl enable cobblerd</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/cobblerd.service to /usr/lib/systemd/system/cobblerd.service.
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># systemctl start httpd</span>
<span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># systemctl enable httpd</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">centos6系统安装cobbler-web会无法访问的，依赖一些包的。</p>
</div>
</div>
<div class="section" id="cobbler">
<h4>3.3.3. cobbler目录介绍<a class="headerlink" href="#cobbler" title="Permalink to this headline">¶</a></h4>
<p>一些cobbler重要目录：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>/etc/cobbler/dhcp.template                      # dhcp模板文件
/etc/cobbler/iso                                # iso模板配置文件
/etc/cobbler/iso/buildiso.template              # 构建iso模板
/etc/cobbler/modules.conf                       # 模块配置文件
/etc/cobbler/named.template                     # dns配置文件
/etc/cobbler/power                              # 电源相关配置
/etc/cobbler/pxe                                # pxe模板文件
/etc/cobbler/settings                           # 主配置文件
/etc/cobbler/tftpd.template                     # tfp配置模板
/etc/cobbler/users.conf                         # web服务授权配置文件
/etc/cobbler/users.digest                       # web访问的用户名和密码配置
/var/lib/cobbler/config                         # 存放distros,system,profile的配置文件
/var/lib/cobbler/kickstart                      # 用户默认的kickstart文件
/var/lib/cobbler/loaders                        # 存放各种引导程序
/var/lib/cobbler/ks_mirror                      # 系统所有数据
/var/lib/cobbler/images                         # kernel和initrd镜像可用
/var/www/cobbler/repo_mirror                    # yum仓库存储目录
/var/log/cobbler/installing                     # 客户端安装日志
/var/log/cobbler/cobbler.log                    # cobbler日志
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>3.3.4. cobbler常用命令<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-text"><div class="highlight"><pre><span></span>cobbler check               # 核对当前设置是否有问题
cobbler list                # 列出所有元素
cobbler report              # 列出元素的详细信息
cobbler sync                # 同步配置到数据目录
cobbler reposync            # 同步yum仓库
cobbler distro              # 查看导入的系统信息
cobbler system              # 查看添加的系统信息
cobbler profile             # 查看配置信息
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>3.3.5. cobbler重要参数设置<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-text"><div class="highlight"><pre><span></span>default_password_crypted    # 默认root密码
manage_dhcp                 # 是否cobbler管理dhcp
manage_tftpd                # 是否cobbler管理tftpd
next_server                 # tftp服务器的ip地址
server                      # cobbler服务器的ip地址
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>3.3.6. 修改配置文件<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost yum.repos.d<span class="o">]</span><span class="c1"># cobbler check</span>
The following are potential configuration items that you may want to fix:

<span class="m">1</span> : The <span class="s1">&#39;server&#39;</span> field in /etc/cobbler/settings must be <span class="nb">set</span> to something other than localhost, or kickstarting features will not work.  This should be a resolvable hostname or IP <span class="k">for</span> the boot server as reachable by all machines that will use it.
<span class="m">2</span> : For PXE to be functional, the <span class="s1">&#39;next_server&#39;</span> field in /etc/cobbler/settings must be <span class="nb">set</span> to something other than <span class="m">127</span>.0.0.1, and should match the IP of the boot server on the PXE network.
<span class="m">3</span> : SELinux is enabled. Please review the following wiki page <span class="k">for</span> details on ensuring cobbler works correctly in your SELinux environment:
    https://github.com/cobbler/cobbler/wiki/Selinux
<span class="m">4</span> : change <span class="s1">&#39;disable&#39;</span> to <span class="s1">&#39;no&#39;</span> in /etc/xinetd.d/tftp
<span class="m">5</span> : Some network boot-loaders are missing from /var/lib/cobbler/loaders, you may run <span class="s1">&#39;cobbler get-loaders&#39;</span> to download them, or, <span class="k">if</span> you only want to handle x86/x86_64 netbooting, you may ensure that you have installed a *recent* version of the syslinux package installed and can ignore this message entirely.  Files in this directory, should you want to support all architectures, should include pxelinux.0, menu.c32, elilo.efi, and yaboot. The <span class="s1">&#39;cobbler get-loaders&#39;</span> <span class="nb">command</span> is the easiest way to resolve these requirements.
<span class="m">6</span> : <span class="nb">enable</span> and start rsyncd.service with systemctl
<span class="m">7</span> : debmirror package is not installed, it will be required to manage debian deployments and repositories
<span class="m">8</span> : The default password used by the sample templates <span class="k">for</span> newly installed machines <span class="o">(</span>default_password_crypted in /etc/cobbler/settings<span class="o">)</span> is still <span class="nb">set</span> to <span class="s1">&#39;cobbler&#39;</span> and should be changed, try: <span class="s2">&quot;openssl passwd -1 -salt &#39;random-phrase-here&#39; &#39;your-password-here&#39;&quot;</span> to generate new one
<span class="m">9</span> : fencing tools were not found, and are required to use the <span class="o">(</span>optional<span class="o">)</span> power management features. install cman or fence-agents to use them

Restart cobblerd and <span class="k">then</span> run <span class="s1">&#39;cobbler sync&#39;</span> to apply changes.
</pre></div>
</div>
<p>上面提示了几个错误，主要总结下如下</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>server字段在/etc/cobbler/settings配置文件没有设置为本机的ip
next_server字段没有设置为指定ip
selinux是启用的（这个我们是关闭的，不管他）
启用tftp服务
运行cobbler get-loaders命令下载loader文件
启用rsyncd.service
debmirror包没有安装(我们不按照deb系统，这个就可以忽略了）
默认密码没有修改
fencing工具没有发现
我们没有自己配置dhcp服务，想让cobbler配置，我们修改manage_dhcp

修改完毕后重启cobblerd服务，使用cobbler sync同步。

接下来我们对这个上面的几个错误进行修改。
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cat settings  |grep &quot;^server&quot;</span>
server: <span class="m">127</span>.0.0.1
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># ip address show ens33 |grep inet</span>
    inet <span class="m">192</span>.168.46.7/24 brd <span class="m">192</span>.168.46.255 scope global ens33
    inet6 fe80::ce21:b5ad:bc87:8642/64 scope link
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># sed -i &#39;s@server: 127.0.0.1@server: 192.168.46.7@&#39; settings</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cat settings  |grep &quot;next_server&quot;</span>
next_server: <span class="m">192</span>.168.46.7
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># systemctl enable tftp</span>
Created symlink from /etc/systemd/system/sockets.target.wants/tftp.socket to /usr/lib/systemd/system/tftp.socket.
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># systemctl start tftp</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler get-loaders</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># systemctl start rsyncd.service</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># systemctl enable rsyncd</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/rsyncd.service to /usr/lib/systemd/system/rsyncd.service.
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cat settings  |grep &quot;^default_password_crypted&quot;</span>
default_password_crypted: <span class="s2">&quot;</span><span class="nv">$1$mF86</span><span class="s2">/UHC</span><span class="nv">$WvcIcX2t6crBz2onWxyac</span><span class="s2">.&quot;</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cat settings  |grep &quot;^default_password_crypted&quot;  -B 5</span>
<span class="c1"># default is &quot;cobbler&quot; and cobbler check will warn if</span>
<span class="c1"># this is not changed.</span>
<span class="c1"># The simplest way to change the password is to run</span>
<span class="c1"># openssl passwd -1</span>
<span class="c1"># and put the output between the &quot;&quot; below.</span>
default_password_crypted: <span class="s2">&quot;</span><span class="nv">$1$mF86</span><span class="s2">/UHC</span><span class="nv">$WvcIcX2t6crBz2onWxyac</span><span class="s2">.&quot;</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># openssl passwd -1</span>
Password:
Verifying - Password:
<span class="nv">$1$bwFRrz9M$sCpsiRXZ2zHzzLLa1nAzD1</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># sed -i &#39;s@$1$mF86/UHC$WvcIcX2t6crBz2onWxyac.@$1$bwFRrz9M$sCpsiRXZ2zHzzLLa1nAzD1@&#39; settings</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cat settings  |grep &quot;^default_password_crypted&quot;</span>
default_password_crypted: <span class="s2">&quot;</span><span class="nv">$1$bwFRrz9M$sCpsiRXZ2zHzzLLa1nAzD1</span><span class="s2">&quot;</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cat settings  |grep &quot;^manage_dhcp&quot;</span>
manage_dhcp: <span class="m">0</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># sed -i &#39;s@manage_dhcp: 0@manage_dhcp: 1@&#39; settings</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># systemctl restart cobblerd</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler check</span>
The following are potential configuration items that you may want to fix:

<span class="m">1</span> : SELinux is enabled. Please review the following wiki page <span class="k">for</span> details on ensuring cobbler works correctly in your SELinux environment:
    https://github.com/cobbler/cobbler/wiki/Selinux
<span class="m">2</span> : change <span class="s1">&#39;disable&#39;</span> to <span class="s1">&#39;no&#39;</span> in /etc/xinetd.d/tftp
<span class="m">3</span> : debmirror package is not installed, it will be required to manage debian deployments and repositories
<span class="m">4</span> : fencing tools were not found, and are required to use the <span class="o">(</span>optional<span class="o">)</span> power management features. install cman or fence-agents to use them

Restart cobblerd and <span class="k">then</span> run <span class="s1">&#39;cobbler sync&#39;</span> to apply changes.

<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># sed -i &#39;s@192.168.1@192.168.46@&#39; dhcp.template                                       # 这个模板文件根据自己的ip修改即可</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># systemctl restart cobblerd</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler sync</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>3.3.7. 导入镜像<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>我们在原有centos7光盘的基础上挂载一个centos6</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="m">8</span>:0    <span class="m">0</span>  200G  <span class="m">0</span> disk
├─sda1            <span class="m">8</span>:1    <span class="m">0</span>    1G  <span class="m">0</span> part /boot
└─sda2            <span class="m">8</span>:2    <span class="m">0</span>  199G  <span class="m">0</span> part
├─centos-root <span class="m">253</span>:0    <span class="m">0</span>   50G  <span class="m">0</span> lvm  /
├─centos-swap <span class="m">253</span>:1    <span class="m">0</span>    2G  <span class="m">0</span> lvm  <span class="o">[</span>SWAP<span class="o">]</span>
└─centos-home <span class="m">253</span>:2    <span class="m">0</span>  147G  <span class="m">0</span> lvm  /home
sr0              <span class="m">11</span>:0    <span class="m">1</span>  <span class="m">8</span>.1G  <span class="m">0</span> rom
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># for i in `find /sys/devices -name scan` ; do echo &quot;- - -&quot; &gt; $i ; done</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="m">8</span>:0    <span class="m">0</span>  200G  <span class="m">0</span> disk
├─sda1            <span class="m">8</span>:1    <span class="m">0</span>    1G  <span class="m">0</span> part /boot
└─sda2            <span class="m">8</span>:2    <span class="m">0</span>  199G  <span class="m">0</span> part
├─centos-root <span class="m">253</span>:0    <span class="m">0</span>   50G  <span class="m">0</span> lvm  /
├─centos-swap <span class="m">253</span>:1    <span class="m">0</span>    2G  <span class="m">0</span> lvm  <span class="o">[</span>SWAP<span class="o">]</span>
└─centos-home <span class="m">253</span>:2    <span class="m">0</span>  147G  <span class="m">0</span> lvm  /home
sr0              <span class="m">11</span>:0    <span class="m">1</span>  <span class="m">8</span>.1G  <span class="m">0</span> rom
sr1              <span class="m">11</span>:1    <span class="m">1</span>  <span class="m">5</span>.8G  <span class="m">0</span> rom

<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># mkdir /mnt/centos{6,7}</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># mount /dev/sr0 /mnt/centos7</span>
mount: /dev/sr0 is write-protected, mounting read-only
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># mount /dev/sr1 /mnt/centos6/</span>
mount: /dev/sr1 is write-protected, mounting read-only

<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler import --name centos-6.9-x86_64 --arch=x86_64 --path /mnt/centos6/</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler import --name centos-7.4-x86_64 --arch=x86_64 --path /mnt/centos7/</span>

<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler profile list</span>
centos-6.9-i386
centos-6.9-x86_64
centos-7.4-x86_64
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler profile remove centos-6.9-i386</span>
--name is required
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler profile remove --name centos-6.9-i386</span>
<span class="o">[</span>root@localhost cobbler<span class="o">]</span><span class="c1"># cobbler profile list</span>
centos-6.9-x86_64
centos-7.4-x86_64
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果想使用自己的ks文件，可以在import的时候指定–kickstart=绝对路径的ks位置。</p>
</div>
</div>
<div class="section" id="id7">
<h4>3.3.8. 系统网络安装<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>进入bios设置启动项目硬盘第一个，cdrom第二个，网络第三个即可。</p>
<p>安装菜单页面：</p>
<img alt="_images/cobbler启动界面.png" src="_images/cobbler启动界面.png" />
</div>
<div class="section" id="web">
<h4>3.3.9. 关于web界面的<a class="headerlink" href="#web" title="Permalink to this headline">¶</a></h4>
<p>web的额外配置</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost html<span class="o">]</span><span class="c1"># vim /etc/cobbler/modules.conf</span>
<span class="c1"># 修改如下信息</span>
<span class="nv">module</span> <span class="o">=</span> authn_pam
<span class="o">[</span>root@localhost html<span class="o">]</span><span class="c1"># yum install cobbler-web</span>
<span class="o">[</span>root@localhost html<span class="o">]</span><span class="c1"># service cobblerd restart</span>
<span class="o">[</span>root@localhost html<span class="o">]</span><span class="c1"># useradd cobbler</span>
<span class="o">[</span>root@localhost html<span class="o">]</span><span class="c1"># passwd cobbler</span>
<span class="o">[</span>root@localhost html<span class="o">]</span><span class="c1"># vim /etc/cobbler/users.conf</span>
<span class="c1"># 修改admin=创建的用户</span>
<span class="nv">admin</span> <span class="o">=</span> <span class="s2">&quot;cobbler&quot;</span>
</pre></div>
</div>
<p>访问测试</p>
<p>浏览器输入https://192.168.46.6/cobbler_web</p>
<p>登陆图：</p>
<img alt="_images/web登陆界面.png" src="_images/web登陆界面.png" />
<p>主页：</p>
<img alt="_images/web主界面.png" src="_images/web主界面.png" />
</div>
</div>
</div>
</div>
<span id="document-自动化运维/index"></span><div class="section" id="id1">
<h2>4. 自动化运维<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-自动化运维/pssh"></span><div class="section" id="pssh">
<h3>4.1. pssh<a class="headerlink" href="#pssh" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>4.1.1. pssh简介<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>pssh命令是一个python编写可以在多台服务器上执行命令的工具，同时支持拷贝文件，
使用必须在各个服务器上配置好密钥认证访问。</p>
</div>
<div class="section" id="id2">
<h4>4.1.2. pssh的安装<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># yum install pssh</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># rpm -ql pssh |grep bin</span>
/usr/bin/pnuke                      <span class="c1"># 并行在远程主机杀进程</span>
/usr/bin/prsync                     <span class="c1"># 使用rsync协议从本地同步数据</span>
/usr/bin/pscp.pssh                  <span class="c1"># 本地文件复制到多个主机上</span>
/usr/bin/pslurp                     <span class="c1"># 把多个远程主机的问题拉到本机</span>
/usr/bin/pssh                       <span class="c1"># 多主机并行运行命令</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>4.1.3. 准备工作<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id4">
<h5>4.1.3.1. 主机信任<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>我这里测试有3个机器，ip分别是192.168.46.7，192.168.46.101，192.168.46.102,
我想在7的机器上可以控制这三个机器，包括自己的机器。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># ssh-keygen                   # 这个命令在3个主机上面都执行一次</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># ssh-copy-id  -i /root/.ssh/id_rsa.pub 192.168.46.7   # 添加信任，可以免密码到7</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># ssh-copy-id  -i /root/.ssh/id_rsa.pub 192.168.46.101 # 添加信任，可以免密码到101</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># ssh-copy-id  -i /root/.ssh/id_rsa.pub 192.168.46.102 # 添加信任，可以免密码到102</span>
</pre></div>
</div>
<p>新建主机配置文件</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># echo 192.168.46.7 &gt;&gt;/root/hosts.txt</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># echo 192.168.46.101 &gt;&gt;/root/hosts.txt</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># echo 192.168.46.102 &gt;&gt;/root/hosts.txt</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># cat /root/hosts.txt</span>
<span class="m">192</span>.168.46.7
<span class="m">192</span>.168.46.101
<span class="m">192</span>.168.46.102
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h4>4.1.4. 命令的使用<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id6">
<h5>4.1.4.1. pssh<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p>命令使用：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pssh --help</span>
Usage: pssh <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="nb">command</span> <span class="o">[</span>...<span class="o">]</span>

Options:
--version                                       <span class="c1"># 显示程序版本并退出</span>
--help                                          <span class="c1"># 获取帮助信息</span>
-h HOST_FILE, --hosts<span class="o">=</span>HOST_FILE                 <span class="c1"># 主机文件，每行是&quot;[user@]host[:port]&quot;，如果有主机互信，只要ip即可。</span>
-H HOST_STRING, --host<span class="o">=</span>HOST_STRING              <span class="c1"># 主机字符串</span>
-l USER, --user<span class="o">=</span>USER  username <span class="o">(</span>OPTIONAL<span class="o">)</span>       <span class="c1"># 指定用户</span>
-p PAR, --par<span class="o">=</span>PAR                               <span class="c1"># 最大并行度</span>
-o OUTDIR, --outdir<span class="o">=</span>OUTDIR                      <span class="c1"># 标准输出目录</span>
-e ERRDIR, --errdir<span class="o">=</span>ERRDIR                      <span class="c1"># 错误输出目录</span>
-t TIMEOUT, --timeout<span class="o">=</span>TIMEOUT                   <span class="c1"># 超时时间</span>
-O OPTION, --option<span class="o">=</span>OPTION                      <span class="c1"># ssh选项</span>
-v, --verbose                                   <span class="c1"># 信息详细</span>
-A, --askpass                                   <span class="c1"># 询问密码，如果没有配置主机信任，这个就需要指定</span>
-i,--inline                                     <span class="c1"># 每个服务器内部处理信息输出</span>

样例使用: pssh -h hosts.txt -l irb2 -o /tmp/foo uptime
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># -H ,-i使用</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pssh -H &quot;192.168.46.101&quot; -i ls              #</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">22</span>:30:42 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.101
anaconda-ks.cfg
backup.tar.bz2
findresults
foo.sh
kernel-3.10.0-693.11.1.el7.x86_64.rpm
mkusers
userlist
<span class="c1"># -h，-O使用</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># mkdir pssh</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pssh -h /root/hosts.txt -o /root/pssh/  &#39;uptime&#39;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">22</span>:36:04 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.101
<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="m">22</span>:36:04 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.7
<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="m">22</span>:36:14 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.102
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># tree /root/pssh/</span>
/root/pssh/
├── <span class="m">192</span>.168.46.101
├── <span class="m">192</span>.168.46.102
└── <span class="m">192</span>.168.46.7
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># cat /root/pssh/192.168.46.101</span>
<span class="m">09</span>:36:04 up <span class="m">14</span>:29,  <span class="m">2</span> users,  load average: <span class="m">0</span>.05, <span class="m">0</span>.04, <span class="m">0</span>.05
</pre></div>
</div>
</div>
<div class="section" id="pscp-pssh">
<h5>4.1.4.2. pscp.pssh<a class="headerlink" href="#pscp-pssh" title="Permalink to this headline">¶</a></h5>
<p>命令使用</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pscp.pssh  --help</span>
Usage: pscp.pssh <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="nb">local</span> remote
</pre></div>
</div>
<p>样例：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pscp.pssh  -h /root/hosts.txt file1 /root    # 文件复制到远程</span>
</pre></div>
</div>
</div>
<div class="section" id="pslurp">
<h5>4.1.4.3. pslurp<a class="headerlink" href="#pslurp" title="Permalink to this headline">¶</a></h5>
<p>命令使用</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pslurp --help</span>
Usage: pslurp <span class="o">[</span>OPTIONS<span class="o">]</span> remote <span class="nb">local</span>
</pre></div>
</div>
<p>样例：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pslurp -h /root/hosts.txt  /var/log/messages .       # 复制远程的日志文件到当前目录</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">22</span>:46:36 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.101
<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="m">22</span>:46:36 <span class="o">[</span>FAILURE<span class="o">]</span> <span class="m">192</span>.168.46.7 Exited with error code <span class="m">1</span>
<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="m">22</span>:46:46 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.102
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># tree 192.168.46.*                                   # 查看下</span>
<span class="m">192</span>.168.46.101
└── messages
<span class="m">192</span>.168.46.102
└── messages
<span class="m">192</span>.168.46.7 <span class="o">[</span>error opening dir<span class="o">]</span>
</pre></div>
</div>
<p>0 directories, 2 files</p>
</div>
<div class="section" id="prsync">
<h5>4.1.4.4. prsync<a class="headerlink" href="#prsync" title="Permalink to this headline">¶</a></h5>
<p>命令使用</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># prsync --help</span>
Usage: prsync <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="nb">local</span> remote
</pre></div>
</div>
<p>样例：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pssh -h /root/hosts.txt  -P &#39;mkdir /tmp/etc&#39;                 # 远程创建目录</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">22</span>:51:08 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.101
<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="m">22</span>:51:08 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.7
<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="m">22</span>:51:18 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.102
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># prsync -h /root/hosts.txt  -a -r  /etc/sysconfig /tmp/etc   # 推送过去</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">22</span>:51:57 <span class="o">[</span>FAILURE<span class="o">]</span> <span class="m">192</span>.168.46.101 Exited with error code <span class="m">127</span>
<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="m">22</span>:51:57 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.7
<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="m">22</span>:52:07 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.102
</pre></div>
</div>
</div>
<div class="section" id="pnuke">
<h5>4.1.4.5. pnuke<a class="headerlink" href="#pnuke" title="Permalink to this headline">¶</a></h5>
<p>命令使用</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pnuke --help</span>
Usage: pnuke <span class="o">[</span>OPTIONS<span class="o">]</span> pattern
</pre></div>
</div>
<p>样例：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># pnuke -h /root/hosts.txt  httpd                     # 关闭所有httpd进程</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">22</span>:48:26 <span class="o">[</span>FAILURE<span class="o">]</span> <span class="m">192</span>.168.46.7 Exited with error code <span class="m">1</span>
<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="m">22</span>:48:26 <span class="o">[</span>SUCCESS<span class="o">]</span> <span class="m">192</span>.168.46.101
<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="m">22</span>:48:36 <span class="o">[</span>FAILURE<span class="o">]</span> <span class="m">192</span>.168.46.102 Exited with error code <span class="m">1</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-自动化运维/pexpect"></span><div class="section" id="pexpect">
<h3>4.2. pexpect<a class="headerlink" href="#pexpect" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-自动化运维/paramiko"></span><div class="section" id="paramiko">
<h3>4.3. paramiko<a class="headerlink" href="#paramiko" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-自动化运维/fabric"></span><div class="section" id="fabric">
<h3>4.4. fabric<a class="headerlink" href="#fabric" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-自动化运维/ansible"></span><div class="section" id="ansible">
<h3>4.5. ansible<a class="headerlink" href="#ansible" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>4.5.1. ansible特性<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>模块化：调用特定的模块，完成特定任务</li>
<li>有Paramiko，PyYAML，Jinja2（模板语言）三个关键模块</li>
<li>支持自定义模块</li>
<li>基于Python语言实现</li>
<li>部署简单，基于python和SSH(默认已安装)，agentless</li>
<li>安全，基于OpenSSH</li>
<li>支持playbook编排任务</li>
<li>幂等性：一个任务执行1遍和执行n遍效果一样，不因重复执行带来意外情况</li>
<li>无需代理不依赖PKI（无需ssl）</li>
<li>可使用任何编程语言写模块</li>
<li>YAML格式，编排任务，支持丰富的数据结构</li>
<li>较强大的多层解决方案</li>
</ul>
</div>
<div class="section" id="id2">
<h4>4.5.2. ansible架构<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<img alt="_images/架构图.png" src="_images/架构图.png" />
</div>
<div class="section" id="id3">
<h4>4.5.3. ansible工作原理<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<img alt="_images/工作原理.png" src="_images/工作原理.png" />
</div>
<div class="section" id="id4">
<h4>4.5.4. 安装软件包<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># yum install ansible -y</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># rpm -ql ansible</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>4.5.5. 添加管理主机和修改配置文件<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim /etc/ansible/hosts</span>
<span class="c1"># 添加我们管理的主机</span>
<span class="o">[</span>db<span class="o">]</span>
<span class="m">192</span>.168.46.6
<span class="o">[</span>web<span class="o">]</span>
<span class="m">172</span>.168.46.<span class="o">[</span><span class="m">6</span>-7<span class="o">]</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim /etc/ansible/ansible.cfg</span>
<span class="c1"># 去除以下2行的注释</span>
<span class="nv">host_key_checking</span> <span class="o">=</span> False
<span class="nv">log_path</span> <span class="o">=</span> /var/log/ansible.log
</pre></div>
</div>
<p>hosts文件指定的db,web就是各自包含的主机统称，内置一个all变量代表所有主机。</p>
<p>host_key_checking 这个就是主机key检查，我们默认使用ssh连接一个主机会提示yes/no的提示，就是信任这个主机的key。</p>
</div>
<div class="section" id="id6">
<h4>4.5.6. 使用ansible模块<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>查看ansible模块的个数</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc  -l  | wc -l</span>
<span class="m">1378</span>
</pre></div>
</div>
<p>获取指定模块使用帮助</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc ping</span>
</pre></div>
</div>
<div class="section" id="ping">
<h5>4.5.6.1. ping<a class="headerlink" href="#ping" title="Permalink to this headline">¶</a></h5>
<p>功能： ping主机</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible all -m ping</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> UNREACHABLE! <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Failed to connect to the host via ssh: ssh: connect to host 172.18.46.7 port 22: Connection timed out\r\n&quot;</span>,
    <span class="s2">&quot;unreachable&quot;</span>: <span class="nb">true</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> UNREACHABLE! <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Failed to connect to the host via ssh: ssh: connect to host 172.18.46.6 port 22: Connection timed out\r\n&quot;</span>,
    <span class="s2">&quot;unreachable&quot;</span>: <span class="nb">true</span>
<span class="o">}</span>
</pre></div>
</div>
<p>上面我们的出错了。 是因为我们没有配置ssh免密码登陆的原因。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果不想配置主机信任，使用ansibile需要配合-k选项输入密码，
如果使用了sudo需要再配合-K选项输入sudo密码</p>
</div>
<p>配置ssh免密码登陆：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ssh-keygen</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ssh-copy-id  172.18.46.6</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ssh-copy-id  172.18.46.7</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ssh-copy-id  192.168.46.6</span>
</pre></div>
</div>
<p>再次执行</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible all -m ping</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这个ping模块不是走的icmp协议，走的ssh协议。</p>
</div>
</div>
<div class="section" id="command">
<h5>4.5.6.2. command<a class="headerlink" href="#command" title="Permalink to this headline">¶</a></h5>
<p>功能： 执行command</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc command</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db  -m command -a &#39;chdir=/root ls&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> SUCCESS <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
anaconda-ks.cfg
anaconda-ks.cfg.bak
install.log
install.log.syslog
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">在命令中使用了”&lt;”, “&gt;”, “|”, “;”和”&amp;”符号的时候，需要改用shell模块的。</p>
</div>
</div>
<div class="section" id="shell">
<h5>4.5.6.3. shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h5>
<p>功能： 执行远程shell命令。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc shell</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m shell -a &#39;cd /root; ls -l ; touch test.txt ; ls -l;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="script">
<h5>4.5.6.4. script<a class="headerlink" href="#script" title="Permalink to this headline">¶</a></h5>
<p>功能： 复制本地的脚本到远程，并执行，然后删除脚本</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc script</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m script -a &#39;/root/test.sh&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;rc&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;stderr&quot;</span>: <span class="s2">&quot;Shared connection to 192.168.46.6 closed.\r\n&quot;</span>,
    <span class="s2">&quot;stdout&quot;</span>: <span class="s2">&quot;Fri Jan 12 22:47:41 CST 2018\r\nFilesystem            Size  Used Avail Use% Mounted on\r\n/dev/mapper/VolGroup-lv_root\r\n                       50G   19G   29G  40% /\r\ntmpfs                 491M     0  491M   0% /dev/shm\r\n/dev/sda1             477M   34M  418M   8% /boot\r\n/dev/mapper/VolGroup-lv_home\r\n                      146G   60M  138G   1% /home\r\n/dev/sr0              5.8G  5.8G     0 100% /mnt/cdrom\r\n&quot;</span>,
    <span class="s2">&quot;stdout_lines&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;Fri Jan 12 22:47:41 CST 2018&quot;</span>,
        <span class="s2">&quot;Filesystem            Size  Used Avail Use% Mounted on&quot;</span>,
        <span class="s2">&quot;/dev/mapper/VolGroup-lv_root&quot;</span>,
        <span class="s2">&quot;                       50G   19G   29G  40% /&quot;</span>,
        <span class="s2">&quot;tmpfs                 491M     0  491M   0% /dev/shm&quot;</span>,
        <span class="s2">&quot;/dev/sda1             477M   34M  418M   8% /boot&quot;</span>,
        <span class="s2">&quot;/dev/mapper/VolGroup-lv_home&quot;</span>,
        <span class="s2">&quot;                      146G   60M  138G   1% /home&quot;</span>,
        <span class="s2">&quot;/dev/sr0              5.8G  5.8G     0 100% /mnt/cdrom&quot;</span>
    <span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="copy">
<h5>4.5.6.5. copy<a class="headerlink" href="#copy" title="Permalink to this headline">¶</a></h5>
<p>功能： 复制本地的文件到远程去</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m copy -a &#39;src=/root/test.sh dest=/root/test.sh backup=yes owner=zhaojiedi group=root mode=0644&#39;</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;checksum&quot;</span>: <span class="s2">&quot;c3724e329cc83de9876f2d379065ca463e858ae6&quot;</span>,
    <span class="s2">&quot;dest&quot;</span>: <span class="s2">&quot;/root/test.sh&quot;</span>,
    <span class="s2">&quot;gid&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;root&quot;</span>,
    <span class="s2">&quot;md5sum&quot;</span>: <span class="s2">&quot;220f72b1a4e636373d4b9310569cf027&quot;</span>,
    <span class="s2">&quot;mode&quot;</span>: <span class="s2">&quot;0644&quot;</span>,
    <span class="s2">&quot;owner&quot;</span>: <span class="s2">&quot;zhaojiedi&quot;</span>,
    <span class="s2">&quot;size&quot;</span>: <span class="m">11</span>,
    <span class="s2">&quot;src&quot;</span>: <span class="s2">&quot;/root/.ansible/tmp/ansible-tmp-1515809310.86-157163266332298/source&quot;</span>,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;file&quot;</span>,
    <span class="s2">&quot;uid&quot;</span>: <span class="m">500</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;checksum&quot;</span>: <span class="s2">&quot;c3724e329cc83de9876f2d379065ca463e858ae6&quot;</span>,
    <span class="s2">&quot;dest&quot;</span>: <span class="s2">&quot;/root/test.sh&quot;</span>,
    <span class="s2">&quot;gid&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;root&quot;</span>,
    <span class="s2">&quot;md5sum&quot;</span>: <span class="s2">&quot;220f72b1a4e636373d4b9310569cf027&quot;</span>,
    <span class="s2">&quot;mode&quot;</span>: <span class="s2">&quot;0644&quot;</span>,
    <span class="s2">&quot;owner&quot;</span>: <span class="s2">&quot;zhaojiedi&quot;</span>,
    <span class="s2">&quot;secontext&quot;</span>: <span class="s2">&quot;system_u:object_r:admin_home_t:s0&quot;</span>,
    <span class="s2">&quot;size&quot;</span>: <span class="m">11</span>,
    <span class="s2">&quot;src&quot;</span>: <span class="s2">&quot;/root/.ansible/tmp/ansible-tmp-1515809310.9-111150527159897/source&quot;</span>,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;file&quot;</span>,
    <span class="s2">&quot;uid&quot;</span>: <span class="m">1000</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="fetch">
<h5>4.5.6.6. fetch<a class="headerlink" href="#fetch" title="Permalink to this headline">¶</a></h5>
<p>功能： 提取远程主机的文件到本地</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># mkdir /app</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible all -m fetch -a &#39;src=/var/log/messages dest=/app&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;checksum&quot;</span>: <span class="s2">&quot;6651f324a541ddd5d3a52603353785751743610f&quot;</span>,
    <span class="s2">&quot;dest&quot;</span>: <span class="s2">&quot;/app/192.168.46.6/var/log/messages&quot;</span>,
    <span class="s2">&quot;md5sum&quot;</span>: <span class="s2">&quot;1d98b389a9644276cd5c42259af2471f&quot;</span>,
    <span class="s2">&quot;remote_checksum&quot;</span>: <span class="s2">&quot;6651f324a541ddd5d3a52603353785751743610f&quot;</span>,
    <span class="s2">&quot;remote_md5sum&quot;</span>: null
<span class="o">}</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;checksum&quot;</span>: <span class="s2">&quot;3d69d7fe50ad1166782cd962f352782088c2eb6b&quot;</span>,
    <span class="s2">&quot;dest&quot;</span>: <span class="s2">&quot;/app/172.18.46.7/var/log/messages&quot;</span>,
    <span class="s2">&quot;md5sum&quot;</span>: <span class="s2">&quot;fa3859cc24a7ff717741ae7d043a7134&quot;</span>,
    <span class="s2">&quot;remote_checksum&quot;</span>: <span class="s2">&quot;3d69d7fe50ad1166782cd962f352782088c2eb6b&quot;</span>,
    <span class="s2">&quot;remote_md5sum&quot;</span>: null
<span class="o">}</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;checksum&quot;</span>: <span class="s2">&quot;36ca673a1fe553d3607e1540b6d3f72ac2ebde6b&quot;</span>,
    <span class="s2">&quot;dest&quot;</span>: <span class="s2">&quot;/app/172.18.46.6/var/log/messages&quot;</span>,
    <span class="s2">&quot;md5sum&quot;</span>: <span class="s2">&quot;a60aa16df60e68a36f7c29a4c60badf8&quot;</span>,
    <span class="s2">&quot;remote_checksum&quot;</span>: <span class="s2">&quot;36ca673a1fe553d3607e1540b6d3f72ac2ebde6b&quot;</span>,
    <span class="s2">&quot;remote_md5sum&quot;</span>: null
<span class="o">}</span>

<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># tree /app</span>
/app
├── <span class="m">172</span>.18.46.6
│   └── var
│       └── log
│           └── messages
├── <span class="m">172</span>.18.46.7
│   └── var
│       └── log
│           └── messages
└── <span class="m">192</span>.168.46.6
    └── var
</pre></div>
</div>
<p>可以看出来，这个功能还是相当nice的， 自动帮我们分类整理好了。</p>
</div>
<div class="section" id="file">
<h5>4.5.6.7. file<a class="headerlink" href="#file" title="Permalink to this headline">¶</a></h5>
<p>功能： 文件管理的</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 创建文件</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m file -a &#39;path=/root/testfile state=touch mode=644 owner=root group=root &#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;dest&quot;</span>: <span class="s2">&quot;/root/testfile&quot;</span>,
    <span class="s2">&quot;gid&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;group&quot;</span>: <span class="s2">&quot;root&quot;</span>,
    <span class="s2">&quot;mode&quot;</span>: <span class="s2">&quot;0644&quot;</span>,
    <span class="s2">&quot;owner&quot;</span>: <span class="s2">&quot;root&quot;</span>,
    <span class="s2">&quot;size&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;file&quot;</span>,
    <span class="s2">&quot;uid&quot;</span>: <span class="m">0</span>
<span class="o">}</span>
<span class="c1"># 创建软连接</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m file -a &#39;path=/root/testfile.link state=link src=/root/testfile&#39;</span>
<span class="c1"># 查看软连接</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -a &#39;ls -l  /root/&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> SUCCESS <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
total <span class="m">24</span>
-rw-------. <span class="m">1</span> root root <span class="m">1300</span> Jan <span class="m">10</span> <span class="m">22</span>:10 anaconda-ks.cfg
-rw-------. <span class="m">1</span> root root <span class="m">1196</span> Jan <span class="m">10</span> <span class="m">21</span>:25 anaconda-ks.cfg.bak
-rw-r--r--. <span class="m">1</span> root root <span class="m">9919</span> Jan <span class="m">10</span> <span class="m">16</span>:57 install.log
-rw-r--r--. <span class="m">1</span> root root <span class="m">3161</span> Jan <span class="m">10</span> <span class="m">16</span>:56 install.log.syslog
-rw-r--r--  <span class="m">1</span> root root    <span class="m">0</span> Jan <span class="m">13</span> <span class="m">00</span>:04 testfile
lrwxrwxrwx  <span class="m">1</span> root root   <span class="m">14</span> Jan <span class="m">13</span> <span class="m">00</span>:05 testfile.link -&gt; /root/testfile
<span class="c1"># 删除文件</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m file -a &#39;path=/root/testfile state=absent&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;path&quot;</span>: <span class="s2">&quot;/root/testfile&quot;</span>,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;absent&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>file模块的state主要有下面几个值</p>
<ul class="simple">
<li>directory</li>
<li>file</li>
<li>link</li>
<li>absent</li>
<li>hard</li>
<li>touch</li>
</ul>
</div>
<div class="section" id="hostname">
<h5>4.5.6.8. hostname<a class="headerlink" href="#hostname" title="Permalink to this headline">¶</a></h5>
<p>功能修改hostname</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc hostname</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible 172.18.46.6 -m hostname  -a &quot;name=centos6.linuxpanda.tech&quot;</span>
</pre></div>
</div>
<p>hostname模块可以修改同时修改当前和文件的hostname的值。</p>
</div>
<div class="section" id="cron">
<h5>4.5.6.9. cron<a class="headerlink" href="#cron" title="Permalink to this headline">¶</a></h5>
<p>功能：计划任务管理</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 添加计划任务</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m cron  -a &#39;minute=*/5  weekday=1,3,5 job=&quot;ntpdate 172.18.0.1&quot; name=&quot;update time&quot; &#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;envs&quot;</span>: <span class="o">[]</span>,
    <span class="s2">&quot;jobs&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;update time&quot;</span>
    <span class="o">]</span>
<span class="o">}</span>
<span class="c1"># 查看下</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m shell -a &#39;crontab -l&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> SUCCESS <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
<span class="c1">#Ansible: update time</span>
*/5 * * * <span class="m">1</span>,3,5 ntpdate <span class="m">172</span>.18.0.1

<span class="c1"># 删除</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m cron -a &#39;job=&quot;ntpdate 172.18.0.1&quot; name=&quot;update time&quot; state=absent&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;envs&quot;</span>: <span class="o">[]</span>,
    <span class="s2">&quot;jobs&quot;</span>: <span class="o">[]</span>
<span class="o">}</span>

<span class="c1"># 再次查看</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible db -m shell -a &#39;crontab -l&#39;</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> SUCCESS <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</pre></div>
</div>
<p>我们可以设置disabled属性为yes/no，来启用计划任务和关闭计划任务。</p>
</div>
<div class="section" id="yum">
<h5>4.5.6.10. yum<a class="headerlink" href="#yum" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 安装包</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m yum -a &#39;name=httpd&#39;</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;&quot;</span>,
    <span class="s2">&quot;rc&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;results&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;httpd-2.4.6-67.el7.centos.6.x86_64 providing httpd is already installed&quot;</span>
    <span class="o">]</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;&quot;</span>,
    <span class="s2">&quot;rc&quot;</span>: <span class="m">0</span>,
    <span class="s2">&quot;results&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;httpd-2.2.15-60.el6.centos.6.x86_64 providing httpd is already installed&quot;</span>
    <span class="o">]</span>
<span class="o">}</span>

<span class="c1"># 卸载包</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m yum -a &#39;name=httpd state=absent&#39;</span>

<span class="c1"># 安装最新版本且禁用gpg检查</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m yum -a &#39;name=httpd state=latest disable_gpg_check=yes&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="service">
<h5>4.5.6.11. service<a class="headerlink" href="#service" title="Permalink to this headline">¶</a></h5>
<p>功能： 服务管理</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-doc service</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m service -a &#39;name=httpd  state=started&#39;</span>
</pre></div>
</div>
<p>service的状态比较多：</p>
<ul class="simple">
<li>started</li>
<li>stop</li>
<li>restarted</li>
<li>reloaded</li>
</ul>
</div>
<div class="section" id="user">
<h5>4.5.6.12. user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h5>
<p>功能： 用户管理</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 创建用户</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m user -a &#39;name=test1 comment=&quot;test1&quot; uid=1005 shell=&quot;/bin/bash&quot; groups=root append=yes createhome=yes&#39;</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> FAILED! <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;usermod: UID &#39;1005&#39; already exists\n&quot;</span>,
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;test1&quot;</span>,
    <span class="s2">&quot;rc&quot;</span>: <span class="m">4</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;comment&quot;</span>: <span class="s2">&quot;test1&quot;</span>,
    <span class="s2">&quot;createhome&quot;</span>: true,
    <span class="s2">&quot;group&quot;</span>: <span class="m">1005</span>,
    <span class="s2">&quot;groups&quot;</span>: <span class="s2">&quot;root&quot;</span>,
    <span class="s2">&quot;home&quot;</span>: <span class="s2">&quot;/home/test1&quot;</span>,
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;test1&quot;</span>,
    <span class="s2">&quot;shell&quot;</span>: <span class="s2">&quot;/bin/bash&quot;</span>,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;present&quot;</span>,
    <span class="s2">&quot;system&quot;</span>: false,
    <span class="s2">&quot;uid&quot;</span>: <span class="m">1005</span>
<span class="o">}</span>
<span class="c1"># 删除用户</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible web -m user -a &#39;name=test1 comment=&quot;test1&quot; state=absent force=yes &#39;</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;force&quot;</span>: true,
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;test1&quot;</span>,
    <span class="s2">&quot;remove&quot;</span>: false,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;absent&quot;</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: true,
    <span class="s2">&quot;force&quot;</span>: true,
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;test1&quot;</span>,
    <span class="s2">&quot;remove&quot;</span>: false,
    <span class="s2">&quot;state&quot;</span>: <span class="s2">&quot;absent&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="setup">
<h5>4.5.6.13. setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>功能： 查看主机信息</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1">#  ansible all  -m setup -a &#39;filter=&quot;*version*&quot;&#39;</span>
<span class="m">192</span>.168.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;ansible_facts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;ansible_bios_version&quot;</span>: <span class="s2">&quot;6.00&quot;</span>,
        <span class="s2">&quot;ansible_distribution_major_version&quot;</span>: <span class="s2">&quot;7&quot;</span>,
        <span class="s2">&quot;ansible_distribution_version&quot;</span>: <span class="s2">&quot;7.4.1708&quot;</span>,
        <span class="s2">&quot;ansible_product_version&quot;</span>: <span class="s2">&quot;None&quot;</span>,
        <span class="s2">&quot;ansible_python_version&quot;</span>: <span class="s2">&quot;2.7.5&quot;</span>
    <span class="o">}</span>,
    <span class="s2">&quot;changed&quot;</span>: <span class="nb">false</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;ansible_facts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;ansible_bios_version&quot;</span>: <span class="s2">&quot;6.00&quot;</span>,
        <span class="s2">&quot;ansible_distribution_major_version&quot;</span>: <span class="s2">&quot;7&quot;</span>,
        <span class="s2">&quot;ansible_distribution_version&quot;</span>: <span class="s2">&quot;7.4.1708&quot;</span>,
        <span class="s2">&quot;ansible_product_version&quot;</span>: <span class="s2">&quot;None&quot;</span>,
        <span class="s2">&quot;ansible_python_version&quot;</span>: <span class="s2">&quot;2.7.5&quot;</span>
    <span class="o">}</span>,
    <span class="s2">&quot;changed&quot;</span>: <span class="nb">false</span>
<span class="o">}</span>
<span class="m">172</span>.18.46.6 <span class="p">|</span> UNREACHABLE! <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Failed to connect to the host via ssh: ssh: connect to host 172.18.46.6 port 22: No route to host\r\n&quot;</span>,
    <span class="s2">&quot;unreachable&quot;</span>: <span class="nb">true</span>
<span class="o">}</span>
<span class="m">192</span>.168.46.6 <span class="p">|</span> UNREACHABLE! <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;msg&quot;</span>: <span class="s2">&quot;Failed to connect to the host via ssh: ssh: connect to host 192.168.46.6 port 22: No route to host\r\n&quot;</span>,
    <span class="s2">&quot;unreachable&quot;</span>: <span class="nb">true</span>
<span class="o">}</span>
</pre></div>
</div>
<p>setup模块提供了远程主机的信息， 我们后面可以使用这个信息做分支处理的。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">setup模块提供的的信息都是内置变量，方便我们引用变量。</p>
</div>
</div>
</div>
<div class="section" id="galaxy">
<h4>4.5.7. galaxy的使用<a class="headerlink" href="#galaxy" title="Permalink to this headline">¶</a></h4>
<p>别人写好的剧本，你感觉不错也挺适合你的工作环境的，可以下载下来简单修改下就使用的。</p>
<p>我们首先在 <a class="reference external" href="https://galaxy.ansible.com/explore#/">galaxy</a> 上下载获取一个地址</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible-galaxy install geerlingguy.nginx</span>
- downloading role <span class="s1">&#39;nginx&#39;</span>, owned by geerlingguy
- downloading role from https://github.com/geerlingguy/ansible-role-nginx/archive/2.5.0.tar.gz

- extracting geerlingguy.nginx to /root/.ansible/roles/geerlingguy.nginx
- geerlingguy.nginx <span class="o">(</span><span class="m">2</span>.5.0<span class="o">)</span> was installed successfully
</pre></div>
</div>
</div>
<div class="section" id="playbook">
<h4>4.5.8. playbook的基础使用<a class="headerlink" href="#playbook" title="Permalink to this headline">¶</a></h4>
<div class="section" id="hello-world">
<h5>4.5.8.1. hello world<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># mkdir ansible</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># cd ansible/</span>

<span class="c1"># 编辑一个playbook</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim helloworld.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat helloworld.yml</span>
---

- hosts: all
remote_user: root

tasks:
    - name: hello world
    command: <span class="nb">echo</span> <span class="s2">&quot;hello world&quot;</span>

<span class="c1"># 检查</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook helloworld.yml  -C</span>

PLAY <span class="o">[</span>all<span class="o">]</span> **********************************************************************************************************************

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> **********************************************************************************************************
ok: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>

TASK <span class="o">[</span>hello world<span class="o">]</span> **************************************************************************************************************
skipping: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
skipping: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>
skipping: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>

PLAY RECAP **********************************************************************************************************************
<span class="m">172</span>.18.46.6                : <span class="nv">ok</span><span class="o">=</span><span class="m">1</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">172</span>.18.46.7                : <span class="nv">ok</span><span class="o">=</span><span class="m">1</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">192</span>.168.46.6               : <span class="nv">ok</span><span class="o">=</span><span class="m">1</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>

<span class="c1"># 执行</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook helloworld.yml</span>

PLAY <span class="o">[</span>all<span class="o">]</span> **********************************************************************************************************************

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> **********************************************************************************************************
ok: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>

TASK <span class="o">[</span>hello world<span class="o">]</span> **************************************************************************************************************
changed: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
changed: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>
changed: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>

PLAY RECAP **********************************************************************************************************************
<span class="m">172</span>.18.46.6                : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">172</span>.18.46.7                : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">192</span>.168.46.6               : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>4.5.8.2. 安装服务并启动服务<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim helloworld.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat helloworld.yml</span>
---

- hosts: all
remote_user: root

tasks:
    - name: hello world
    command: <span class="nb">echo</span> <span class="s2">&quot;hello world&quot;</span>

<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook helloworld.yml</span>

PLAY <span class="o">[</span>all<span class="o">]</span> **********************************************************************************************************************

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> **********************************************************************************************************
ok: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>

TASK <span class="o">[</span>hello world<span class="o">]</span> **************************************************************************************************************
changed: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
changed: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>
changed: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>

PLAY RECAP **********************************************************************************************************************
<span class="m">172</span>.18.46.6                : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">172</span>.18.46.7                : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">192</span>.168.46.6               : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>

<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ls</span>
helloworld.yml  httpd.yml  makehttpd.yml
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim httpd.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat httpd.yml</span>
---
- hosts: all
remote_user: root

tasks:
    - name: install httpd
    yum: <span class="nv">name</span><span class="o">=</span>httpd <span class="nv">state</span><span class="o">=</span>present
    - name: start httpd
    service: <span class="nv">name</span><span class="o">=</span>httpd <span class="nv">state</span><span class="o">=</span>started <span class="nv">enabled</span><span class="o">=</span>yes
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook httpd.yml</span>

PLAY <span class="o">[</span>all<span class="o">]</span> **********************************************************************************************************************

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> **********************************************************************************************************
ok: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>

TASK <span class="o">[</span>install httpd<span class="o">]</span> ************************************************************************************************************
ok: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
ok: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>

TASK <span class="o">[</span>start httpd<span class="o">]</span> **************************************************************************************************************
ok: <span class="o">[</span><span class="m">192</span>.168.46.6<span class="o">]</span>
changed: <span class="o">[</span><span class="m">172</span>.18.46.6<span class="o">]</span>
changed: <span class="o">[</span><span class="m">172</span>.18.46.7<span class="o">]</span>

PLAY RECAP **********************************************************************************************************************
<span class="m">172</span>.18.46.6                : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">172</span>.18.46.7                : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">1</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
<span class="m">192</span>.168.46.6               : <span class="nv">ok</span><span class="o">=</span><span class="m">3</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vault">
<h4>4.5.9. vault<a class="headerlink" href="#vault" title="Permalink to this headline">¶</a></h4>
<p>这个主要用户管理剧本的，加密解密的。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 加密</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-vault encrypt httpd.yml</span>
New Vault password:
Confirm New Vault password:
Encryption successful
<span class="c1"># 查看</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat httpd.yml</span>
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span><span class="m">1</span>.1<span class="p">;</span>AES256
<span class="m">65613239653666353638626464363565633531663734663661376138623766346363336132336435</span>
3866363231353338663439353730623162633630656539310a663466323539386563373631313836
<span class="m">65386430623637333264616564613738663766373836623536356439643938333933643737396432</span>
3831653430396261350a353832306639383138303136336464303336663432356536336638643839
<span class="m">32353664303131633234623634653731386136353665373536396561366162303535363066663933</span>
<span class="m">65616461313135613162613530336361613262643230323962626362353362333136636535323830</span>
<span class="m">37613234386433626162373535396236623231376164636561623936333832343466653562613461</span>
<span class="m">64313831303432353431396237393431383261383439353939633363323933343465623038623566</span>
<span class="m">62633534363138626138376530366233656434353330343935666531313165306434663935323431</span>
<span class="m">37613064393036346639656534376638643231343539323366616566653032343064383034363535</span>
<span class="m">38313831386232343464313130343734343634303062613766303532623637343661653661623733</span>
<span class="m">31306634656563653231353739363936363236306430663266366362323561383966393033376565</span>
<span class="m">63343966376336383534643066323462373336333137653965616337353063646132323839323933</span>
<span class="m">6263656164636164303231666162383066666530306161643833</span>
<span class="c1"># 查看</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-vault view httpd.yml</span>
Vault password:
---
- hosts: all
remote_user: root

tasks:
    - name: install httpd
    yum: <span class="nv">name</span><span class="o">=</span>httpd <span class="nv">state</span><span class="o">=</span>present
    - name: start httpd
    service: <span class="nv">name</span><span class="o">=</span>httpd <span class="nv">state</span><span class="o">=</span>started <span class="nv">enabled</span><span class="o">=</span>yes
<span class="c1"># 解密</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-vault decrypt httpd.yml</span>
Vault password:
Decryption successful
<span class="c1"># 查看</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat httpd.yml</span>
---
- hosts: all
remote_user: root

tasks:
    - name: install httpd
    yum: <span class="nv">name</span><span class="o">=</span>httpd <span class="nv">state</span><span class="o">=</span>present
    - name: start httpd
    service: <span class="nv">name</span><span class="o">=</span>httpd <span class="nv">state</span><span class="o">=</span>started <span class="nv">enabled</span><span class="o">=</span>yes
</pre></div>
</div>
</div>
<div class="section" id="console">
<h4>4.5.10. console<a class="headerlink" href="#console" title="Permalink to this headline">¶</a></h4>
<p>交互式执行ansible命令，不经常使用的，不过里面有写只能提示还是不错的。</p>
<p>使用样例：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-console</span>
Vault password:
Welcome to the ansible console.
Type <span class="nb">help</span> or ? to list commands.

root@all <span class="o">(</span><span class="m">3</span><span class="o">)[</span>f:5<span class="o">]</span>$ <span class="nb">cd</span> db
root@db <span class="o">(</span><span class="m">1</span><span class="o">)[</span>f:5<span class="o">]</span>$ ping
<span class="m">192</span>.168.46.6 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: false,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
root@db <span class="o">(</span><span class="m">1</span><span class="o">)[</span>f:5<span class="o">]</span>$ <span class="nb">exit</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>4.5.11. playbook其他使用<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id10">
<h5>4.5.11.1. 变量<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<p>变量定义的必须字母开头，有字母、数字和下划线组成。</p>
<p>方案1： 通过命令行指定 ：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat var1.yml</span>
---
- hosts: web
remote_user: root

tasks:
    - name: install package
    yum: <span class="nv">name</span><span class="o">={{</span>pkname<span class="o">}}</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook -e &quot;pkname=htop var2=xxx&quot; var1.yml</span>
</pre></div>
</div>
<p>方案2： 直接在hosts文件中指定变量 ：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 修改/etc/ansible/hosts文件</span>
<span class="o">[</span>centos7<span class="o">]</span>
<span class="m">172</span>.18.46.7 <span class="nv">pkname</span><span class="o">=</span>htop <span class="nv">var2</span><span class="o">=</span>xxx <span class="nv">var3</span><span class="o">=</span>xxx
<span class="m">192</span>.168.46.7 <span class="nv">pkname</span><span class="o">=</span>htop
<span class="c1"># 或者修改为如下</span>
<span class="o">[</span>centos7<span class="o">]</span>
<span class="m">172</span>.18.46.7 <span class="nv">pkname</span><span class="o">=</span>htop
<span class="m">192</span>.168.46.7 <span class="nv">pkname</span><span class="o">=</span>htop
<span class="o">[</span>centos7:vars<span class="o">]</span>
<span class="nv">pkname</span><span class="o">=</span>htop
<span class="nv">var2</span><span class="o">=</span>xxxx
</pre></div>
</div>
<p>方案3： 直接在yml文件中指定变量 ：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat var1.yml</span>
---
- hosts: centos7
remote_user: root
vars:
    - pkgname: htop
    var2: xxx

tasks:
    - name: install package
    yum: <span class="nv">name</span><span class="o">={{</span>pkname<span class="o">}}</span>
</pre></div>
</div>
<p>方案4： 使用setup的变量 ：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># ansible all -m setup -a &#39;filter=&quot;*nodename*&quot;&#39;</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat var1.yml</span>
---
- hosts: centos7
remote_user: root
tasks:
    - name: touch a file
    file: <span class="nv">name</span><span class="o">=</span>/root/<span class="o">{{</span>ansible_nodename<span class="o">}}</span>.txt <span class="nv">state</span><span class="o">=</span>touch

<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible all -m shell -a &#39;ls -l /root&#39;</span>
</pre></div>
</div>
<p>方案4： role中的的变量 ：</p>
<p>这个后面角色的时候使用。</p>
</div>
<div class="section" id="template">
<h5>4.5.11.2. template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h5>
<p>功能：  使用jinja2语言，支持变量替换功能和循环机制以适应各个主机的环境。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># mkdir templates/</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cp /etc/httpd/conf/httpd.conf  templates/httpd.conf.j2</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim templates/httpd.conf.j2</span>
<span class="c1"># 修改如下Listen行为如下内容</span>
Listen <span class="o">{{</span>listen_port<span class="o">}}</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim t1.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat t1.yml</span>
- hosts: centos7
remote_user: root

tasks:
    - name: copy template file <span class="k">for</span> httpd
      template: <span class="nv">src</span><span class="o">=</span>httpd.conf.j2 <span class="nv">dest</span><span class="o">=</span>/etc/httpd/conf/httpd.conf

<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook -e &quot;http_port=8080&quot; t1.yml -C</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook -e &quot;listen_port=8080&quot; t1.ym</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible 192.168.46.7 -m shell -a &#39;cat /etc/httpd/conf/httpd.conf |grep -i listen&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="when">
<h5>4.5.11.3. when<a class="headerlink" href="#when" title="Permalink to this headline">¶</a></h5>
<p>功能： 功能啥时候生效。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>- name: copy template file <span class="k">for</span> httpd
  template: <span class="nv">src</span><span class="o">=</span>httpd.conf.j2 <span class="nv">dest</span><span class="o">=</span>/etc/httpd/conf/httpd.conf
  when: <span class="nv">ansible_distribution_major_version</span><span class="o">==</span><span class="s2">&quot;7&quot;</span>
</pre></div>
</div>
<p>上面的那个ansible_distribution_major_version变量是从setup模块来的， 如果主版本是7上面的那个template就执行， 其他的不执行。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这个就是setup模块内置的变量，可以直接使用。</p>
</div>
</div>
<div class="section" id="with-item">
<h5>4.5.11.4. with-item<a class="headerlink" href="#with-item" title="Permalink to this headline">¶</a></h5>
<p>功能：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim item.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat item.yml</span>
---
- hosts: all
remote_user: root

tasks:
    - name: copy file
    file: <span class="nv">name</span><span class="o">={{</span>item<span class="o">}}</span> <span class="nv">state</span><span class="o">=</span>touch
    with_items:
        - file1
        - file2
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook item.yml</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h5>4.5.11.5. 迭代变量<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<p>功能： item是一个字典。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim diedai.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat diedai.yml</span>
---
- hosts: all
remote_user: root
tasks:
  - name: add group
    group: <span class="nv">name</span><span class="o">={{</span>item<span class="o">}}</span>
    with_items:
      - g1
      - g2
      - g3
  - name: add user
    user: <span class="nv">name</span><span class="o">={{</span>item.user<span class="o">}}</span> <span class="nv">group</span><span class="o">={{</span>item.group<span class="o">}}</span>
    with_items:
      - <span class="o">{</span>user: <span class="s1">&#39;u1&#39;</span> , group: <span class="s1">&#39;g1&#39;</span> <span class="o">}</span>
      - <span class="o">{</span>user: <span class="s1">&#39;u2&#39;</span> , group: <span class="s1">&#39;g2&#39;</span> <span class="o">}</span>
      - <span class="o">{</span>user: <span class="s1">&#39;u3&#39;</span> , group: <span class="s1">&#39;g3&#39;</span> <span class="o">}</span>

<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible-playbook diedai.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># ansible all -m shell -a &#39;id u1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="for">
<h5>4.5.11.6. for<a class="headerlink" href="#for" title="Permalink to this headline">¶</a></h5>
<p>功能： 遍历指定的list</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># pwd</span>
/root/ansible
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim for1.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat for1.yml</span>
---
- hosts: centos7
remote_user: root
vars:
    ports:
    - listen_port: <span class="m">81</span>
    - listen_port: <span class="m">82</span>
    - listen_port: <span class="m">83</span>
tasks:
    - name: <span class="nb">test</span> <span class="k">for</span>
    template: <span class="nv">src</span><span class="o">=</span>for1.conf.j2 <span class="nv">dest</span><span class="o">=</span>/app/for1.conf
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim templates/</span>
for1.conf.j2   httpd.conf.j2
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># vim templates/for1.conf.j2</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat templates/for1.conf.j2</span>
<span class="o">{</span>% <span class="k">for</span> port in ports %<span class="o">}</span>
server <span class="o">{</span>
    listen <span class="o">{{</span>port.listen_port<span class="o">}}</span><span class="p">;</span>
<span class="o">}</span>
<span class="o">{</span>% endfor   %<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="if">
<h5>4.5.11.7. if<a class="headerlink" href="#if" title="Permalink to this headline">¶</a></h5>
<p>功能： 指定条件处理</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&lt;% <span class="k">if</span> vhost.servername is defined %&gt;
&lt;%endif%&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="role">
<h4>4.5.12. role角色<a class="headerlink" href="#role" title="Permalink to this headline">¶</a></h4>
<p>功能： 把常用的封装，提供可用性</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># tree</span>
.
├── nginx.retry
├── nginx.yml
└── roles
    └── nginx
        └── tasks
            ├── enable.yml
            ├── groupadd.yml
            ├── install.yml
            ├── main.yml
            ├── start.yml
            ├── stop.yml
            └── useradd.yml

<span class="m">3</span> directories, <span class="m">9</span> files
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/enable.yml</span>
- name: <span class="nb">enable</span> nginx
service: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">state</span><span class="o">=</span>enabled
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/groupadd.yml</span>
- name: group add
group: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">system</span><span class="o">=</span>yes
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/install.yml</span>
- name: install nginx
yum: <span class="nv">name</span><span class="o">=</span>nginx
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/main.yml</span>
- import_tasks: groupadd.yml
- import_tasks: useradd.yml
- import_tasks: install.yml
- import_tasks: start.yml
- import_tasks: enable.yml
<span class="c1">#import_tasks: stop.yml</span>
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/start.yml</span>
- name: start nginx
service: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">state</span><span class="o">=</span>started
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/stop.yml</span>
- name: stop nginx
service: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">state</span><span class="o">=</span>stopped
<span class="o">[</span>root@localhost ansible<span class="o">]</span><span class="c1"># cat roles/nginx/tasks/useradd.yml</span>
- name: user add
user: <span class="nv">name</span><span class="o">=</span>nginx <span class="nv">group</span><span class="o">=</span>nginx
</pre></div>
</div>
<p>简单的说， 角色把完整的yml拆分到各自的目录中， 每个目录必须有main.yml来目录下的其他文件。</p>
<p>上面用到了tasks目录，这是是必须的，当然还有files,templates,vars等等目录， 可以在tasks目录下的main.yml文件中引用其他的目录下yml文件。</p>
</div>
</div>
<span id="document-自动化运维/saltstack"></span><div class="section" id="saltstack">
<h3>4.6. saltstack<a class="headerlink" href="#saltstack" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<span id="document-安全监控/index"></span><div class="section" id="id1">
<h2>5. 安全监控<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-安全监控/aide"></span><div class="section" id="aide">
<h3>5.1. aide<a class="headerlink" href="#aide" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<span id="document-远程登陆/index"></span><div class="section" id="id1">
<h2>6. 远程登陆<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-远程登陆/ssh"></span><div class="section" id="ssh">
<h3>6.1. ssh<a class="headerlink" href="#ssh" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-远程登陆/telnet"></span><div class="section" id="telnet">
<h3>6.2. telnet<a class="headerlink" href="#telnet" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<span id="document-DNS/index"></span><div class="section" id="dns">
<h2>7. DNS<a class="headerlink" href="#dns" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-DNS/bind"></span><div class="section" id="bind">
<h3>7.1. bind<a class="headerlink" href="#bind" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dns">
<h4>7.1.1. dns简介<a class="headerlink" href="#dns" title="Permalink to this headline">¶</a></h4>
<p>DNS（domain name service ）是域名解析服务，工作在应用层，是c/s结构，监听于53端口。</p>
<ul class="simple">
<li>tcp 53: 用于区域传输</li>
<li>ucp 53: 用于查询</li>
</ul>
</div>
<div class="section" id="id1">
<h4>7.1.2. 常见概念<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>BIND(Bekerley Internet Name Domain) 是伯克利互联网名称域。提供了DNS服务。</p>
<p>DNS查询类型：</p>
<ul class="simple">
<li>递归查询</li>
<li>迭代查询</li>
</ul>
<p>服务器类型：</p>
<ul class="simple">
<li>主dns:      管理和为何负责解析域的服务器</li>
<li>从dns：     从服务器从主服务器复制库</li>
<li>缓存dns：    转发dns</li>
</ul>
<p>区域传输：</p>
<ul class="simple">
<li>完全传输：   传输整个库</li>
<li>增量传输：    传递变化的部分内容</li>
</ul>
<p>解析流程：</p>
<p>client-&gt;hosts-&gt;local dns cache-&gt;dns server -&gt; server cache-&gt; root -&gt; 二级域</p>
<p>解析答案：</p>
<ul class="simple">
<li>肯定答案： 有对应条目</li>
<li>否定答案： 么有对应条目</li>
<li>权威答案： 请求的主机就有对应的条目</li>
<li>非权威答案： 请求的主机没有，通过迭代找到的答案</li>
</ul>
</div>
<div class="section" id="id2">
<h4>7.1.3. 资源记录<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id3">
<h5>7.1.3.1. 资源记录类型<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>A:            ipv4</li>
<li>AAAA:         ipv6</li>
<li>PTR:          ip-&gt;fqdn</li>
<li>SOA:          起始授权记录</li>
<li>NS:           域名</li>
<li>CNAME:        别名</li>
<li>MX:           邮件</li>
</ul>
</div>
<div class="section" id="id4">
<h5>7.1.3.2. 资源记录格式：<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<div class="highlight-text"><div class="highlight"><pre><span></span>name [ttl] IN rr_type value
# ttl可以从全局继承
# @引用当前区域的名字。
# 同一个名字可以通过多条记录定义多个值，dns会轮训响应
# 一条记录的对应位置没有写，会自动集成上一行的对应设置。
</pre></div>
</div>
</div>
<div class="section" id="soa">
<h5>7.1.3.3. SOA记录：<a class="headerlink" href="#soa" title="Permalink to this headline">¶</a></h5>
<p>name: 就是当前域的名字， 例如“linuxpanda.tech.”</p>
<p>value: 这个value由多个部分组成，当前的fqdn,邮箱地址，还有相关设置。</p>
<p>样例：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>linuxpanda.tech. 866400 IN SOA ns.linuxpanda.tech. nsadmin.linuxpanda.tech. (
                                                    20180117 ; 序列号
                                                    2H       ; 刷新时间
                                                    10M      ; 重试时间
                                                    1W       ; 过期时间
                                                    1D       ; 否定答案的ttl时间
                                                    )
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">SOA记录必须是第一条记录。</p>
</div>
</div>
<div class="section" id="mx">
<h5>7.1.3.4. MX记录<a class="headerlink" href="#mx" title="Permalink to this headline">¶</a></h5>
<p>样例：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>linuxpanda.tech. 86400 IN MX 10 mx1.linuxpanda.tech.
linuxpanda.tech. 86400 IN MX 20 mx2.linuxpanda.tech.
</pre></div>
</div>
<p>mx是有优先级的，数值越大优先级越低</p>
</div>
<div class="section" id="a">
<h5>7.1.3.5. A记录<a class="headerlink" href="#a" title="Permalink to this headline">¶</a></h5>
<p>样例：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>www            IN                A        1.1.1.1
www            IN                A        2.2.2.2
</pre></div>
</div>
<p>上面的www是主机名，完成的名字是www.linuxpanda.tech. 因为我们的域是linuxpanda.tech. 可以省去后面的不写，只写主机名即可。</p>
<p>如果主机过多，可以使用生成器</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$GENERATE 10-20   www$        A           192.168.46.$
</pre></div>
</div>
<p>上面的相当于www10对应10，www11对应11等等。</p>
<p>如果避免用户写错主机名导致无法访问的问题，可以考虑使用泛域名解析</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>*.linuxpanda.tech.              IN      A        192.168.46.1
</pre></div>
</div>
</div>
<div class="section" id="ptr">
<h5>7.1.3.6. PTR记录<a class="headerlink" href="#ptr" title="Permalink to this headline">¶</a></h5>
<p>需要将ip反过来写的。</p>
<p>样例：</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>1.46.168.192.in-addr.arpa.    IN       PTR     www.linuxpanda.tech.
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>7.1.3.7. 别名记录<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-text"><div class="highlight"><pre><span></span>www.linxupanda.com.       IN   CNAME          web.linuxpanda.tech.
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>7.1.4. DNS软件安装<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># yum install bind bind-utils</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># rpm -ql bind</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># rpm -ql bind-utils</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4>7.1.5. 正向解析<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id8">
<h5>7.1.5.1. 编辑默认配置文件<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="c1">#注释以下行，使用//注释</span>
//      listen-on port <span class="m">53</span> <span class="o">{</span> <span class="m">127</span>.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
//      allow-query     <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="c1"># 修改下面2项为no</span>
    dnssec-enable no<span class="p">;</span>
    dnssec-validation no<span class="p">;</span>

<span class="c1"># 在主配置文件添加对应的区域</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
<span class="c1"># 添加如下几行</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;linuxpanda.tech.zone&quot;</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>主要配置含义：</p>
<ul class="simple">
<li>listen-on：是监听配置，我们注释掉之后就是监听本机所有ip了，</li>
<li>allow-query: 这个是允许那个主机查询，注释掉就是允许所有的，如果只是想本网使用可以修改为192.168.46.0/24即可。</li>
</ul>
<p>如果不修改listen-on选项，默认只是鉴定在127.0.0.1上的。</p>
</div>
<div class="section" id="id9">
<h5>7.1.5.2. 添加区域文件<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># cp named.localhost linuxpanda.tech.zone -p      # -p选项保留权限信息，权限不对dns是没法工作的。</span>
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># ll                                              # 检查下权限</span>
total <span class="m">20</span>
drwxrwx---. <span class="m">2</span> named named    <span class="m">6</span> Aug  <span class="m">4</span> <span class="m">16</span>:13 data
drwxrwx---. <span class="m">2</span> named named    <span class="m">6</span> Aug  <span class="m">4</span> <span class="m">16</span>:13 dynamic
-rw-r-----. <span class="m">1</span> root  named  <span class="m">152</span> Jun <span class="m">21</span>  <span class="m">2007</span> linuxpanda.tech.zone
-rw-r-----. <span class="m">1</span> root  named <span class="m">2281</span> May <span class="m">22</span>  <span class="m">2017</span> named.ca
-rw-r-----. <span class="m">1</span> root  named  <span class="m">152</span> Dec <span class="m">15</span>  <span class="m">2009</span> named.empty
-rw-r-----. <span class="m">1</span> root  named  <span class="m">152</span> Jun <span class="m">21</span>  <span class="m">2007</span> named.localhost
-rw-r-----. <span class="m">1</span> root  named  <span class="m">168</span> Dec <span class="m">15</span>  <span class="m">2009</span> named.loopback
drwxrwx---. <span class="m">2</span> named named    <span class="m">6</span> Aug  <span class="m">4</span> <span class="m">16</span>:13 slaves
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># vim linuxpanda.tech.zone                        # 编辑区域文件</span>
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone                        # 检查下区域文件</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 nsadmin <span class="o">(</span>
                    <span class="m">0</span>           <span class="p">;</span> serial
                    1D          <span class="p">;</span> refresh
                    1H          <span class="p">;</span> retry
                    1W          <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
ns1 A       <span class="m">192</span>.168.46.7
www     A       <span class="m">192</span>.168.46.7
</pre></div>
</div>
<p>“&#64;”代表的是域名“linuxpanda.tech.” 这个实在rfc1912.conf文件里面设置的。</p>
<p>第二行没有指定的项，会从上面一行继承下来。</p>
</div>
<div class="section" id="id10">
<h5>7.1.5.3. 检查配置文件<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># named-checkconf                                         # 检查主配置文件</span>
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># named-checkzone linuxpanda.tech linuxpanda.tech.zone    # 检查区域文件</span>
zone linuxpanda.tech/IN: loaded serial <span class="m">0</span>
OK
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h5>7.1.5.4. 重启下dns服务<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># systemctl restart named                                 # 重启服务</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h5>7.1.5.5. 测试<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<p>host方式测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># host www.linuxpanda.tech localhost                      # 通过localhost作为dns来测试。</span>
Using domain server:
Name: localhost
Address: ::1#53
Aliases:

www.linuxpanda.tech has address <span class="m">192</span>.168.46.7
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里指定了localhost做为dns，如果不想指定，在/etc/resolve.conf文件添加ip即可。</p>
</div>
<p>dig方式测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># dig ns1.linuxpanda.tech @localhost                      # 使用dig测试</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; ns1.linuxpanda.tech @localhost
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">35168</span>
<span class="p">;;</span> flags: qr aa rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">1</span>        <span class="c1"># aa代表权威答案。</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>ns1.linuxpanda.tech.               IN      A

<span class="p">;;</span> ANSWER SECTION:
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7

<span class="p">;;</span> AUTHORITY SECTION:
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.

<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: ::1#53<span class="o">(</span>::1<span class="o">)</span>
<span class="p">;;</span> WHEN: Wed Jan <span class="m">17</span> <span class="m">20</span>:30:04 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">78</span>
</pre></div>
</div>
<p>nslookup测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># nslookup                                                # nslookup测试，这个工具和windows环境的使用是一样的。</span>
&gt; server localhost
Default server: localhost
Address: ::1#53
Default server: localhost
Address: <span class="m">127</span>.0.0.1#53
&gt; www.linuxpanda.tech
Server:             localhost
Address:    ::1#53

Name:       www.linuxpanda.tech
Address: <span class="m">192</span>.168.46.7
&gt; <span class="nb">exit</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">自己创建的zone文件，请确保named用户有读取权限。</p>
</div>
</div>
</div>
<div class="section" id="id13">
<h4>7.1.6. 反向解析<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>在主配置文件中区域</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones                            # 添加区域配置</span>
zone <span class="s2">&quot;46.168.192.in-addr.arpa&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;192.168.46.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">一定注意{}后面的;号了。最容易忘记了。</p>
</div>
<p>添加区域文件</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># cp named.loopback  192.168.46.zone -p               # 创建一个区域文件</span>
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># vim 192.168.46.zone                                 # 编辑</span>
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># cat 192.168.46.zone                                 # 检查</span>
<span class="nv">$TTL</span> 1D
@       IN SOA  ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="o">(</span>
                                        <span class="m">0</span>       <span class="p">;</span> serial
                                        1D      <span class="p">;</span> refresh
                                        1H      <span class="p">;</span> retry
                                        1W      <span class="p">;</span> expire
                                        3H <span class="o">)</span>    <span class="p">;</span> minimum
        IN NS      ns1.linuxpanda.tech.
<span class="m">7</span>       IN PTR     ns1.linuxpanda.tech.
<span class="m">7</span>       IN PTR     www.linuxpanda.tech.
</pre></div>
</div>
<p>检查配置文件</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># named-checkconf                                          # 检查配置文件</span>
<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># named-checkzone  46.168.192.in-addr.arpa 192.168.46.zone # 检查区域文件</span>
</pre></div>
</div>
<p>测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># rndc reload                                             # 重新加载dns配置文件</span>
server reload successful

<span class="o">[</span>root@localhost named<span class="o">]</span><span class="c1"># host 192.168.46.7 192.168.46.7                          # 测试</span>
Using domain server:
Name: <span class="m">192</span>.168.46.7
Address: <span class="m">192</span>.168.46.7#53
Aliases:

<span class="m">7</span>.46.168.192.in-addr.arpa domain name pointer ns1.linuxpanda.tech.
<span class="m">7</span>.46.168.192.in-addr.arpa domain name pointer www.linuxpanda.tech.

<span class="c1"># 另一个主机测试</span>
<span class="o">[</span>root@101 ~<span class="o">]</span><span class="c1"># dig -t axfr linuxpanda.tech @192.168.46.7                         # 完全区域传输，走的tcp协议，普通查询走的udp协议</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; -t axfr linuxpanda.tech @192.168.46.7
<span class="p">;;</span> global options: +cmd
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">0</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">0</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.7#53<span class="o">(</span><span class="m">192</span>.168.46.7<span class="o">)</span>
<span class="p">;;</span> WHEN: Thu Jan <span class="m">18</span> <span class="m">00</span>:44:18 EST <span class="m">2018</span>
<span class="p">;;</span> XFR size: <span class="m">5</span> records <span class="o">(</span>messages <span class="m">1</span>, bytes <span class="m">167</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h4>7.1.7. 主从服务器<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>上面我们在192.168.46.7的服务器上面配置了dns，下面以192.168.46.101作为7的从dns来完整dns的主从配置</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">在选择主从服务器的时候，注意服务器版本问题，不同版本安装的bind可能会导致不同情况，无法同步问题。</p>
</div>
<div class="section" id="id15">
<h5>7.1.7.1. 编辑配置文件<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># vim /etc/named.conf                 # 编辑主配置文件</span>
<span class="c1">#注释以下行，使用//注释</span>
//      listen-on port <span class="m">53</span> <span class="o">{</span> <span class="m">127</span>.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
//      allow-query     <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="c1"># 修改下面2项为no</span>
    dnssec-enable no<span class="p">;</span>
    dnssec-validation no<span class="p">;</span>
<span class="c1"># 添加如下配置</span>
allow-transfer <span class="o">{</span> <span class="m">192</span>.168.46.101<span class="p">;</span><span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h5>7.1.7.2. 添加区域文件<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 主服务器修改</span>

<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone           # 编辑区域文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone           # 检查区域文件，确保有从服务器的ns记录和对应的a记录</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 nsadmin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
    NS      ns2
ns1 A       <span class="m">192</span>.168.46.7
ns2     A       <span class="m">192</span>.168.46.101
www     A       <span class="m">192</span>.168.46.7

<span class="c1"># 从服务器修改</span>
<span class="o">[</span>root@101 ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones      # 从服务器添加区域，设置与主服务器的关联配置</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> slave<span class="p">;</span>
        master <span class="o">{</span> <span class="m">192</span>.168.46.7<span class="p">;</span><span class="o">}</span>
        file <span class="s2">&quot;slaves/linuxpanda.tech.slave.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">从服务器的必须要在主dns添加记录的。</p>
</div>
</div>
<div class="section" id="id17">
<h5>7.1.7.3. 重启服务<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># systemctl restart named               # 重启服务</span>
<span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># ll slaves/                            # 发现文件已经同步过来了。</span>
total <span class="m">4</span>
-rw-r--r--. <span class="m">1</span> named named <span class="m">283</span> Jan <span class="m">18</span> <span class="m">01</span>:36 linuxpanda.tech.slave.zone
<span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># file slaves/linuxpanda.tech.slave.zone</span>
slaves/linuxpanda.tech.slave.zone: data
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">centos7环境下从文件都是data的了，不再是文本了。</p>
</div>
</div>
<div class="section" id="id18">
<h5>7.1.7.4. 测试<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># dig -t axfr linuxpanda.tech  @192.168.46.101          # 测试下，发现不对啊。</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; -t axfr linuxpanda.tech @192.168.46.101
<span class="p">;;</span> global options: +cmd
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">0</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">0</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.101#53<span class="o">(</span><span class="m">192</span>.168.46.101<span class="o">)</span>
<span class="p">;;</span> WHEN: Thu Jan <span class="m">18</span> <span class="m">01</span>:44:01 EST <span class="m">2018</span>
<span class="p">;;</span> XFR size: <span class="m">5</span> records <span class="o">(</span>messages <span class="m">1</span>, bytes <span class="m">167</span><span class="o">)</span>

<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc reload                                             #    这个在主服务器上执行下。</span>
<span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># rndc reload                                           #    这个在从服务器上执行</span>
server reload successful
<span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># dig -t axfr linuxpanda.tech  @192.168.46.101          # 再次测试</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; -t axfr linuxpanda.tech @192.168.46.101
<span class="p">;;</span> global options: +cmd
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">1</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns2.linuxpanda.tech.
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
ns2.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.101
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">1</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.101#53<span class="o">(</span><span class="m">192</span>.168.46.101<span class="o">)</span>
<span class="p">;;</span> WHEN: Thu Jan <span class="m">18</span> <span class="m">01</span>:45:02 EST <span class="m">2018</span>
<span class="p">;;</span> XFR size: <span class="m">7</span> records <span class="o">(</span>messages <span class="m">1</span>, bytes <span class="m">201</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h5>7.1.7.5. 进一步测试<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<p>主服务器修改下</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># !vim</span>
vim linuxpanda.tech.zone
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone        # 添加了blog记录并修改了序号为2（原有基础上+1），这个必须比原有的数值大，才有效。</span>
<span class="nv">$TTL</span> 1D
@       IN SOA  ns1 nsadmin <span class="o">(</span>
                    <span class="m">2</span>   <span class="p">;</span> serial
                    1D  <span class="p">;</span> refresh
                    1H  <span class="p">;</span> retry
                    1W  <span class="p">;</span> expire
                    3H <span class="o">)</span>        <span class="p">;</span> minimum
    NS  ns1
    NS      ns2
ns1     A       <span class="m">192</span>.168.46.7
ns2     A       <span class="m">192</span>.168.46.101
www     A       <span class="m">192</span>.168.46.7
blog    A       <span class="m">192</span>.168.46.101
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc reload                     # 重新加载配置文件</span>
server reload successful
</pre></div>
</div>
<p>从服务器测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># dig -t axfr linuxpanda.tech  @192.168.46.101            # 查询测试，发现我们在主dns上的blog记录已经添加进来了</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; -t axfr linuxpanda.tech @192.168.46.101
<span class="p">;;</span> global options: +cmd
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">2</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns2.linuxpanda.tech.
blog.linuxpanda.tech.       <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.101
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
ns2.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.101
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7
linuxpanda.tech.    <span class="m">86400</span>   IN      SOA     ns1.linuxpanda.tech. nsadmin.linuxpanda.tech. <span class="m">2</span> <span class="m">86400</span> <span class="m">3600</span> <span class="m">604800</span> <span class="m">10800</span>
<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.101#53<span class="o">(</span><span class="m">192</span>.168.46.101<span class="o">)</span>
<span class="p">;;</span> WHEN: Thu Jan <span class="m">18</span> <span class="m">01</span>:50:21 EST <span class="m">2018</span>
<span class="p">;;</span> XFR size: <span class="m">8</span> records <span class="o">(</span>messages <span class="m">1</span>, bytes <span class="m">222</span><span class="o">)</span>



<span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># cat /var/log/messages                        # 查看下日志关于named的信息</span>
--------------------------省去一部分-----------------------------------------------------------
Jan <span class="m">18</span> <span class="m">01</span>:48:49 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: client <span class="m">192</span>.168.46.7#43665: received notify <span class="k">for</span> zone <span class="s1">&#39;linuxpanda.tech&#39;</span>
Jan <span class="m">18</span> <span class="m">01</span>:48:49 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: zone linuxpanda.tech/IN: Transfer started.
Jan <span class="m">18</span> <span class="m">01</span>:48:49 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: transfer of <span class="s1">&#39;linuxpanda.tech/IN&#39;</span> from <span class="m">192</span>.168.46.7#53: connected using <span class="m">192</span>.168.46.101#48087
Jan <span class="m">18</span> <span class="m">01</span>:48:49 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: zone linuxpanda.tech/IN: transferred serial <span class="m">2</span>
Jan <span class="m">18</span> <span class="m">01</span>:48:49 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: transfer of <span class="s1">&#39;linuxpanda.tech/IN&#39;</span> from <span class="m">192</span>.168.46.7#53: Transfer completed: <span class="m">1</span> messages, <span class="m">8</span> records, <span class="m">222</span> bytes, <span class="m">0</span>.010 secs <span class="o">(</span><span class="m">22200</span> bytes/sec<span class="o">)</span>
Jan <span class="m">18</span> <span class="m">01</span>:48:49 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: zone linuxpanda.tech/IN: sending notifies <span class="o">(</span>serial <span class="m">2</span><span class="o">)</span>
Jan <span class="m">18</span> <span class="m">01</span>:49:23 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: client <span class="m">192</span>.168.46.101#59454 <span class="o">(</span>linuxpanda.tech<span class="o">)</span>: transfer of <span class="s1">&#39;linuxpanda.tech/IN&#39;</span>: AXFR started
Jan <span class="m">18</span> <span class="m">01</span>:49:23 station named<span class="o">[</span><span class="m">7809</span><span class="o">]</span>: client <span class="m">192</span>.168.46.101#59454 <span class="o">(</span>linuxpanda.tech<span class="o">)</span>: transfer of <span class="s1">&#39;linuxpanda.tech/IN&#39;</span>: AXFR ended
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果从DNS服务器没法同步，请检查服务器配置和2个服务器的日志信息</p>
</div>
</div>
</div>
<div class="section" id="id20">
<h4>7.1.8. 允许远程动态更新<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id21">
<h5>7.1.8.1. 主服务器修改<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones       # 添加允许更新</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;linuxpanda.tech.zone&quot;</span><span class="p">;</span>
        allow-update <span class="o">{</span> <span class="m">192</span>.168.46.101<span class="p">;</span><span class="o">}</span> <span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># chmod g+w /var/named/                # 给named添加目录写权限，</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># systemctl restart named              # 重启服务</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h5>7.1.8.2. 从服务器来更新<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># nsupdate                           # 这个命令是交互的</span>
&gt; server <span class="m">192</span>.168.46.7
&gt; zone linuxpanda.tech
&gt; update add ftp.linuxpanda.tech. <span class="m">9000</span> IN A <span class="m">192</span>.168.46.101
&gt; send
&gt; quit
</pre></div>
</div>
</div>
<div class="section" id="id23">
<h5>7.1.8.3. 主服务器测试<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># ll -t                                                    # 查看文件</span>
total <span class="m">28</span>
-rw-r--r--. <span class="m">1</span> named named  <span class="m">757</span> Jan <span class="m">18</span> <span class="m">16</span>:02 linuxpanda.tech.zone.jnl
-rw-r-----. <span class="m">1</span> root  named  <span class="m">256</span> Jan <span class="m">18</span> <span class="m">14</span>:47 linuxpanda.tech.zone
-rw-r-----. <span class="m">1</span> root  named  <span class="m">258</span> Jan <span class="m">18</span> <span class="m">12</span>:32 <span class="m">192</span>.168.46.zone
drwxrwx---. <span class="m">2</span> named named   <span class="m">31</span> Jan <span class="m">17</span> <span class="m">20</span>:43 dynamic
drwxrwx---. <span class="m">2</span> named named   <span class="m">23</span> Jan <span class="m">17</span> <span class="m">20</span>:23 data
drwxrwx---. <span class="m">2</span> named named    <span class="m">6</span> Aug  <span class="m">4</span> <span class="m">16</span>:13 slaves
-rw-r-----. <span class="m">1</span> root  named <span class="m">2281</span> May <span class="m">22</span>  <span class="m">2017</span> named.ca
-rw-r-----. <span class="m">1</span> root  named  <span class="m">152</span> Dec <span class="m">15</span>  <span class="m">2009</span> named.empty
-rw-r-----. <span class="m">1</span> root  named  <span class="m">168</span> Dec <span class="m">15</span>  <span class="m">2009</span> named.loopback
-rw-r-----. <span class="m">1</span> root  named  <span class="m">152</span> Jun <span class="m">21</span>  <span class="m">2007</span> named.localhost
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone.jnl                            # 查看下这个是啥</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># dig -t axfr linuxpanda.tech. @192.168.46.7 |grep ftp    # 查看添加的记录</span>
ftp.linuxpanda.tech.        <span class="m">9000</span>    IN      A       <span class="m">192</span>.168.46.101
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">动态更新后，从服务器也会自动更新的，但是序号是没有增加的。</p>
</div>
</div>
</div>
<div class="section" id="id24">
<h4>7.1.9. 启用查询日志记录<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<p>这个启用dns查询日志记录功能， 不建议开启的（大量日志操作），只有在调试dns配置的时候开启。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc status                             # 查看dns状态信息</span>
version: <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;id:8f9657aa&gt;
CPUs found: <span class="m">1</span>
worker threads: <span class="m">1</span>
UDP listeners per interface: <span class="m">1</span>
number of zones: <span class="m">103</span>
debug level: <span class="m">0</span>
xfers running: <span class="m">0</span>
xfers deferred: <span class="m">0</span>
soa queries in progress: <span class="m">0</span>
query logging is OFF
recursive clients: <span class="m">0</span>/0/1000
tcp clients: <span class="m">0</span>/100
server is up and running
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc querylog                           # 日志切换命令，off-&gt;on,on-&gt;off</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc status |grep logging               # 查看</span>
query logging is ON
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc querylog                           # 日志切换</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rndc status |grep logging               # 查看</span>
query logging is OFF
</pre></div>
</div>
</div>
<div class="section" id="id25">
<h4>7.1.10. 子域配置<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>配置子域需要的服务器也比较多。 简单规划下。</p>
<ul class="simple">
<li>192.168.46.7 : linuxpanda.tech</li>
<li>192.168.46.101 : henan.linuxpanda.tech</li>
<li>192.168.46.102 : zhengzhou.henan.linuxpanda.tech</li>
</ul>
<p>我这里linuxpanda.tech 就认为是我自己的顶级域。 henan就是二级域，zhengzhou就是三级域。</p>
<div class="section" id="id26">
<h5>7.1.10.1. 环境配置<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h5>
<p>前面我使用了192.168.46.7和192.168.46.101两个机器，这个实验，我就重新安装下bind来覆盖原有设置了。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 192.168.46.7 机器上操作</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rm -rf /etc/named*</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># rm -rf /var/named</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># yum reinstall bind</span>

<span class="c1"># 192.168.46.101 机器上操作</span>
<span class="o">[</span>root@101 named<span class="o">]</span><span class="c1"># rm -rf /etc/named*</span>
<span class="o">[</span>root@102 named<span class="o">]</span><span class="c1"># rm -rf /var/named</span>
<span class="o">[</span>root@102 named<span class="o">]</span><span class="c1"># yum reinstall bind</span>
</pre></div>
</div>
</div>
<div class="section" id="id27">
<h5>7.1.10.2. 顶级域配置<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="o">[</span>root@localhost ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="c1">#注释以下行，使用//注释</span>
//      listen-on port <span class="m">53</span> <span class="o">{</span> <span class="m">127</span>.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
//      allow-query     <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="c1"># 修改下面2项为no</span>
dnssec-enable no<span class="p">;</span>
dnssec-validation no<span class="p">;</span>

<span class="c1"># 添加如下配置</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;linuxpanda.tech.zone&quot;</span><span class="p">;</span>
<span class="o">}</span>
<span class="p">;</span>

<span class="c1"># 添加区域文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cd /var/named/</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># ls</span>
data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cp named.localhost  linuxpanda.tech.zone -p             # 保留权限</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim linuxpanda.tech.zone                                # 添加区域</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone                                # 检查区域</span>
<span class="nv">$TTL</span> 1D
@       IN SOA  ns1 nsadmin <span class="o">(</span>
                                        <span class="m">0</span>       <span class="p">;</span> serial
                                        1D      <span class="p">;</span> refresh
                                        1H      <span class="p">;</span> retry
                                        1W      <span class="p">;</span> expire
                                        3H <span class="o">)</span>    <span class="p">;</span> minimum
        NS      ns1
henan   NS      ns2
ns1     A       <span class="m">192</span>.168.46.7
ns2   A         <span class="m">192</span>.168.46.101
www     A       <span class="m">192</span>.168.46.7

<span class="c1"># 配置测试</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># named-checkconf                                         # 检查配置</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># named-checkzone  linuxpanda.tech linuxpanda.tech.zone   # 检查区域</span>
<span class="c1"># 启动服务</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># systemctl restart named                                 # 重启服务</span>
</pre></div>
</div>
</div>
<div class="section" id="id28">
<h5>7.1.10.3. 一级域配置<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.conf                                     # 编辑主配置</span>
<span class="c1">#注释以下行，使用//注释</span>
//      listen-on port <span class="m">53</span> <span class="o">{</span> <span class="m">127</span>.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
//      allow-query     <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="c1"># 修改下面2项为no</span>
dnssec-enable no<span class="p">;</span>
dnssec-validation no<span class="p">;</span>

<span class="c1"># 添加如下配置</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
zone <span class="s2">&quot;henan.linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;henan.linuxpanda.tech.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

<span class="c1"># 添加区域文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cd /var/named/</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># ls</span>
data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cp -p named.localhost  henan.linuxpanda.tech.zone   # 保留权限</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim henan.linuxpanda.tech.zone                      # 编辑区域文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat henan.linuxpanda.tech.zone                      # 检查区域文件</span>
<span class="nv">$TTL</span> 1D
@       IN SOA  ns1 nsadmin <span class="o">(</span>
                                        <span class="m">0</span>       <span class="p">;</span> serial
                                        1D      <span class="p">;</span> refresh
                                        1H      <span class="p">;</span> retry
                                        1W      <span class="p">;</span> expire
                                        3H <span class="o">)</span>    <span class="p">;</span> minimum
                NS       ns1
zhengzhou       NS       ns2
ns1     A       <span class="m">192</span>.168.46.101
ns2  A   <span class="m">192</span>.168.46.102
www        A    <span class="m">192</span>.168.46.101

<span class="c1"># 配置测试</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># named-checkconf                                                      # 检查主配置文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># named-checkzone  henan.linuxpanda.tech henan.linuxpanda.tech.zone    # 检查区域文件</span>
<span class="c1"># 启动服务</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># systemctl restart named                                              # 重启服务</span>
</pre></div>
</div>
</div>
<div class="section" id="id29">
<h5>7.1.10.4. 二级域配置<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.conf                             # 编辑主配置文件</span>
<span class="c1">#注释以下行，使用//注释</span>
//      listen-on port <span class="m">53</span> <span class="o">{</span> <span class="m">127</span>.0.0.1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
//      allow-query     <span class="o">{</span> localhost<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="c1"># 修改下面2项为no</span>
dnssec-enable no<span class="p">;</span>
dnssec-validation no<span class="p">;</span>

<span class="c1"># 添加如下配置</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
zone <span class="s2">&quot;zhengzhou.henan.linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;zhengzhou.henan.linuxpanda.tech.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

<span class="c1"># 添加区域文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cd /var/named/</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># ls</span>
data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cp -p named.localhost  linuxpanda.tech.zone         # 保留权限</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># vim zhengzhou.henan.linuxpanda.tech.zone            # 编辑配置文件</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># cat zhengzhou.henan.linuxpanda.tech.zone            # 检查配置文件</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 nsadmin <span class="o">(</span>
                    <span class="m">0</span>           <span class="p">;</span> serial
                    1D          <span class="p">;</span> refresh
                    1H          <span class="p">;</span> retry
                    1W          <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS       ns1
    NS       zhengzhou
ns1 A       <span class="m">192</span>.168.46.101
zhengzhou  A   <span class="m">192</span>.168.46.102
www        A    <span class="m">192</span>.168.46.101
web     CNAME   www

<span class="c1"># 配置测试</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># named-checkconf                                                                       # 配置文件检查</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># named-checkzone  zhengzhou.henan.linuxpanda.tech zhengzhou.henan.linuxpanda.tech.zone # 区域文件检查</span>
<span class="c1"># 启动服务</span>
<span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># systemctl restart named                                                               # 重启</span>
</pre></div>
</div>
<p>测试下</p>
<p>在192.168.46.7上面验证下：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 named<span class="o">]</span><span class="c1"># host web.zhengzhou.henan.linuxpanda.tech 192.168.46.7                               # 测试</span>
Using domain server:
Name: <span class="m">192</span>.168.46.7
Address: <span class="m">192</span>.168.46.7#53
Aliases:

web.zhengzhou.henan.linuxpanda.tech is an <span class="nb">alias</span> <span class="k">for</span> www.zhengzhou.henan.linuxpanda.tech.
www.zhengzhou.henan.linuxpanda.tech has address <span class="m">192</span>.168.46.102
</pre></div>
</div>
</div>
</div>
<div class="section" id="id30">
<h4>7.1.11. 转发服务器<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p>转发分为2种：</p>
<ul class="simple">
<li>全局转发： 全局配置文件设置</li>
<li>特定域转发： 特定域内配置</li>
</ul>
<p>转发类型2种：</p>
<ul class="simple">
<li>first： 转发给特定服务器，如果他没有就在找自己找根。</li>
<li>only: 抓饭给特定服务器，如果他找不到自己不继续找。</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">请关闭dnssec功能。</p>
</div>
<p>我这里接着上面的实验基础上的， 上面我做了3级别的域 linuxpanda.tech ,henan.linuxpanda.tech ,zhengzhou.henan.linuxpanda.tech</p>
<p>给henan.linxupanda.tech配置特定域转发</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@101 ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones              # 编辑主配置文件</span>
<span class="c1"># 添加如何内容</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> forward<span class="p">;</span>
        forward first<span class="p">;</span>
        forwarders <span class="o">{</span> <span class="m">192</span>.168.46.7<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
<p>给zhengzhou.henan.linxupanda.tech配置特定域转发</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@102 ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones            # 编辑主配置文件</span>
<span class="c1"># 添加如何内容</span>
zone <span class="s2">&quot;henan.linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> forward<span class="p">;</span>
        forward first<span class="p">;</span>
        forwarders <span class="o">{</span> <span class="m">192</span>.168.46.101<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> forward<span class="p">;</span>
        forward first<span class="p">;</span>
        forwarders <span class="o">{</span> <span class="m">192</span>.168.46.101<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">修改配置文件后需要重启服务或者使用rndc reload重新加载配置文件。</p>
</div>
<p>测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 我们先测试我内部的服务器的dns主机</span>

<span class="o">[</span>root@102 ~<span class="o">]</span>$ host ns2.linuxpanda.tech <span class="m">192</span>.168.46.102           <span class="c1"># 测试192.168.46.7机器上面有的服务器。</span>
Using domain server:
Name: <span class="m">192</span>.168.46.102
Address: <span class="m">192</span>.168.46.102#53
Aliases:

ns2.linuxpanda.tech has address <span class="m">192</span>.168.46.101
<span class="c1"># 上面可以看到，我们的都给转发了。</span>
<span class="c1"># 下面测试一个内部dns没有的主机wwwxx,结构跑到互联网上给我们解析了，如果forward 设置only，就不会在去解析了。</span>
<span class="o">[</span>root@102 ~<span class="o">]</span>$ host wwwxx.linuxpanda.tech                        <span class="c1"># 测试一个192.168.46.7机器上面没有的服务器</span>
wwwxx.linuxpanda.tech has address <span class="m">39</span>.106.157.220
<span class="c1"># 这个ip就是我买的云服务器ip，域名解析到这个ip了。</span>
</pre></div>
</div>
</div>
<div class="section" id="view">
<h4>7.1.12. view<a class="headerlink" href="#view" title="Permalink to this headline">¶</a></h4>
<div class="section" id="acl">
<h5>7.1.12.1. 定义acl<a class="headerlink" href="#acl" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
acl netdianxin <span class="o">{</span> <span class="m">192</span>.168.1.0/24<span class="p">;</span><span class="o">}</span><span class="p">;</span>
acl netyidong <span class="o">{</span> <span class="m">192</span>.168.46.0/24<span class="p">;</span><span class="o">}</span><span class="p">;</span>
acl netother <span class="o">{</span> any<span class="p">;</span><span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id31">
<h5>7.1.12.2. 迁移根区域<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># !vim /etc/named.conf</span>
<span class="c1"># 删除下面的4行数据</span>
zone <span class="s2">&quot;.&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> hint<span class="p">;</span>
        file <span class="s2">&quot;named.ca&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
<span class="c1"># 添加上面删除的4行数据</span>
zone <span class="s2">&quot;.&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> hint<span class="p">;</span>
        file <span class="s2">&quot;named.ca&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h5>7.1.12.3. 配置view<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h5>
<div class="highlight-text"><div class="highlight"><pre><span></span>[root@centos7 ~]# cat /etc/named.conf
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//
// See the BIND Administrator&#39;s Reference Manual (ARM) for details about the
// configuration located in /usr/share/doc/bind-{version}/Bv9ARM.html
acl netdianxin { 192.168.46.0/24;};
acl netyidong { 192.168.1.0/24;};
acl netother { any;};
options {
//  listen-on port 53 { 127.0.0.1; };
    listen-on-v6 port 53 { ::1; };
    directory       &quot;/var/named&quot;;
    dump-file       &quot;/var/named/data/cache_dump.db&quot;;
    statistics-file &quot;/var/named/data/named_stats.txt&quot;;
    memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
//  allow-query     { localhost; };

    /*
    - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
    - If you are building a RECURSIVE (caching) DNS server, you need to enable
    recursion.
    - If your recursive DNS server has a public IP address, you MUST enable access
    control to limit queries to your legitimate users. Failing to do so will
    cause your server to become part of large scale DNS amplification
    attacks. Implementing BCP38 within your network would greatly
    reduce such attack surface
    */
    recursion yes;

    dnssec-enable no;
    dnssec-validation no;

    /* Path to ISC DLV key */
    bindkeys-file &quot;/etc/named.iscdlv.key&quot;;

    managed-keys-directory &quot;/var/named/dynamic&quot;;

    pid-file &quot;/run/named/named.pid&quot;;
    session-keyfile &quot;/run/named/session.key&quot;;
};

logging {
        channel default_debug {
                file &quot;data/named.run&quot;;
                severity dynamic;
        };
};

view viewdianxin {
    match-clients {netdianxin;};
    zone &quot;linuxpanda.tech&quot; {
        type master;
        file &quot;linuxpanda.tech.netdianxin.zone&quot;;
    };
    include &quot;/etc/named.rfc1912.zones&quot;;

};
view viewyidong{
    match-clients {netyidong;};
    zone &quot;linuxpanda.tech&quot; {
        type master;
        file &quot;linuxpanda.tech.netyidong.zone&quot;;
    };
    include &quot;/etc/named.rfc1912.zones&quot;;

};

include &quot;/etc/named.root.key&quot;;
</pre></div>
</div>
</div>
<div class="section" id="id33">
<h5>7.1.12.4. 添加文件<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># mv  linuxpanda.tech.zone linuxpanda.tech.netdianxin.zone</span>
<span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># cp linuxpanda.tech.netdianxin.zone linuxpanda.tech.netyidong.zone</span>
<span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># vim linuxpanda.tech.netdianxin.zone</span>
<span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># cp linuxpanda.tech.netdianxin.zone linuxpanda.tech.netyidong.zone</span>
cp: overwrite ‘linuxpanda.tech.netyidong.zone’? y
<span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># vim linuxpanda.tech.netyidong.zone</span>
<span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.netdianxin.zone</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 nsadmin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
ns1 A       <span class="m">192</span>.168.46.7
www A       <span class="m">192</span>.168.46.7
<span class="o">[</span>root@centos7 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.netyidong.zone</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 nsadmin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
ns1 A       <span class="m">192</span>.168.1.103
www A       <span class="m">192</span>.168.1.103
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h5>7.1.12.5. 验证<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h5>
<p>第一个网段测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@102 ~<span class="o">]</span>$ dig www.linuxpanda.tech @192.168.46.7

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-51.el7_4.1 &lt;&lt;&gt;&gt; www.linuxpanda.tech @192.168.46.7
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">33006</span>
<span class="p">;;</span> flags: qr aa rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">2</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>www.linuxpanda.tech.               IN      A

<span class="p">;;</span> ANSWER SECTION:
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7

<span class="p">;;</span> AUTHORITY SECTION:
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.

<span class="p">;;</span> ADDITIONAL SECTION:
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.7

<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.7#53<span class="o">(</span><span class="m">192</span>.168.46.7<span class="o">)</span>
<span class="p">;;</span> WHEN: Sat Jan <span class="m">20</span> <span class="m">17</span>:13:13 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">98</span>
</pre></div>
</div>
<p>第二个网段测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@101 ~<span class="o">]</span><span class="c1"># dig www.linuxpanda.tech @192.168.1.103</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; www.linuxpanda.tech @192.168.1.103
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">158</span>
<span class="p">;;</span> flags: qr aa rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">2</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>www.linuxpanda.tech.               IN      A

<span class="p">;;</span> ANSWER SECTION:
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.1.103

<span class="p">;;</span> AUTHORITY SECTION:
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.

<span class="p">;;</span> ADDITIONAL SECTION:
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.1.103

<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.1.103#53<span class="o">(</span><span class="m">192</span>.168.1.103<span class="o">)</span>
<span class="p">;;</span> WHEN: Sat Jan <span class="m">20</span> <span class="m">04</span>:13:29 EST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">98</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id35">
<h4>7.1.13. 互联网dns实现<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id36">
<h5>7.1.13.1. 绘制架构图<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h5>
<p>这个实现情况布局比较复杂，需要先构思一个草图，简单如下：</p>
<img alt="_images/互联网dns.png" src="_images/互联网dns.png" />
</div>
<div class="section" id="id37">
<h5>7.1.13.2. 服务器规划<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h5>
<p>为了方便后续配置简单设置下主机名如下</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>主根： root1
从根： root2，ip
tech域： tech
com域：   com
linuxpanda: linuxpanda
www1:www1
www2:www2
运营商：dianxin
client:client
</pre></div>
</div>
</div>
<div class="section" id="ip">
<h5>7.1.13.3. ip配置<a class="headerlink" href="#ip" title="Permalink to this headline">¶</a></h5>
<p>根据上面的配置设置ip信息。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1">#  nmcli con del ens33 ;</span>
<span class="c1">#  nmcli con add con-name ens33 ifname ens33 type ethernet ipv4.method manual \</span>
    ivp4.ipaddress <span class="m">192</span>.168.46.151/24 ipv4.gateway <span class="m">192</span>.168.46.1
<span class="c1">#  nmcli con up ens33</span>
主机名字配置。
<span class="c1"># hostnamectl set-hostname centos-151</span>
</pre></div>
</div>
</div>
<div class="section" id="id38">
<h5>7.1.13.4. 安装bind软件<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h5>
<p>给所有主机安装bind.</p>
<p>我这里使用ansible批量安装了。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 ansible<span class="o">]</span><span class="c1"># ansible dns -m yum -a &#39;name=bind,bind-utils&#39;</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="o">[</span>root@centos7 ~<span class="o">]</span><span class="c1"># ansible dns -m copy -a &#39;src=/etc/named.conf dest=/etc/named.conf&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h5>7.1.13.5. 主根配置<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 修改前的</span>
zone <span class="s2">&quot;.&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> hint<span class="p">;</span>
        file <span class="s2">&quot;named.ca&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
<span class="c1"># 修改后的</span>
zone <span class="s2">&quot;.&quot;</span> IN <span class="o">{</span>
        <span class="nb">type</span> master<span class="p">;</span>
        file <span class="s2">&quot;root.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

<span class="o">[</span>root@151 named<span class="o">]</span><span class="c1"># cat root.zone</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 admin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
    NS      ns2
tech    NS      nstech
com     NS      nscom
ns1     A      <span class="m">192</span>.168.46.151
ns2     A   <span class="m">192</span>.168.46.152
nstech  A      <span class="m">192</span>.168.46.153
nscom   A      <span class="m">192</span>.168.46.154

<span class="o">[</span>root@centos-151 named<span class="o">]</span><span class="c1"># scp /etc/named.conf  192.168.46.152:/etc/</span>
<span class="o">[</span>root@centos-151 named<span class="o">]</span><span class="c1"># systemctl restart named</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h5>7.1.13.6. 从根配置<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h5>
<p>上面已经copy过来一个i额named.conf文件， 修改修改下</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>zone <span class="s2">&quot;.&quot;</span> IN <span class="o">{</span>
    <span class="nb">type</span> slave<span class="p">;</span>
    masters <span class="o">{</span> <span class="m">192</span>.168.46.151<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
    file <span class="s2">&quot;slaves/root.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id41">
<h5>7.1.13.7. 主从根测试<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-151 named<span class="o">]</span><span class="c1"># !dig</span>
dig nstech  @localhost

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; nstech @localhost
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">32324</span>
<span class="p">;;</span> flags: qr aa rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">2</span>, ADDITIONAL: <span class="m">3</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>nstech.                            IN      A

<span class="p">;;</span> ANSWER SECTION:
nstech.                     <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.153

<span class="p">;;</span> AUTHORITY SECTION:
.                   <span class="m">86400</span>   IN      NS      ns2.
.                   <span class="m">86400</span>   IN      NS      ns1.

<span class="p">;;</span> ADDITIONAL SECTION:
ns1.                        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.151
ns2.                        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.152

<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: ::1#53<span class="o">(</span>::1<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">03</span>:41:58 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">115</span>
</pre></div>
</div>
</div>
<div class="section" id="id42">
<h5>7.1.13.8. 运营商配置<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h5>
<p>运营商为客户提供dns服务，默认的根是13个网络上的，配置在named.caw文件中， 我们修改为我们自己的2个根。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-158 named<span class="o">]</span><span class="c1"># vim named.ca</span>
<span class="o">[</span>root@centos-158 named<span class="o">]</span><span class="c1"># cat named.ca</span>

.                   <span class="m">518400</span>  IN      NS      a.root-servers.net.
.                   <span class="m">518400</span>  IN      NS      b.root-servers.net.
a.root-servers.net. <span class="m">3600000</span> IN      A       <span class="m">192</span>.168.46.151
b.root-servers.net. <span class="m">3600000</span> IN      A       <span class="m">192</span>.168.46.152
</pre></div>
</div>
</div>
<div class="section" id="id43">
<h5>7.1.13.9. 运营商测试<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h5>
<p>运营商的dns设置自身ip即可</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-158 named<span class="o">]</span><span class="c1"># dig ns1</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; ns1
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">8276</span>
<span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">2</span>, ADDITIONAL: <span class="m">2</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>ns1.                               IN      A

<span class="p">;;</span> ANSWER SECTION:
ns1.                        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.151

<span class="p">;;</span> AUTHORITY SECTION:
.                   <span class="m">86400</span>   IN      NS      ns2.
.                   <span class="m">86400</span>   IN      NS      ns1.

<span class="p">;;</span> ADDITIONAL SECTION:
ns2.                        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.152

<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.158#53<span class="o">(</span><span class="m">192</span>.168.46.158<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">04</span>:11:21 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">93</span>
</pre></div>
</div>
</div>
<div class="section" id="id44">
<h5>7.1.13.10. 客户端配置<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h5>
<p>客户端的dns设置为运营商的dns即可</p>
<p>客户端修改dns为运营商的ip即可</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># nmcli con modify ens33 ipv4.gateway 192.168.46.158 ipv4.dns 192.168.46.158</span>
<span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># nmcli con up ens33</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># dig nstech</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; nstech
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">64966</span>
<span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">2</span>, ADDITIONAL: <span class="m">3</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>nstech.                            IN      A

<span class="p">;;</span> ANSWER SECTION:
nstech.                     <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.153

<span class="p">;;</span> AUTHORITY SECTION:
.                   <span class="m">86343</span>   IN      NS      ns2.
.                   <span class="m">86343</span>   IN      NS      ns1.

<span class="p">;;</span> ADDITIONAL SECTION:
ns2.                        <span class="m">86343</span>   IN      A       <span class="m">192</span>.168.46.152
ns1.                        <span class="m">86343</span>   IN      A       <span class="m">192</span>.168.46.151

<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.158#53<span class="o">(</span><span class="m">192</span>.168.46.158<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">04</span>:12:18 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">115</span>
</pre></div>
</div>
</div>
<div class="section" id="id45">
<h5>7.1.13.11. 一级域的配置<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h5>
<p>一级域有2个，tech和com域的，</p>
<p>先配置tech域</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-153 ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="o">[</span>root@centos-153 ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
<span class="o">[</span>root@centos-153 ~<span class="o">]</span><span class="c1"># tail -n 5 /etc/named.rfc1912.zones</span>

zone <span class="s2">&quot;tech&quot;</span> IN <span class="o">{</span>
    <span class="nb">type</span> master<span class="p">;</span>
    file <span class="s2">&quot;tech.zone&quot;</span><span class="p">;</span>
<span class="o">}</span> <span class="p">;</span>

<span class="o">[</span>root@centos-153 ~<span class="o">]</span><span class="c1"># cd /var/named/</span>
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># ls</span>
data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># cp named.localhost  tech.zone -p</span>
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># vim tech.zone</span>
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># cat tech.zone</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 admin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS       ns1
linuxpanda NS    nslinuxpanda
ns1      A       <span class="m">192</span>.168.46.153
nslinuxpanda A    <span class="m">192</span>.168.46.155
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># systemctl restart named</span>
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># systemctl status named</span>
<span class="o">[</span>root@centos-153 named<span class="o">]</span><span class="c1"># dig ns1.tech</span>
</pre></div>
</div>
<p>在配置com域</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-154 ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="o">[</span>root@centos-154 ~<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
<span class="o">[</span>root@centos-154 ~<span class="o">]</span><span class="c1"># tail -n 5 /etc/named.rfc1912.zones</span>
<span class="o">}</span><span class="p">;</span>
zone <span class="s2">&quot;com&quot;</span> <span class="o">{</span>
    <span class="nb">type</span> master<span class="p">;</span>
    file <span class="s2">&quot;com.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
<span class="o">[</span>root@centos-154 ~<span class="o">]</span><span class="c1"># cd /var/named/</span>
<span class="o">[</span>root@centos-154 named<span class="o">]</span><span class="c1"># cp named.localhost  com.zone -p</span>
<span class="o">[</span>root@centos-154 named<span class="o">]</span><span class="c1"># vim com.zone</span>
<span class="o">[</span>root@centos-154 named<span class="o">]</span><span class="c1"># cat com.zone</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 admin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
ns1     A       <span class="m">192</span>.168.46.154
<span class="o">[</span>root@centos-154 named<span class="o">]</span><span class="c1"># dig ns1.com</span>
</pre></div>
</div>
</div>
<div class="section" id="id46">
<h5>7.1.13.12. 顶级域测试<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h5>
<p>上面已经在顶级域的自己机器上面测试了，这次直接在客户端测试下，确保没错误</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># dig ns1.tech</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; ns1.tech
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24895</span>
<span class="s">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</span>

<span class="s">;; OPT PSEUDOSECTION:</span>
<span class="s">; EDNS: version: 0, flags:; udp: 4096</span>
<span class="s">;; QUESTION SECTION:</span>
<span class="s">;ns1.tech.                  IN      A</span>

<span class="s">;; ANSWER SECTION:</span>
<span class="s">ns1.tech.           86400   IN      A       192.168.46.153</span>

<span class="s">;; AUTHORITY SECTION:</span>
<span class="s">tech.                       86400   IN      NS      ns1.tech.</span>

<span class="s">;; Query time: 1 msec</span>
<span class="s">;; SERVER: 192.168.46.158#53(192.168.46.158)</span>
<span class="s">;; WHEN: Sun Jan 21 04:27:50 CST 2018</span>
<span class="s">;; MSG SIZE  rcvd: 67</span>

<span class="s">[root@centos-159 ~]# dig ns1.com</span>

<span class="s">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; ns1.com</span>
<span class="s">;; global options: +cmd</span>
<span class="s">;; Got answer:</span>
<span class="s">;; -&gt;&gt;HEADER&lt;&lt;- opcode</span>: QUERY, status: NOERROR, id: <span class="m">63104</span>
<span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">1</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">1</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>ns1.com.                   IN      A

<span class="p">;;</span> ANSWER SECTION:
ns1.com.            <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.154

<span class="p">;;</span> AUTHORITY SECTION:
com.                        <span class="m">86078</span>   IN      NS      ns1.com.

<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.158#53<span class="o">(</span><span class="m">192</span>.168.46.158<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">04</span>:28:01 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">66</span>
</pre></div>
</div>
</div>
<div class="section" id="id47">
<h5>7.1.13.13. 二级域配置<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h5>
<p>二级域里面我只有tech下的linuxpanda域，</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-155 ~<span class="o">]</span><span class="c1"># vim /etc/named.conf</span>
<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># vim /etc/named.rfc1912.zones</span>
<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># tail -n 5 /etc/named.rfc1912.zones</span>
<span class="o">}</span><span class="p">;</span>
zone <span class="s2">&quot;linuxpanda.tech&quot;</span> <span class="o">{</span>
    <span class="nb">type</span> master<span class="p">;</span>
    file <span class="s2">&quot;linuxpanda.tech.zone&quot;</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># cd /var/named/</span>
<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># cp named.localhost  linuxpanda.tech.zone -p</span>
<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># vim linuxpanda.tech.zone</span>
<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># cat linuxpanda.tech.zone</span>
<span class="nv">$TTL</span> 1D
@   IN SOA  ns1 admin <span class="o">(</span>
                    <span class="m">0</span>       <span class="p">;</span> serial
                    1D      <span class="p">;</span> refresh
                    1H      <span class="p">;</span> retry
                    1W      <span class="p">;</span> expire
                    3H <span class="o">)</span>    <span class="p">;</span> minimum
    NS      ns1
ns1     A       <span class="m">192</span>.168.46.155
www     A       <span class="m">192</span>.168.46.156
www     A       <span class="m">192</span>.168.46.157

<span class="o">[</span>root@centos-155 named<span class="o">]</span><span class="c1"># dig www.linuxpanda.tech</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; www.linuxpanda.tech
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">20201</span>
<span class="p">;;</span> flags: qr aa rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">2</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">2</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>www.linuxpanda.tech.               IN      A

<span class="p">;;</span> ANSWER SECTION:
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.157
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.156

<span class="p">;;</span> AUTHORITY SECTION:
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.

<span class="p">;;</span> ADDITIONAL SECTION:
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.155

<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: <span class="m">127</span>.0.0.1#53<span class="o">(</span><span class="m">127</span>.0.0.1<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">04</span>:34:38 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">114</span>
</pre></div>
</div>
</div>
<div class="section" id="id48">
<h5>7.1.13.14. 三级域配置<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h5>
<p>上面在三级域配置的自己主机上测试过了，我们在在客户机上测试下</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># dig www.linuxpanda.tech</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; www.linuxpanda.tech
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">25268</span>
<span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">2</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">2</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>www.linuxpanda.tech.               IN      A

<span class="p">;;</span> ANSWER SECTION:
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.157
www.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.156

<span class="p">;;</span> AUTHORITY SECTION:
linuxpanda.tech.    <span class="m">86400</span>   IN      NS      ns1.linuxpanda.tech.

<span class="p">;;</span> ADDITIONAL SECTION:
ns1.linuxpanda.tech.        <span class="m">86400</span>   IN      A       <span class="m">192</span>.168.46.155

<span class="p">;;</span> Query time: <span class="m">2</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.158#53<span class="o">(</span><span class="m">192</span>.168.46.158<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">04</span>:36:10 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">114</span>
</pre></div>
</div>
</div>
<div class="section" id="web">
<h5>7.1.13.15. web配置<a class="headerlink" href="#web" title="Permalink to this headline">¶</a></h5>
<p>马上就要结束了，哈哈。</p>
<p>www1主机配置下web</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-156 ~<span class="o">]</span><span class="c1">#  echo &quot;this is 192.168.46.156&quot; &gt; /var/www/html/index.html</span>
<span class="o">[</span>root@centos-156 ~<span class="o">]</span><span class="c1"># systemctl restart httpd</span>
<span class="o">[</span>root@centos-156 ~<span class="o">]</span><span class="c1"># curl localhost</span>
this is <span class="m">192</span>.168.46.156
</pre></div>
</div>
<p>www2主机配置下web</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-157 ~<span class="o">]</span><span class="c1">#  echo &quot;this is 192.168.46.157&quot; &gt; /var/www/html/index.html</span>
<span class="o">[</span>root@centos-157 ~<span class="o">]</span><span class="c1"># systemctl restart httpd</span>
<span class="o">[</span>root@centos-157 ~<span class="o">]</span><span class="c1"># curl localhost</span>
this is <span class="m">192</span>.168.46.157
</pre></div>
</div>
</div>
<div class="section" id="id49">
<h5>7.1.13.16. 客户端最终测试<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h5>
<p>dns测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># dig www.linuxpanda.tech</span>

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.9.4-RedHat-9.9.4-50.el7 &lt;&lt;&gt;&gt; www.linuxpanda.tech
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">22715</span>
<span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">2</span>, AUTHORITY: <span class="m">1</span>, ADDITIONAL: <span class="m">2</span>

<span class="p">;;</span> OPT PSEUDOSECTION:
<span class="p">;</span> EDNS: version: <span class="m">0</span>, flags:<span class="p">;</span> udp: <span class="m">4096</span>
<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>www.linuxpanda.tech.               IN      A

<span class="p">;;</span> ANSWER SECTION:
www.linuxpanda.tech.        <span class="m">85972</span>   IN      A       <span class="m">192</span>.168.46.156
www.linuxpanda.tech.        <span class="m">85972</span>   IN      A       <span class="m">192</span>.168.46.157

<span class="p">;;</span> AUTHORITY SECTION:
linuxpanda.tech.    <span class="m">85972</span>   IN      NS      ns1.linuxpanda.tech.

<span class="p">;;</span> ADDITIONAL SECTION:
ns1.linuxpanda.tech.        <span class="m">85972</span>   IN      A       <span class="m">192</span>.168.46.155

<span class="p">;;</span> Query time: <span class="m">0</span> msec
<span class="p">;;</span> SERVER: <span class="m">192</span>.168.46.158#53<span class="o">(</span><span class="m">192</span>.168.46.158<span class="o">)</span>
<span class="p">;;</span> WHEN: Sun Jan <span class="m">21</span> <span class="m">04</span>:43:18 CST <span class="m">2018</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">114</span>
</pre></div>
</div>
<p>web服务测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos-159 ~<span class="o">]</span><span class="c1"># for i in `seq 1 20 ` ; do curl http://www.linuxpanda.tech ; done</span>
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.157
this is <span class="m">192</span>.168.46.156
this is <span class="m">192</span>.168.46.156
</pre></div>
</div>
</div>
</div>
<div class="section" id="id50">
<h4>7.1.14. 压力测试<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>queryperf -d test.txt -s <span class="m">127</span>.0.0.1
</pre></div>
</div>
</div>
<div class="section" id="id51">
<h4>7.1.15. 排错思路<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>查看日志信息</li>
<li>rndc querylog 启动日志临时获取查询详细信息</li>
<li>查看监听</li>
<li>查看zone权限配置</li>
<li>查看named.conf文件的allow-query和安全设置</li>
<li>使用named-checkconf和named-checkzone工具</li>
<li>dns配置是否正确。</li>
</ol>
</div>
<div class="section" id="id52">
<h4>7.1.16. 编译安装主要步骤<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>账号创建，文件下载，解压</li>
<li>查看readme，install文档</li>
<li>dig -t NS . &#64;a.root-servers.net. &gt;named.ca 。640</li>
<li>./configure &amp;&amp; make &amp;&amp; make install</li>
<li>PATH , source path</li>
<li>named.conf文件，named.rfc1912.conf文件</li>
<li>rndc-confgen -r /dev/urandom</li>
<li>named -u named -f -g  -d 3 启动服务</li>
<li>cd contrib/queryperf</li>
<li>./configure &amp;&amp; make  cp queryperf /user/local/bind9/bin/</li>
<li>queryperf -h</li>
<li>做文件，www.linuxpandata.tech A 每行这样。</li>
<li>queryperf -d test.txt -s 127.0.0.1</li>
</ol>
</div>
</div>
<span id="document-DNS/unbound"></span><div class="section" id="unbound">
<h3>7.2. unbound<a class="headerlink" href="#unbound" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-DNS/阿里云dns"></span><div class="section" id="dns">
<h3>7.3. 阿里云dns<a class="headerlink" href="#dns" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>7.3.1. 阿里云简介<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>阿里云域名服务是集域名注册、交易、解析、监控和保护为一体的综合域名管理平台。域名服务帮助您实现以下需求：</p>
<ul class="simple">
<li>域名注册：提供丰富的域名种类供您选择。</li>
<li>域名交易：基于支付宝担保交易打造的域名交易平台，为买卖双方提供安全、便捷的域名交易服务，让您可以像淘宝一样简单地买卖域名。</li>
<li>域名保障：基于隐私保护、安全锁等安全服务，全面保障您的注册信息和域名信息，免遭恶意骚扰。</li>
<li>品牌保护：用域名保护您的品牌，帮助集团及大型企业安全、高效的管理品牌和域名。</li>
<li>域名解析：依托阿里云解析，提供免费、高效、安全的 DNS 服务器，保障域名即买即用。</li>
</ul>
</div>
<div class="section" id="id2">
<h4>7.3.2. 域名注册和实名认证<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://wanwang.aliyun.com/domain/?spm=5176.200001.n2.13.hCGJOo">阿里域名注册</a></p>
<p><a class="reference external" href="https://help.aliyun.com/document_detail/54068.html?spm=5176.doc54066.6.545.oqMRkY">注册流程</a></p>
</div>
<div class="section" id="id5">
<h4>7.3.3. 域名解析<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>进入控制台找到域名</p>
<img alt="_images/解析主页.png" src="_images/解析主页.png" />
<p>添加解析</p>
<img alt="_images/添加解析.png" src="_images/添加解析.png" />
</div>
<div class="section" id="id6">
<h4>7.3.4. 测试域名配置项<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@102 ~<span class="o">]</span>$ ping www.linuxpanda.tech
PING www.linuxpanda.tech <span class="o">(</span><span class="m">39</span>.106.157.220<span class="o">)</span> <span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span> bytes of data.
<span class="m">64</span> bytes from <span class="m">39</span>.106.157.220 <span class="o">(</span><span class="m">39</span>.106.157.220<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">52</span> <span class="nv">time</span><span class="o">=</span><span class="m">22</span>.8 ms
<span class="m">64</span> bytes from <span class="m">39</span>.106.157.220 <span class="o">(</span><span class="m">39</span>.106.157.220<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">52</span> <span class="nv">time</span><span class="o">=</span><span class="m">13</span>.9 ms
<span class="m">64</span> bytes from <span class="m">39</span>.106.157.220 <span class="o">(</span><span class="m">39</span>.106.157.220<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">52</span> <span class="nv">time</span><span class="o">=</span><span class="m">23</span>.5 ms
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-数据库/index"></span><div class="section" id="id1">
<h2>8. 数据库<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-数据库/数据库基础"></span><div class="section" id="id1">
<h3>8.1. 数据库基础<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-数据库/sql语句"></span><div class="section" id="sql">
<h3>8.2. sql语句<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-数据库/mysql/mysql安装"></span><div class="section" id="mysql">
<h3>8.3. mysql安装<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h3>
<div class="section" id="yum">
<h4>8.3.1. yum安装<a class="headerlink" href="#yum" title="Permalink to this headline">¶</a></h4>
<p>yum安装是三种安装方式最简单的方式：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># yum info mariadb-server</span>
<span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># yum install mariadb</span>
</pre></div>
</div>
<p>上面方式可能下载的版本比较旧，如果想安装最新稳定版本，去这里选择 Maraidb-repo,按照下图提示操作，添加repo文件即可。</p>
<img alt="_images/yum配置.png" src="_images/yum配置.png" />
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># cd /etc/yum.repos.d/</span>
<span class="o">[</span>root@7 yum.repos.d<span class="o">]</span><span class="c1"># ls</span>
bak  cdrom.repo  epel-7.repo
<span class="o">[</span>root@7 yum.repos.d<span class="o">]</span><span class="c1"># vim mariadb.repo</span>
<span class="o">[</span>root@7 yum.repos.d<span class="o">]</span><span class="c1"># cat mariadb.repo</span>
<span class="c1"># MariaDB 10.2 CentOS repository list - created 2018-01-20 01:29 UTC</span>
<span class="c1"># http://downloads.mariadb.org/mariadb/repositories/</span>
<span class="o">[</span>mariadb<span class="o">]</span>
<span class="nv">name</span> <span class="o">=</span> MariaDB
<span class="nv">baseurl</span> <span class="o">=</span> http://yum.mariadb.org/10.2/centos7-amd64
<span class="nv">gpgkey</span><span class="o">=</span>https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="o">[</span>root@7 yum.repos.d<span class="o">]</span><span class="c1"># sudo yum install MariaDB-server MariaDB-client</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>8.3.2. 二进制安装<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id2">
<h5>8.3.2.1. 原有版本的卸载<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 ~<span class="o">]</span><span class="c1"># sudo yum remove MariaDB-server MariaDB-client</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>8.3.2.2. 下载数据<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<p><a class="reference external" href="https://downloads.mariadb.org/">下载地址</a>.</p>
<img alt="_images/下载二进制.png" src="_images/下载二进制.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">centos7的下载systemd的，centos6下载第二个。</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 src<span class="o">]</span><span class="c1"># cd /usr/src</span>
<span class="o">[</span>root@7 src<span class="o">]</span><span class="c1"># wget https://downloads.mariadb.org/interstitial/mariadb-10.2.12/bintar-linux-systemd-x86_64/mariadb-10.2.12-linux-systemd-x86_64.tar.gz/from/http%3A/.edu.cn/mariadb/     \</span>
 -O mariadb-10.2.12-linux-systemd-x86_64.tar.gz
<span class="o">[</span>root@7 src<span class="o">]</span><span class="c1"># tar xf mariadb-10.2.12-linux-systemd-x86_64.tar.gz  -C /usr/local/</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h5>8.3.2.3. 创建用户和组<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 src<span class="o">]</span><span class="c1"># groupadd -g 27 -r mysql</span>
<span class="o">[</span>root@7 src<span class="o">]</span><span class="c1"># useradd -r -u 27 -g mysql mysql -s /sbin/nologin</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>8.3.2.4. 安装<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>[root&#64;7 src]# cd /usr/local/
[root&#64;7 local]# ls
bin  etc  games  include  lib  lib64  libexec  mariadb-10.2.12-linux-systemd-x86_64  sbin  share  src
[root&#64;7 local]# ln -s mariadb-10.2.12-linux-systemd-x86_64 mysql
[root&#64;7 local]# chown -R mysql:mysql  mysql/
[root&#64;7 local]# echo ‘PATH=/usr/local/bin:$PATH’ &gt;&gt; /etc/profile.d/mysql.sh
[root&#64;7 local]# cat /etc/profile.d/mysql.sh
PATH=/usr/local/bin:$PATH
[root&#64;7 local]# source /etc/profile.d/mysql.sh</p>
</div>
<div class="section" id="id7">
<h5>8.3.2.5. 存储设备准备<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">数据库文件占用空间很大的，建议放到lvm上面去，容易扩展，避免导致根分区占用过大。</p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="m">8</span>:0    <span class="m">0</span>  200G  <span class="m">0</span> disk
├─sda1            <span class="m">8</span>:1    <span class="m">0</span>    1G  <span class="m">0</span> part /boot
└─sda2            <span class="m">8</span>:2    <span class="m">0</span>  199G  <span class="m">0</span> part
├─centos-root <span class="m">253</span>:0    <span class="m">0</span>   50G  <span class="m">0</span> lvm  /
├─centos-swap <span class="m">253</span>:1    <span class="m">0</span>    2G  <span class="m">0</span> lvm  <span class="o">[</span>SWAP<span class="o">]</span>
└─centos-home <span class="m">253</span>:2    <span class="m">0</span>  147G  <span class="m">0</span> lvm  /home
sr0              <span class="m">11</span>:0    <span class="m">1</span>  <span class="m">8</span>.1G  <span class="m">0</span> rom  /mnt/cdrom
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># for i in `find /sys/devices/ -name scan` ; do echo &quot;- - -&quot; &gt; $i ; done;</span>
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="m">8</span>:0    <span class="m">0</span>  200G  <span class="m">0</span> disk
├─sda1            <span class="m">8</span>:1    <span class="m">0</span>    1G  <span class="m">0</span> part /boot
└─sda2            <span class="m">8</span>:2    <span class="m">0</span>  199G  <span class="m">0</span> part
├─centos-root <span class="m">253</span>:0    <span class="m">0</span>   50G  <span class="m">0</span> lvm  /
├─centos-swap <span class="m">253</span>:1    <span class="m">0</span>    2G  <span class="m">0</span> lvm  <span class="o">[</span>SWAP<span class="o">]</span>
└─centos-home <span class="m">253</span>:2    <span class="m">0</span>  147G  <span class="m">0</span> lvm  /home
sdb               <span class="m">8</span>:16   <span class="m">0</span>   20G  <span class="m">0</span> disk
sr0              <span class="m">11</span>:0    <span class="m">1</span>  <span class="m">8</span>.1G  <span class="m">0</span> rom  /mnt/cdrom
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># fdisk /dev/sdb</span>
Welcome to fdisk <span class="o">(</span>util-linux <span class="m">2</span>.23.2<span class="o">)</span>.

Changes will remain in memory only, <span class="k">until</span> you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x489a4915.

Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
Partition type:
p   primary <span class="o">(</span><span class="m">0</span> primary, <span class="m">0</span> extended, <span class="m">4</span> free<span class="o">)</span>
e   extended
Select <span class="o">(</span>default p<span class="o">)</span>: p
Partition number <span class="o">(</span><span class="m">1</span>-4, default <span class="m">1</span><span class="o">)</span>:
First sector <span class="o">(</span><span class="m">2048</span>-41943039, default <span class="m">2048</span><span class="o">)</span>:
Using default value <span class="m">2048</span>
Last sector, +sectors or +size<span class="o">{</span>K,M,G<span class="o">}</span> <span class="o">(</span><span class="m">2048</span>-41943039, default <span class="m">41943039</span><span class="o">)</span>: +5G
Partition <span class="m">1</span> of <span class="nb">type</span> Linux and of size <span class="m">5</span> GiB is <span class="nb">set</span>

Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: t
Selected partition <span class="m">1</span>
Hex code <span class="o">(</span><span class="nb">type</span> L to list all codes<span class="o">)</span>: 8e
Changed <span class="nb">type</span> of partition <span class="s1">&#39;Linux&#39;</span> to <span class="s1">&#39;Linux LVM&#39;</span>

Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: p

Disk /dev/sdb: <span class="m">21</span>.5 GB, <span class="m">21474836480</span> bytes, <span class="m">41943040</span> sectors
<span class="nv">Units</span> <span class="o">=</span> sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
Disk label type: dos
Disk identifier: 0x489a4915

Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            <span class="m">2048</span>    <span class="m">10487807</span>     <span class="m">5242880</span>   8e  Linux LVM

Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: w
The partition table has been altered!

Calling ioctl<span class="o">()</span> to re-read partition table.
Syncing disks.
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="m">8</span>:0    <span class="m">0</span>  200G  <span class="m">0</span> disk
├─sda1            <span class="m">8</span>:1    <span class="m">0</span>    1G  <span class="m">0</span> part /boot
└─sda2            <span class="m">8</span>:2    <span class="m">0</span>  199G  <span class="m">0</span> part
├─centos-root <span class="m">253</span>:0    <span class="m">0</span>   50G  <span class="m">0</span> lvm  /
├─centos-swap <span class="m">253</span>:1    <span class="m">0</span>    2G  <span class="m">0</span> lvm  <span class="o">[</span>SWAP<span class="o">]</span>
└─centos-home <span class="m">253</span>:2    <span class="m">0</span>  147G  <span class="m">0</span> lvm  /home
sdb               <span class="m">8</span>:16   <span class="m">0</span>   20G  <span class="m">0</span> disk
└─sdb1            <span class="m">8</span>:17   <span class="m">0</span>    5G  <span class="m">0</span> part
sr0              <span class="m">11</span>:0    <span class="m">1</span>  <span class="m">8</span>.1G  <span class="m">0</span> rom  /mnt/cdrom
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># pvcreate /dev/sdb1</span>
Physical volume <span class="s2">&quot;/dev/sdb1&quot;</span> successfully created.
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># vgcreate  vg_data /dev/sdb1</span>
Volume group <span class="s2">&quot;vg_data&quot;</span> successfully created
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># lvcreate -n lv_mysql -l 100%FREE vg_data</span>
Logical volume <span class="s2">&quot;lv_mysql&quot;</span> created.
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># mkfs.xfs  /dev/mapper/vg_data-lv_mysql</span>
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># mkdir /data/mysql -pv</span>
mkdir: created directory ‘/data’
mkdir: created directory ‘/data/mysql’
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># mount /dev/mapper/vg_data-lv_mysql  /data/mysql/</span>
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># tail -n /etc/mtab</span>
tail: /etc/mtab: invalid number of lines
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># tail -n 1 /etc/mtab</span>
/dev/mapper/vg_data-lv_mysql /data/mysql xfs rw,seclabel,relatime,attr2,inode64,noquota <span class="m">0</span> <span class="m">0</span>
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># tail -n 1 /etc/mtab &gt;&gt; /etc/fstab</span>
<span class="o">[</span>root@7 local<span class="o">]</span><span class="c1"># cd /data/</span>
<span class="o">[</span>root@7 data<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">0</span>
drwxr-xr-x. <span class="m">2</span> root root <span class="m">6</span> Jan <span class="m">20</span> <span class="m">14</span>:00 mysql
<span class="o">[</span>root@7 data<span class="o">]</span><span class="c1"># chown mysql.mysql mysql/</span>
<span class="o">[</span>root@7 data<span class="o">]</span><span class="c1"># ll</span>
total <span class="m">0</span>
drwxr-xr-x. <span class="m">2</span> mysql mysql <span class="m">6</span> Jan <span class="m">20</span> <span class="m">14</span>:00 mysql
<span class="o">[</span>root@7 data<span class="o">]</span><span class="c1"># chmod -R 770 mysql/</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>8.3.2.6. 安装并配置<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@7 data<span class="o">]</span><span class="c1"># chmod -R 770 mysql/</span>
<span class="o">[</span>root@7 data<span class="o">]</span><span class="c1"># cd /usr/local/mysql/</span>
<span class="o">[</span>root@7 mysql<span class="o">]</span><span class="c1"># ll</span>
<span class="o">[</span>root@7 mysql<span class="o">]</span><span class="c1"># ./scripts/mysql_install_db --datadir=/data/mysql --user=mysql    # 安装库</span>
<span class="o">[</span>root@7 mysql<span class="o">]</span><span class="c1"># cp support-files/my-huge.cnf /etc/my.conf</span>
<span class="o">[</span>root@7 mysql<span class="o">]</span><span class="c1"># ll /etc/my.conf</span>
-rw-r--r--. <span class="m">1</span> root root <span class="m">4914</span> Jan <span class="m">20</span> <span class="m">14</span>:19 /etc/my.conf

<span class="o">[</span>root@7 mysql<span class="o">]</span><span class="c1"># vim /etc/my.conf</span>
<span class="c1"># 添加如下项到[mysqld]的下一行</span>
<span class="nv">datadir</span>         <span class="o">=</span> /data/mysql
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h5>8.3.2.7. 启动服务<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span> <span class="o">[</span>root@7 mysql<span class="o">]</span><span class="c1"># cp support-files/mysql.server /etc/rc.d/init.d/mysqld</span>
 <span class="o">[</span>root@centos7 mysql<span class="o">]</span><span class="c1"># vim /etc/rc.d/init.d/mysqld</span>
 <span class="c1"># 找到basedir行，修改如下内容</span>
 <span class="nv">basedir</span><span class="o">=</span>/usr/local/mysql
 <span class="nv">datadir</span><span class="o">=</span>/data/mysqldb
 <span class="o">[</span>root@centos7 mysql<span class="o">]</span><span class="c1"># chkconfig --add mysqld</span>
 <span class="o">[</span>root@centos7 mysql<span class="o">]</span><span class="c1"># chkconfig mysqld on</span>
<span class="o">[</span>root@centos7 mysql<span class="o">]</span><span class="c1"># mysql</span>
 Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
 Your MariaDB connection id is <span class="m">9</span>
 Server version: <span class="m">10</span>.2.12-MariaDB MariaDB Server

 Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2017</span>, Oracle, MariaDB Corporation Ab and others.

 Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

 MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt;
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h5>8.3.2.8. 数据库安全安装设置<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos7 mysql<span class="o">]</span><span class="c1"># mysql_secure_installation</span>

NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
    SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we<span class="s1">&#39;ll need the current</span>
<span class="s1">password for the root user.  If you&#39;</span>ve just installed MariaDB, and
you haven<span class="s1">&#39;t set the root password yet, the password will be blank,</span>
<span class="s1">so you should just press enter here.</span>

<span class="s1">Enter current password for root (enter for none):      # 没有密码就直接回车，有的话就输入</span>
<span class="s1">OK, successfully used password, moving on...</span>

<span class="s1">Setting the root password ensures that nobody can log into the MariaDB</span>
<span class="s1">root user without the proper authorisation.</span>

<span class="s1">Set root password? [Y/n] y</span>
<span class="s1">New password:</span>
<span class="s1">Re-enter new password:</span>
<span class="s1">Password updated successfully!</span>
<span class="s1">Reloading privilege tables..</span>
<span class="s1">... Success!</span>


<span class="s1">By default, a MariaDB installation has an anonymous user, allowing anyone</span>
<span class="s1">to log into MariaDB without having to have a user account created for</span>
<span class="s1">them.  This is intended only for testing, and to make the installation</span>
<span class="s1">go a bit smoother.  You should remove them before moving into a</span>
<span class="s1">production environment.</span>

<span class="s1">Remove anonymous users? [Y/n] y</span>
<span class="s1">... Success!</span>

<span class="s1">Normally, root should only be allowed to connect from &#39;</span>localhost<span class="s1">&#39;.  This</span>
<span class="s1">ensures that someone cannot guess at the root password from the network.</span>

<span class="s1">Disallow root login remotely? [Y/n] y</span>
<span class="s1">... Success!</span>

<span class="s1">By default, MariaDB comes with a database named &#39;</span>test<span class="s1">&#39; that anyone can</span>
<span class="s1">access.  This is also intended only for testing, and should be removed</span>
<span class="s1">before moving into a production environment.</span>

<span class="s1">Remove test database and access to it? [Y/n] y</span>
<span class="s1">- Dropping test database...</span>
<span class="s1">... Success!</span>
<span class="s1">- Removing privileges on test database...</span>
<span class="s1">... Success!</span>

<span class="s1">Reloading the privilege tables will ensure that all changes made so far</span>
<span class="s1">will take effect immediately.</span>

<span class="s1">Reload privilege tables now? [Y/n] y</span>
<span class="s1">... Success!</span>

<span class="s1">Cleaning up...</span>

<span class="s1">All done!  If you&#39;</span>ve completed all of the above steps, your MariaDB
installation should now be secure.

Thanks <span class="k">for</span> using MariaDB!
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h4>8.3.3. 源码安装<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># 下载文件</span>
wget https://downloads.mariadb.org/interstitial/mariadb-10.2.12/bintar-linux-systemd-x86_64/mariadb-10.2.12-linux-systemd-x86_64.tar.gz/from/http%3A//mirrors.tuna.tsinghua.edu.cn/mariadb/ <span class="se">\</span>
-O mariadb-10.2.12-linux-systemd-x86_64.tar.gz
<span class="c1"># 解压</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># tar xf mariadb-10.2.12.tar.gz</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># cd mariadb-10.2.12/</span>
<span class="o">[</span>root@centos151 mariadb-10.2.12<span class="o">]</span><span class="c1">#</span>
<span class="o">[</span>root@centos151 bin<span class="o">]</span><span class="c1"># cmake . \</span>
-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/app/mysql <span class="se">\</span>
-DMYSQL_DATADIR<span class="o">=</span>/mysqldb/ <span class="se">\</span>
-DSYSCONFDIR<span class="o">=</span>/etc <span class="se">\</span>
-DMYSQL_USER<span class="o">=</span>mysql <span class="se">\</span>
-DWITH_INNOBASE_STORAGE_ENGINE<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
-DWITH_ARCHIVE_STORAGE_ENGINE<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
-DWITH_BLACKHOLE_STORAGE_ENGINE<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
-DWITH_READLINE<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
-DWITH_SSL<span class="o">=</span>system <span class="se">\</span>
-DWITH_ZLIB<span class="o">=</span>system <span class="se">\</span>
-DWITH_LIBWRAP<span class="o">=</span><span class="m">0</span> <span class="se">\</span>
-DMYSQL_UNIX_ADDR<span class="o">=</span>/app/mysql/mysql.sock <span class="se">\</span>
-DDEFAULT_CHARSET<span class="o">=</span>utf8 <span class="se">\</span>
-DDEFAULT_COLLATION<span class="o">=</span>utf8_general_ci <span class="se">\</span>
-DENABLED_LOCAL_INFILE<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
-DWITH_PARTITION_STORAGE_ENGINE<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
-DWITH_DEBUG<span class="o">=</span><span class="m">0</span> <span class="se">\</span>
-DWITHOUT_MROONGA_STORAGE_ENGINE<span class="o">=</span><span class="m">1</span>
<span class="o">[</span>root@centos151 mariadb-10.2.12<span class="o">]</span><span class="c1"># make &amp;&amp; make install</span>
<span class="o">[</span>root@centos151 mariadb-10.2.12<span class="o">]</span><span class="c1"># echo &#39;PATH=/app/mysql/bin:$PATH&#39; &gt; /etc/profile.d/mysql.sh</span>
<span class="o">[</span>root@centos151 mariadb-10.2.12<span class="o">]</span><span class="c1"># source /etc/profile.d/mysql.sh</span>
<span class="o">[</span>root@centos151 mariadb-10.2.12<span class="o">]</span><span class="c1"># cd /app/mysql</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># scripts/mysql_install_db --basedir=/app/mysql --datadir=/app/mysql/data --user=mysql</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># cp support-files/my-huge.cnf /etc/my.cnf</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># vim /etc/my.cnf</span>
<span class="c1"># 添加如下行到mysqld片段内部</span>
<span class="nv">basedir</span><span class="o">=</span>/app/mysql
<span class="nv">datadir</span><span class="o">=</span>/app/mysql/data
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># chown mysql.mysql /app/mysql/ -R</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># chkconfig --add mysql</span>
<span class="o">[</span>root@centos151 init.d<span class="o">]</span><span class="c1"># service mysql restart</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>8.3.4. 多实例安装<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>在一个服务器上跑多个实例，每一个实例一个端口。</p>
<p>这里主要要以yum安装的方法来实现多个实例。</p>
<div class="section" id="id13">
<h5>8.3.4.1. 规划<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<div class="highlight-text"><div class="highlight"><pre><span></span>数据存储： /data/mysql/{3306,3307,3308}/data
端口： 3306，3307，3308
配置文件：放到各自的目录
服务启动文件：放到各自目录，给initd创建软连接。
程序文件： yum安装的那份就可以了。
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h5>8.3.4.2. yum安装<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># yum install mariadb-server mariadb</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># rpm -ql MariaDB-server</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># systemctl restart mariadb</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># mysql</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h5>8.3.4.3. 配置存储<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<p>安装规划创建必要的目录</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># clear</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># mkdir /data/mysql/{3306,3307,3308}/{data,log,pid,socket,etc,service} -pv</span>

<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># chown -R mysql.mysql /data/mysql/</span>

<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># tree /data/mysql</span>
/data/mysql
├── <span class="m">3306</span>
│   ├── data
│   ├── etc
│   ├── log
│   ├── pid
│   └── socket
<span class="p">|</span>   └── service
├── <span class="m">3307</span>
│   ├── data
│   ├── etc
│   ├── log
│   ├── pid
│   └── socket
<span class="p">|</span>   └── service
└── <span class="m">3308</span>
    ├── data
    ├── etc
    ├── log
    ├── pid
    └── socket
    └── service
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h5>8.3.4.4. 安装数据库<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<p>先获取basedir</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">centos151</span> <span class="o">~</span><span class="p">]</span><span class="o">#</span> <span class="n">mysql</span> <span class="o">-</span><span class="n">e</span> <span class="s1">&#39;show variables like &quot;basedir&quot;&#39;</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="o">|</span> <span class="n">Variable_name</span> <span class="o">|</span> <span class="n">Value</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="o">|</span> <span class="n">basedir</span>       <span class="o">|</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h5>8.3.4.5. 开始安装<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># mysql_install_db  --datadir=/data/mysql/3306/data --user=mysql --basedir=/usr</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># mysql_install_db  --datadir=/data/mysql/3307/data --user=mysql --basedir=/usr</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># mysql_install_db  --datadir=/data/mysql/3308/data --user=mysql --basedir=/usr</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h5>8.3.4.6. 关闭原有服务<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 <span class="m">3306</span><span class="o">]</span><span class="c1"># systemctl disable mariadb</span>
Removed symlink /etc/systemd/system/multi-user.target.wants/mariadb.service.
Removed symlink /etc/systemd/system/mysql.service.
Removed symlink /etc/systemd/system/mysqld.service.
<span class="o">[</span>root@centos151 <span class="m">3306</span><span class="o">]</span><span class="c1"># systemctl stop mariadb</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h5>8.3.4.7. 准备其他文件<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<p>配置文件准备</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># cp /etc/my.cnf /data/mysql/3306/etc/</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># vim /data/mysql/3306/etc/my.cnf</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># cat /data/mysql/3306/etc/my.cnf</span>
<span class="o">[</span>mysqld<span class="o">]</span>
<span class="nv">port</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">datadir</span><span class="o">=</span>/data/mysql/3306/data
<span class="nv">socket</span><span class="o">=</span>/data/mysql/3306/socket/mariadb.sock
symbolic-links<span class="o">=</span><span class="m">0</span>
<span class="o">[</span>mysqld-safe<span class="o">]</span>
log-error<span class="o">=</span>/data/mysql/3306/log/mariadb.log
pid-file<span class="o">=</span>/data/mysql/3306/pid/mariadb.pid

<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># cp /data/mysql/3306/etc/my.cnf /data/mysql/3307/etc/</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># cp /data/mysql/3306/etc/my.cnf /data/mysql/3308/etc/</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># sed -i &#39;s@3306@3307@&#39; /data/mysql/3307/etc/my.cnf</span>
<span class="o">[</span>root@centos151 ~<span class="o">]</span><span class="c1"># sed -i &#39;s@3306@3308@&#39; /data/mysql/3308/etc/my.cnf</span>
</pre></div>
</div>
<p>服务文件准备</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>[root@centos151 3306]# vim service/mysqld
[root@centos151 3306]# cat service/mysqld

    #!/bin/bash

    port=3306
    mysql_user=&quot;root&quot;
    mysql_pwd=&quot;&quot;
    cmd_path=&quot;/usr/bin/mysql&quot;
    mysql_basedir=&quot;/data/mysql/3306/data&quot;
    mysql_sock=&quot;${mysql_basedir}/${port}/socket/mariadb.sock&quot;

    function_start_mysql()
    {
        if [ ! -e &quot;$mysql_sock&quot; ];then
        printf &quot;Starting MySQL...\n&quot;
        ${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf  &amp;&gt; /dev/null  &amp;
        else
        printf &quot;MySQL is running...\n&quot;
        exit
        fi
    }


    function_stop_mysql()
    {
        if [ ! -e &quot;$mysql_sock&quot; ];then
        printf &quot;MySQL is stopped...\n&quot;
        exit
        else
        printf &quot;Stoping MySQL...\n&quot;
        ${cmd_path}/mysqladmin -u ${mysql_user} -p${mysql_pwd} -S ${mysql_sock} shutdown
    fi
    }


    function_restart_mysql()
    {
        printf &quot;Restarting MySQL...\n&quot;
        function_stop_mysql
        sleep 2
        function_start_mysql
    }

    case $1 in
    start)
        function_start_mysql
    ;;
    stop)
        function_stop_mysql
    ;;
    restart)
        function_restart_mysql
    ;;
    *)
        printf &quot;Usage: ${mysql_basedir}/${port}/bin/mysqld {start|stop|restart}\n&quot;
    esac

[root@centos151 3306]# cp service/mysqld ../3308/service/
[root@centos151 3306]# sed -i &#39;s@3306@3307@&#39; ../3307/service/mysqld
[root@centos151 3306]# sed -i &#39;s@3306@3308@&#39; ../3308/service/mysqld

[root@centos151 3306]# chmod  a+x service/mysqld
[root@centos151 3306]# chmod  a+x ../3307/service/mysqld
[root@centos151 3306]# chmod  a+x ../3308/service/mysqld
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h5>8.3.4.8. 启动服务测试<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 <span class="m">3306</span><span class="o">]</span><span class="c1"># ../3306/service/mysqld start</span>
<span class="o">[</span>root@centos151 <span class="m">3306</span><span class="o">]</span><span class="c1"># ../3307/service/mysqld start</span>
<span class="o">[</span>root@centos151 <span class="m">3306</span><span class="o">]</span><span class="c1"># ../3308/service/mysqld start</span>
<span class="o">[</span>root@centos151 <span class="m">3306</span><span class="o">]</span><span class="c1"># netstat -tunlp |grep 330</span>
tcp6       <span class="m">0</span>      <span class="m">0</span> :::3307                 :::*                    LISTEN      <span class="m">60029</span>/mysqld
tcp6       <span class="m">0</span>      <span class="m">0</span> :::3308                 :::*                    LISTEN      <span class="m">60138</span>/mysqld
tcp6       <span class="m">0</span>      <span class="m">0</span> :::3306                 :::*                    LISTEN      <span class="m">59696</span>/mysqld
</pre></div>
</div>
</div>
<div class="section" id="id21">
<h5>8.3.4.9. 后续完善<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<p>安全配置</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># mysql_secure_installation -S /data/mysql/3306/socket/mysql.sock</span>

NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
    SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we<span class="s1">&#39;ll need the current</span>
<span class="s1">password for the root user.  If you&#39;</span>ve just installed MariaDB, and
you haven<span class="s1">&#39;t set the root password yet, the password will be blank,</span>
<span class="s1">so you should just press enter here.</span>

<span class="s1">Enter current password for root (enter for none):</span>
<span class="s1">OK, successfully used password, moving on...</span>

<span class="s1">Setting the root password ensures that nobody can log into the MariaDB</span>
<span class="s1">root user without the proper authorisation.</span>

<span class="s1">Set root password? [Y/n] y</span>
<span class="s1">New password:</span>
<span class="s1">Re-enter new password:</span>
<span class="s1">Password updated successfully!</span>
<span class="s1">Reloading privilege tables..</span>
<span class="s1">... Success!</span>


<span class="s1">By default, a MariaDB installation has an anonymous user, allowing anyone</span>
<span class="s1">to log into MariaDB without having to have a user account created for</span>
<span class="s1">them.  This is intended only for testing, and to make the installation</span>
<span class="s1">go a bit smoother.  You should remove them before moving into a</span>
<span class="s1">production environment.</span>

<span class="s1">Remove anonymous users? [Y/n] y</span>
<span class="s1">... Success!</span>

<span class="s1">Normally, root should only be allowed to connect from &#39;</span>localhost<span class="s1">&#39;.  This</span>
<span class="s1">ensures that someone cannot guess at the root password from the network.</span>

<span class="s1">Disallow root login remotely? [Y/n] y</span>
<span class="s1">... Success!</span>

<span class="s1">By default, MariaDB comes with a database named &#39;</span>test<span class="s1">&#39; that anyone can</span>
<span class="s1">access.  This is also intended only for testing, and should be removed</span>
<span class="s1">before moving into a production environment.</span>

<span class="s1">Remove test database and access to it? [Y/n] y</span>
<span class="s1">- Dropping test database...</span>
<span class="s1">... Success!</span>
<span class="s1">- Removing privileges on test database...</span>
<span class="s1">... Success!</span>

<span class="s1">Reloading the privilege tables will ensure that all changes made so far</span>
<span class="s1">will take effect immediately.</span>

<span class="s1">Reload privilege tables now? [Y/n] y</span>
<span class="s1">... Success!</span>

<span class="s1">Cleaning up...</span>

<span class="s1">All done!  If you&#39;</span>ve completed all of the above steps, your MariaDB
installation should now be secure.

Thanks <span class="k">for</span> using MariaDB!

<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># mysql_secure_installation -S /data/mysql/3307/socket/mysql.sock</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># mysql_secure_installation -S /data/mysql/3308/socket/mysql.sock</span>
<span class="c1"># 修改下mysqld的密码配置</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># vim 3306/service/mysqld</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># vim 3307/service/mysqld</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># vim 3308/service/mysqld</span>
</pre></div>
</div>
<p>开机启动</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># echo &quot;/data/mysql/3306/service/mysqld start &quot; &gt;&gt; /etc/rc.d/rc.local</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># echo &quot;/data/mysql/3307/service/mysqld start &quot; &gt;&gt; /etc/rc.d/rc.local</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># echo &quot;/data/mysql/3308/service/mysqld start &quot; &gt;&gt; /etc/rc.d/rc.local</span>
</pre></div>
</div>
<p>修改权限</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># chmod 700 3306/service/mysqld</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># chmod 700  3307/service/mysqld</span>
<span class="o">[</span>root@centos151 mysql<span class="o">]</span><span class="c1"># chmod 700  3308/service/mysqld</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">这里可以写成sysv风格的脚本，每个起一个服务名字即可。</p>
</div>
</div>
</div>
</div>
<span id="document-数据库/mysql/mysql终端入门"></span><div class="section" id="mysql">
<h3>8.4. mysql终端入门<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>8.4.1. mysql提示符修改<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@iZ2ze640ra8ceysx5817skZ ~<span class="o">]</span><span class="c1"># man mysql # 进入man文档搜索prompt即可找到如下片段内容。</span>
┌───────┬──────────────────────────────────────────────────────────┐
│Option │ Description                                              │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\c</span>     │ A counter that increments <span class="k">for</span> each statement you issue   │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\D</span>     │ The full current date                                    │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\d</span>     │ The default database                                     │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\h</span>     │ The server host                                          │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\l</span>     │ The current delimiter <span class="o">(</span>new in <span class="m">5</span>.1.12<span class="o">)</span>                    │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\m</span>     │ Minutes of the current <span class="nb">time</span>                              │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\n</span>     │ A newline character                                      │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\O</span>     │ The current month in three-letter format <span class="o">(</span>Jan, Feb, ...<span class="o">)</span> │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\o</span>     │ The current month in numeric format                      │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\P</span>     │ am/pm                                                    │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\p</span>     │ The current TCP/IP port or socket file                   │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\R</span>     │ The current time, in <span class="m">24</span>-hour military <span class="nb">time</span> <span class="o">(</span><span class="m">0</span>–23<span class="o">)</span>        │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\r</span>     │ The current time, standard <span class="m">12</span>-hour <span class="nb">time</span> <span class="o">(</span><span class="m">1</span>–12<span class="o">)</span>           │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\S</span>     │ Semicolon                                                │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\s</span>     │ Seconds of the current <span class="nb">time</span>                              │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\t</span>     │ A tab character                                          │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\U</span>     │                                                          │
│       │        Your full user_name@host_name account name        │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\u</span>     │ Your user name                                           │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\v</span>     │ The server version                                       │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\w</span>     │ The current day of the week in three-letter format <span class="o">(</span>Mon, │
│       │ Tue, ...<span class="o">)</span>                                                │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\Y</span>     │ The current year, four digits                            │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\y</span>     │ The current year, two digits                             │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\_</span>     │ A space                                                  │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\ </span>     │ A space <span class="o">(</span>a space follows the backslash<span class="o">)</span>                  │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\´</span>     │ Single quote                                             │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\&quot;</span>     │ Double quote                                             │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\\</span>     │ A literal “<span class="se">\”</span> backslash character                        │
├───────┼──────────────────────────────────────────────────────────┤
│<span class="se">\x</span>     │                                                          │
│       │        x, <span class="k">for</span> any “x” not listed above                   │
└───────┴──────────────────────────────────────────────────────────┘

You can <span class="nb">set</span> the prompt in several ways:

·   Use an environment variable.  You can <span class="nb">set</span> the MYSQL_PS1 environment variable to a prompt string. For example:

        shell&gt; <span class="nb">export</span> <span class="nv">MYSQL_PS1</span><span class="o">=</span><span class="s2">&quot;(\u@\h) [\d]&gt; &quot;</span>

·   Use a command-line option.  You can <span class="nb">set</span> the --prompt option on the <span class="nb">command</span> line to mysql. For example:

        shell&gt; mysql --prompt<span class="o">=</span><span class="s2">&quot;(\u@\h) [\d]&gt; &quot;</span>
        <span class="o">(</span>user@host<span class="o">)</span> <span class="o">[</span>database<span class="o">]</span>&gt;

·   Use an option file.  You can <span class="nb">set</span> the prompt option in the <span class="o">[</span>mysql<span class="o">]</span> group of any MySQL option file, such as /etc/my.cnf or the .my.cnf file in your home directory.
    For example:

        <span class="o">[</span>mysql<span class="o">]</span>
        <span class="nv">prompt</span><span class="o">=(</span><span class="se">\\</span>u@<span class="se">\\</span>h<span class="o">)</span> <span class="o">[</span><span class="se">\\</span>d<span class="o">]</span>&gt;<span class="se">\\</span>_
</pre></div>
</div>
<p>我这里采用永久修改的办法，编辑配置文件方式。</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@iZ2ze640ra8ceysx5817skZ ~<span class="o">]</span><span class="c1"># mysql --prompt=&quot;\R:\m:\s (\u@\h)[\d][\c]&gt;&quot; -u root -p</span>
Enter password:
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MariaDB connection id is <span class="m">426</span>
Server version: <span class="m">5</span>.5.56-MariaDB MariaDB Server

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2017</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

<span class="m">10</span>:49:02 <span class="o">(</span>root@localhost<span class="o">)[(</span>none<span class="o">)][</span><span class="m">1</span><span class="o">]</span>&gt;use mysql<span class="p">;</span>
Reading table information <span class="k">for</span> completion of table and column names
You can turn off this feature to get a quicker startup with -A

<span class="c1"># 写到配置文件中去。</span>
<span class="o">[</span>root@iZ2ze640ra8ceysx5817skZ ~<span class="o">]</span><span class="c1"># vim /etc/my.cnf.d/mysql-clients.cnf</span>
<span class="o">[</span>root@iZ2ze640ra8ceysx5817skZ ~<span class="o">]</span><span class="c1"># cat /etc/my.cnf.d/mysql-clients.cnf</span>
<span class="c1">#</span>
<span class="c1"># These groups are read by MariaDB command-line tools</span>
<span class="c1"># Use it for options that affect only one utility</span>
<span class="c1">#</span>

<span class="o">[</span>mysql<span class="o">]</span>
<span class="nv">prompt</span><span class="o">=</span><span class="s2">&quot;\\R:\\m:\\s (\u@\h)[\d][\c]&gt;&quot;</span>
<span class="o">[</span>mysql_upgrade<span class="o">]</span>

<span class="o">[</span>mysqladmin<span class="o">]</span>

<span class="o">[</span>mysqlbinlog<span class="o">]</span>

<span class="o">[</span>mysqlcheck<span class="o">]</span>

<span class="o">[</span>mysqldump<span class="o">]</span>

<span class="o">[</span>mysqlimport<span class="o">]</span>

<span class="o">[</span>mysqlshow<span class="o">]</span>

<span class="o">[</span>mysqlslap<span class="o">]</span>

<span class="o">[</span>root@iZ2ze640ra8ceysx5817skZ ~<span class="o">]</span><span class="c1"># !vim</span>
vim /etc/my.cnf.d/mysql-clients.cnf
<span class="o">[</span>root@iZ2ze640ra8ceysx5817skZ ~<span class="o">]</span><span class="c1"># mysql -u root -p</span>
Enter password:
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MariaDB connection id is <span class="m">429</span>
Server version: <span class="m">5</span>.5.56-MariaDB MariaDB Server

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2017</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

<span class="m">10</span>:51:26 <span class="o">(</span>root@localhost<span class="o">)[(</span>none<span class="o">)][</span><span class="m">1</span><span class="o">]</span>&gt;use mysql
Reading table information <span class="k">for</span> completion of table and column names
You can turn off this feature to get a quicker startup with -A
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>8.4.2. 用户和密码写到配置文件中<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>配置前的连接方式</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 init.d<span class="o">]</span><span class="c1"># mysql -u root -p</span>
Enter password:
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MariaDB connection id is <span class="m">21</span>
Server version: <span class="m">10</span>.2.12-MariaDB-log Source distribution

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2017</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; quit
Bye
</pre></div>
</div>
<p>配置</p>
<dl class="docutils">
<dt>[<a class="reference external" href="mailto:root&#37;&#52;&#48;centos151">root<span>&#64;</span>centos151</a> init.d]# vim ~/.my.cnf</dt>
<dd># 添加如下行
[client]
user=root
password=oracle</dd>
</dl>
<p>测试</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>root@centos151 init.d<span class="o">]</span><span class="c1"># mysql</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MariaDB connection id is <span class="m">12</span>
Server version: <span class="m">10</span>.2.12-MariaDB-log Source distribution

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2017</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt;
</pre></div>
</div>
</div>
</div>
<span id="document-数据库/mysql/mysql入门"></span><div class="section" id="mysql">
<h3>8.5. mysql入门<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h3>
<p>mariadb的特性</p>
<ul class="simple">
<li>单进程，多线程</li>
<li>插件式存储引擎</li>
<li>开源</li>
<li>提供较多测试组件</li>
</ul>
<div class="section" id="id1">
<h4>8.5.1. 客户端工具<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>mysql命令的重要选项</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--print-default</span></kbd></td>
</tr>
<tr><td>&#160;</td><td>默认选项</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--verbose</span></kbd></td>
<td>显示详细信息</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-u</span></kbd></td>
<td>指定用户</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-p</span></kbd></td>
<td>指定密码</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-h</span></kbd></td>
<td>服务器主机</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">mysql中的用户是username&#64;host构成的支持通配,%代表任意长度任意字符，-匹配任意单个字符。</p>
</div>
</div>
<div class="section" id="id2">
<h4>8.5.2. 执行命令<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>查看当前用户</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="k">user</span><span class="p">();</span>
</pre></div>
</div>
<p>查看服务器版本</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="k">version</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>8.5.3. 数据库操作<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>创建数据库和删除数据库</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">database</span> <span class="n">t2</span><span class="p">;</span>
<span class="k">drop</span> <span class="k">database</span> <span class="n">t2</span><span class="p">;</span>
</pre></div>
</div>
<p>查看字符集和排序规则</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>show character set;
show collation;
show table status from mysql\G
</pre></div>
</div>
<p>查看数据库引擎</p>
<p>创建表</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">create</span> <span class="k">table</span> <span class="n">student</span><span class="p">(</span><span class="n">id</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="n">AUTO_INCREMENT</span> <span class="p">,</span> <span class="n">age</span> <span class="nb">int</span> <span class="n">unsigned</span> <span class="p">,</span><span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="n">sex</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="k">default</span> <span class="s1">&#39;m&#39;</span><span class="p">);</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span> <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>    <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>   <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>  <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>      <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>   <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">create</span> <span class="n">tables</span> <span class="n">t2</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">student</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="k">in</span> <span class="n">your</span> <span class="k">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="k">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="k">to</span> <span class="n">your</span> <span class="n">MariaDB</span> <span class="n">server</span> <span class="k">version</span> <span class="k">for</span> <span class="n">the</span> <span class="k">right</span> <span class="n">syntax</span> <span class="k">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;tables t2 select * from student&#39;</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">t2</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">student</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">Records</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Duplicates</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">t2</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+-------+</span>
<span class="o">|</span> <span class="n">Field</span> <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+-------+</span>
<span class="o">|</span> <span class="n">id</span>    <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>   <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>  <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>      <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>   <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+-------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">上面可以发现通过select来去创建一个表会丢失主键和自动增长的。</p>
</div>
<p>表查看类</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">tables</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------------+</span>
<span class="o">|</span> <span class="n">Tables_in_test</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------------+</span>
<span class="o">|</span> <span class="n">student</span>        <span class="o">|</span>
<span class="o">+</span><span class="c1">----------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span> <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>    <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>   <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>  <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>      <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>   <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">create</span> <span class="k">table</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="k">Table</span>   <span class="o">|</span> <span class="k">Create</span> <span class="k">Table</span>                                                                                                                                                                                                                              <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">student</span> <span class="o">|</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">student</span><span class="o">`</span> <span class="p">(</span>
<span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="o">`</span><span class="n">age</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="o">`</span><span class="n">sex</span><span class="o">`</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">latin1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">table</span> <span class="n">status</span> <span class="k">like</span> <span class="s1">&#39;student&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>数据类型</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>tinyint
smallint
mediumint
int
bigint
float(m,d)
double(m,d)
decimal(m,d)
char(n)
varchar(n)
tinytext
text
mediumtext
longtext
binary(m)
varbinary(m)
enum
blob
date
time
datetime
timestamp
year(2)
year(4)
</pre></div>
</div>
<p>修饰符</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>null
not null
default
primary key
unique key
character set name
auto_increment
unsigned
</pre></div>
</div>
<p>字段修改</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span> <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>    <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>   <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>  <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>      <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>   <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">student</span> <span class="k">add</span> <span class="n">address</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">after</span> <span class="n">name</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">Records</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Duplicates</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>   <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>      <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>     <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>    <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>      <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">address</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>     <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>     <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="mi">5</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">student</span> <span class="k">drop</span> <span class="n">address</span><span class="p">;</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">student</span> <span class="n">change</span> <span class="n">name</span> <span class="n">stuname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">student</span> <span class="k">modify</span> <span class="n">stuname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>   <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>      <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>     <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>     <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>     <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">alter</span> <span class="k">table</span> <span class="n">student</span> <span class="k">rename</span> <span class="n">stu</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>索引</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">index</span> <span class="n">index_age</span> <span class="k">on</span> <span class="n">stu</span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">23</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">Records</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Duplicates</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">index</span> <span class="k">from</span> <span class="n">stu</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+------------+-----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="o">|</span> <span class="k">Table</span> <span class="o">|</span> <span class="n">Non_unique</span> <span class="o">|</span> <span class="n">Key_name</span>  <span class="o">|</span> <span class="n">Seq_in_index</span> <span class="o">|</span> <span class="k">Column_name</span> <span class="o">|</span> <span class="k">Collation</span> <span class="o">|</span> <span class="k">Cardinality</span> <span class="o">|</span> <span class="n">Sub_part</span> <span class="o">|</span> <span class="n">Packed</span> <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="n">Index_type</span> <span class="o">|</span> <span class="k">Comment</span> <span class="o">|</span> <span class="n">Index_comment</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------+-----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="o">|</span> <span class="n">stu</span>   <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span> <span class="k">PRIMARY</span>   <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span> <span class="n">id</span>          <span class="o">|</span> <span class="n">A</span>         <span class="o">|</span>           <span class="mi">0</span> <span class="o">|</span>     <span class="k">NULL</span> <span class="o">|</span> <span class="k">NULL</span>   <span class="o">|</span>      <span class="o">|</span> <span class="n">BTREE</span>      <span class="o">|</span>         <span class="o">|</span>               <span class="o">|</span>
<span class="o">|</span> <span class="n">stu</span>   <span class="o">|</span>          <span class="mi">1</span> <span class="o">|</span> <span class="n">index_age</span> <span class="o">|</span>            <span class="mi">1</span> <span class="o">|</span> <span class="n">age</span>         <span class="o">|</span> <span class="n">A</span>         <span class="o">|</span>           <span class="mi">0</span> <span class="o">|</span>     <span class="k">NULL</span> <span class="o">|</span> <span class="k">NULL</span>   <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span> <span class="n">BTREE</span>      <span class="o">|</span>         <span class="o">|</span>               <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+------------+-----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">drop</span> <span class="k">index</span> <span class="n">index_age</span> <span class="k">on</span> <span class="n">stu</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">Records</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Duplicates</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>dml语句</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">stu</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>   <span class="o">|</span> <span class="k">Type</span>             <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>      <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>          <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>     <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>     <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">sex</span>     <span class="o">|</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>    <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="n">m</span>       <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">stu</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">stuname</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;zhao&#39;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">stu</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">stuname</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="s1">&#39;zhao2&#39;</span><span class="p">),(</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;zhao3&#39;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">2</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">Records</span><span class="p">:</span> <span class="mi">2</span>  <span class="n">Duplicates</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">stu</span> <span class="k">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span><span class="n">stuname</span><span class="o">=</span><span class="s1">&#39;zhao3&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">stu</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">age</span>  <span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="n">sex</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span>   <span class="mi">20</span> <span class="o">|</span> <span class="n">zhao</span>    <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span> <span class="n">zhao2</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="mi">22</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="mi">23</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">stu</span> <span class="k">set</span> <span class="n">sex</span><span class="o">=</span><span class="s1">&#39;f&#39;</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">4</span><span class="p">;</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">update</span> <span class="n">stu</span> <span class="k">set</span> <span class="n">sex</span><span class="o">=</span><span class="s1">&#39;f&#39;</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="k">Rows</span> <span class="n">matched</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">Changed</span><span class="p">:</span> <span class="mi">1</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">0</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">delete</span> <span class="k">from</span> <span class="n">stu</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">stu</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">age</span>  <span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="n">sex</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span> <span class="n">zhao2</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="mi">22</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="mi">23</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">f</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>dql语句</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">stu</span> <span class="k">where</span> <span class="n">age</span> <span class="k">between</span> <span class="mi">21</span> <span class="k">and</span> <span class="mi">22</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">age</span>  <span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="n">sex</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span> <span class="n">zhao2</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="mi">22</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">stu</span> <span class="k">where</span> <span class="n">stuname</span> <span class="k">like</span> <span class="s1">&#39;zhao%&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">age</span>  <span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="n">sex</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span> <span class="n">zhao2</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="mi">22</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="mi">23</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">f</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">stu</span> <span class="k">where</span> <span class="n">stuname</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">age</span>  <span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="n">sex</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span> <span class="n">zhao2</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="mi">22</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span>   <span class="mi">23</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">f</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">stu</span> <span class="k">where</span> <span class="n">age</span> <span class="k">in</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">);</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">age</span>  <span class="o">|</span> <span class="n">stuname</span> <span class="o">|</span> <span class="n">sex</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>   <span class="mi">21</span> <span class="o">|</span> <span class="n">zhao2</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span>   <span class="mi">22</span> <span class="o">|</span> <span class="n">zhao3</span>   <span class="o">|</span> <span class="n">m</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------+---------+------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>用户账号</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>MariaDB [test]&gt; create user &#39;zhao&#39;@&#39;%&#39; identified by &#39;oracle&#39;;
Query OK, 0 rows affected (0.00 sec)

MariaDB [test]&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)

MariaDB [test]&gt; drop user &#39;zhao&#39;@&#39;%&#39;;
MariaDB [test]&gt; create user &#39;zhao&#39;@&#39;%&#39; identified by &#39;oracle&#39;;
MariaDB [test]&gt; set password for &#39;zhao&#39;@&#39;%&#39; = password(&#39;zhao&#39;);
[root@102 ~]$ mysqladmin -u root -p  password &#39;newpassword&#39;
</pre></div>
</div>
<p>授权</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">grant</span> <span class="k">select</span> <span class="p">,</span><span class="k">delete</span> <span class="k">on</span> <span class="n">test</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="s1">&#39;zhao&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span> <span class="n">identified</span> <span class="k">by</span> <span class="s1">&#39;oracle&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">37</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">revoke</span> <span class="k">delete</span> <span class="k">on</span> <span class="n">test</span><span class="p">.</span><span class="o">*</span> <span class="k">from</span> <span class="s1">&#39;zhao&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">grants</span> <span class="k">for</span> <span class="s1">&#39;zhao&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Grants</span> <span class="k">for</span> <span class="n">zhao</span><span class="o">@%</span>                                                                                   <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="k">GRANT</span> <span class="k">USAGE</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;zhao&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="n">PASSWORD</span> <span class="s1">&#39;*2447D497B9A6A15F2776055CB2D1E9F86758182F&#39;</span> <span class="o">|</span>
<span class="o">|</span> <span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="o">`</span><span class="n">test</span><span class="o">`</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;zhao&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span>                                                              <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------------------------------------------------------------------------------------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>为了后续的实验，我们导入一个文件，文件内容如下</p>
<p><a class="reference download internal" href="_downloads/hellodb_InnoDB.sql" download=""><code class="xref download docutils literal"><span class="pre">/files/hellodb_InnoDB.sql</span></code></a></p>
<div class="highlight-sql"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">-- MySQL dump 10.13  Distrib 5.5.33, for Linux (x86_64)</span>
<span class="c1">--</span>
<span class="c1">-- Host: localhost    Database: hellodb</span>
<span class="c1">-- ------------------------------------------------------</span>
<span class="c1">-- Server version	5.5.33-log</span>

<span class="cm">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class="p">;</span>
<span class="cm">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class="p">;</span>
<span class="cm">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class="p">;</span>
<span class="cm">/*!40101 SET NAMES utf8 */</span><span class="p">;</span>
<span class="cm">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span><span class="p">;</span>
<span class="cm">/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */</span><span class="p">;</span>
<span class="cm">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span><span class="p">;</span>
<span class="cm">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class="p">;</span>
<span class="cm">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */</span><span class="p">;</span>
<span class="cm">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Current Database: `hellodb`</span>
<span class="c1">--</span>

<span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="cm">/*!32312 IF NOT EXISTS*/</span> <span class="o">`</span><span class="n">hellodb</span><span class="o">`</span> <span class="cm">/*!40100 DEFAULT CHARACTER SET utf8 */</span><span class="p">;</span>

<span class="n">USE</span> <span class="o">`</span><span class="n">hellodb</span><span class="o">`</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `classes`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">classes</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">classes</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">ClassID</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="k">Class</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">NumOfStu</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">ClassID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">9</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `classes`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">classes</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `classes` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">classes</span><span class="o">`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Shaolin Pai&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Emei Pai&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;QingCheng Pai&#39;</span><span class="p">,</span><span class="mi">11</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Wudang Pai&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Riyue Shenjiao&#39;</span><span class="p">,</span><span class="mi">31</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Lianshan Pai&#39;</span><span class="p">,</span><span class="mi">27</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;Ming Jiao&#39;</span><span class="p">,</span><span class="mi">27</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;Xiaoyao Pai&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `classes` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `coc`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">coc</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">coc</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">ID</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">ClassID</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">CourseID</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">ID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">15</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `coc`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">coc</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `coc` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">coc</span><span class="o">`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">13</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `coc` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `courses`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">courses</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">courses</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">CourseID</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Course</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">CourseID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">8</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `courses`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">courses</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `courses` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">courses</span><span class="o">`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Hamo Gong&#39;</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Kuihua Baodian&#39;</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Jinshe Jianfa&#39;</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Taiji Quan&#39;</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Daiyu Zanghua&#39;</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Weituo Zhang&#39;</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;Dagou Bangfa&#39;</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `courses` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `scores`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">scores</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">scores</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">ID</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">StuID</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">CourseID</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Score</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">ID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">16</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `scores`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">scores</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `scores` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">scores</span><span class="o">`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">77</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">93</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">47</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">97</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">88</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">75</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">71</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">89</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">39</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">63</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">96</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">86</span><span class="p">),(</span><span class="mi">13</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">83</span><span class="p">),(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">57</span><span class="p">),(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">93</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `scores` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `students`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">students</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">students</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">StuID</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Age</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Gender</span><span class="o">`</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">ClassID</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">TeacherID</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">StuID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">26</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `students`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">students</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `students` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">students</span><span class="o">`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Shi Zhongyu&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Shi Potian&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Xie Yanke&#39;</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Ding Dian&#39;</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Yu Yutong&#39;</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Shi Qing&#39;</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;Xi Ren&#39;</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;Lin Daiyu&#39;</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">9</span><span class="p">,</span><span class="s1">&#39;Ren Yingying&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Yue Lingshan&#39;</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">11</span><span class="p">,</span><span class="s1">&#39;Yuan Chengzhi&#39;</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;Wen Qingqing&#39;</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">13</span><span class="p">,</span><span class="s1">&#39;Tian Boguang&#39;</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">14</span><span class="p">,</span><span class="s1">&#39;Lu Wushuang&#39;</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;Duan Yu&#39;</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">16</span><span class="p">,</span><span class="s1">&#39;Xu Zhu&#39;</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">17</span><span class="p">,</span><span class="s1">&#39;Lin Chong&#39;</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">18</span><span class="p">,</span><span class="s1">&#39;Hua Rong&#39;</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">19</span><span class="p">,</span><span class="s1">&#39;Xue Baochai&#39;</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;Diao Chan&#39;</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">21</span><span class="p">,</span><span class="s1">&#39;Huang Yueying&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;Xiao Qiao&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;Ma Chao&#39;</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">24</span><span class="p">,</span><span class="s1">&#39;Xu Xian&#39;</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">),(</span><span class="mi">25</span><span class="p">,</span><span class="s1">&#39;Sun Dasheng&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `students` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `teachers`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">teachers</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">teachers</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">TID</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Age</span><span class="o">`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">Gender</span><span class="o">`</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">TID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">5</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `teachers`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">teachers</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `teachers` DISABLE KEYS */</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">teachers</span><span class="o">`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Song Jiang&#39;</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Zhang Sanfeng&#39;</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Miejue Shitai&#39;</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Lin Chaoying&#39;</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">);</span>
<span class="cm">/*!40000 ALTER TABLE `teachers` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `toc`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">toc</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">toc</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">ID</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">CourseID</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">TID</span><span class="o">`</span> <span class="nb">smallint</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">ID</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Dumping data for table `toc`</span>
<span class="c1">--</span>

<span class="k">LOCK</span> <span class="n">TABLES</span> <span class="o">`</span><span class="n">toc</span><span class="o">`</span> <span class="k">WRITE</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `toc` DISABLE KEYS */</span><span class="p">;</span>
<span class="cm">/*!40000 ALTER TABLE `toc` ENABLE KEYS */</span><span class="p">;</span>
<span class="n">UNLOCK</span> <span class="n">TABLES</span><span class="p">;</span>
<span class="cm">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span><span class="p">;</span>

<span class="cm">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class="p">;</span>
<span class="cm">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class="p">;</span>
<span class="cm">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span><span class="p">;</span>
<span class="cm">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class="p">;</span>
<span class="cm">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class="p">;</span>
<span class="cm">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class="p">;</span>
<span class="cm">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class="p">;</span>

<span class="c1">-- Dump completed on 2013-09-03  2:51:27</span>
</pre></div>
</td></tr></table></div>
<p>排序</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">hellodb</span>
<span class="k">Database</span> <span class="n">changed</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">order</span> <span class="k">by</span> <span class="n">age</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+---------------+-----+--------+---------+-----------+</span>
<span class="o">|</span> <span class="n">StuID</span> <span class="o">|</span> <span class="n">Name</span>          <span class="o">|</span> <span class="n">Age</span> <span class="o">|</span> <span class="n">Gender</span> <span class="o">|</span> <span class="n">ClassID</span> <span class="o">|</span> <span class="n">TeacherID</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+---------------+-----+--------+---------+-----------+</span>
<span class="o">|</span>     <span class="mi">8</span> <span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>     <span class="o">|</span>  <span class="mi">17</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">7</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">14</span> <span class="o">|</span> <span class="n">Lu</span> <span class="n">Wushuang</span>   <span class="o">|</span>  <span class="mi">17</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">19</span> <span class="o">|</span> <span class="n">Xue</span> <span class="n">Baochai</span>   <span class="o">|</span>  <span class="mi">18</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">12</span> <span class="o">|</span> <span class="n">Wen</span> <span class="n">Qingqing</span>  <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">10</span> <span class="o">|</span> <span class="n">Yue</span> <span class="n">Lingshan</span>  <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">7</span> <span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>        <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">15</span> <span class="o">|</span> <span class="n">Duan</span> <span class="n">Yu</span>       <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">20</span> <span class="o">|</span> <span class="n">Diao</span> <span class="n">Chan</span>     <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">7</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">9</span> <span class="o">|</span> <span class="n">Ren</span> <span class="n">Yingying</span>  <span class="o">|</span>  <span class="mi">20</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">22</span> <span class="o">|</span> <span class="n">Xiao</span> <span class="n">Qiao</span>     <span class="o">|</span>  <span class="mi">20</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">16</span> <span class="o">|</span> <span class="n">Xu</span> <span class="n">Zhu</span>        <span class="o">|</span>  <span class="mi">21</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span>   <span class="o">|</span>  <span class="mi">22</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">21</span> <span class="o">|</span> <span class="n">Huang</span> <span class="n">Yueying</span> <span class="o">|</span>  <span class="mi">22</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>    <span class="o">|</span>  <span class="mi">22</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>         <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">23</span> <span class="o">|</span> <span class="n">Ma</span> <span class="n">Chao</span>       <span class="o">|</span>  <span class="mi">23</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">18</span> <span class="o">|</span> <span class="n">Hua</span> <span class="n">Rong</span>      <span class="o">|</span>  <span class="mi">23</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">7</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">11</span> <span class="o">|</span> <span class="n">Yuan</span> <span class="n">Chengzhi</span> <span class="o">|</span>  <span class="mi">23</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">17</span> <span class="o">|</span> <span class="n">Lin</span> <span class="n">Chong</span>     <span class="o">|</span>  <span class="mi">25</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">5</span> <span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>     <span class="o">|</span>  <span class="mi">26</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>         <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">24</span> <span class="o">|</span> <span class="n">Xu</span> <span class="n">Xian</span>       <span class="o">|</span>  <span class="mi">27</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>    <span class="k">NULL</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">4</span> <span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>     <span class="o">|</span>  <span class="mi">32</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span> <span class="n">Tian</span> <span class="n">Boguang</span>  <span class="o">|</span>  <span class="mi">33</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">6</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Qing</span>      <span class="o">|</span>  <span class="mi">46</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>     <span class="o">|</span>  <span class="mi">53</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>        <span class="mi">16</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">25</span> <span class="o">|</span> <span class="n">Sun</span> <span class="n">Dasheng</span>   <span class="o">|</span> <span class="mi">100</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>    <span class="k">NULL</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+---------------+-----+--------+---------+-----------+</span>
<span class="mi">25</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>限制行</p>
<div class="highlight-mysql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">order</span> <span class="k">by</span> <span class="n">age</span> <span class="k">limit</span> <span class="mi">2</span><span class="p">;</span>
<span class="o">+-------+-------------+-----+--------+---------+-----------+</span>
<span class="o">|</span> <span class="n">StuID</span> <span class="o">|</span> <span class="n">Name</span>        <span class="o">|</span> <span class="n">Age</span> <span class="o">|</span> <span class="n">Gender</span> <span class="o">|</span> <span class="n">ClassID</span> <span class="o">|</span> <span class="n">TeacherID</span> <span class="o">|</span>
<span class="o">+-------+-------------+-----+--------+---------+-----------+</span>
<span class="o">|</span>    <span class="mi">14</span> <span class="o">|</span> <span class="n">Lu</span> <span class="n">Wushuang</span> <span class="o">|</span>  <span class="mi">17</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>      <span class="no">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">8</span> <span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>   <span class="o">|</span>  <span class="mi">17</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">7</span> <span class="o">|</span>      <span class="no">NULL</span> <span class="o">|</span>
<span class="o">+-------+-------------+-----+--------+---------+-----------+</span>
<span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">order</span> <span class="k">by</span> <span class="n">age</span> <span class="k">limit</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">;</span>
<span class="o">+-------+--------------+-----+--------+---------+-----------+</span>
<span class="o">|</span> <span class="n">StuID</span> <span class="o">|</span> <span class="n">Name</span>         <span class="o">|</span> <span class="n">Age</span> <span class="o">|</span> <span class="n">Gender</span> <span class="o">|</span> <span class="n">ClassID</span> <span class="o">|</span> <span class="n">TeacherID</span> <span class="o">|</span>
<span class="o">+-------+--------------+-----+--------+---------+-----------+</span>
<span class="o">|</span>    <span class="mi">19</span> <span class="o">|</span> <span class="n">Xue</span> <span class="n">Baochai</span>  <span class="o">|</span>  <span class="mi">18</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">6</span> <span class="o">|</span>      <span class="no">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">15</span> <span class="o">|</span> <span class="n">Duan</span> <span class="n">Yu</span>      <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>      <span class="no">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">12</span> <span class="o">|</span> <span class="n">Wen</span> <span class="n">Qingqing</span> <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>      <span class="no">NULL</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">7</span> <span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>       <span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">F</span>      <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>      <span class="no">NULL</span> <span class="o">|</span>
<span class="o">+-------+--------------+-----+--------+---------+-----------+</span>
<span class="mi">4</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>第二种情况是跳过2个取4个。</p>
<p>别名</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span>MariaDB [hellodb]&gt; select s.name as &quot;姓名&quot; , s.age as &quot;年龄&quot; from students as s  order by age limit 2,4;
+--------------+--------+
| 姓名         | 年龄   |
+--------------+--------+
| Xue Baochai  |     18 |
| Duan Yu      |     19 |
| Wen Qingqing |     19 |
| Xi Ren       |     19 |
+--------------+--------+
4 rows in set (0.00 sec)
</pre></div>
</div>
<p>模糊匹配</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>%通配任意字符任意次数
_通配单个字符
</pre></div>
</div>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="s1">&#39;S%&#39;</span>
    <span class="o">-&gt;</span> <span class="p">;</span>
<span class="o">+</span><span class="c1">-------+-------------+-----+--------+---------+-----------+</span>
<span class="o">|</span> <span class="n">StuID</span> <span class="o">|</span> <span class="n">Name</span>        <span class="o">|</span> <span class="n">Age</span> <span class="o">|</span> <span class="n">Gender</span> <span class="o">|</span> <span class="n">ClassID</span> <span class="o">|</span> <span class="n">TeacherID</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+-------------+-----+--------+---------+-----------+</span>
<span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span> <span class="o">|</span>  <span class="mi">22</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">2</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>  <span class="o">|</span>  <span class="mi">22</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">1</span> <span class="o">|</span>         <span class="mi">7</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">6</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Qing</span>    <span class="o">|</span>  <span class="mi">46</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">25</span> <span class="o">|</span> <span class="n">Sun</span> <span class="n">Dasheng</span> <span class="o">|</span> <span class="mi">100</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>    <span class="k">NULL</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+-------------+-----+--------+---------+-----------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>空值判断</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="n">classid</span> <span class="k">is</span> <span class="k">null</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------+-------------+-----+--------+---------+-----------+</span>
<span class="o">|</span> <span class="n">StuID</span> <span class="o">|</span> <span class="n">Name</span>        <span class="o">|</span> <span class="n">Age</span> <span class="o">|</span> <span class="n">Gender</span> <span class="o">|</span> <span class="n">ClassID</span> <span class="o">|</span> <span class="n">TeacherID</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+-------------+-----+--------+---------+-----------+</span>
<span class="o">|</span>    <span class="mi">24</span> <span class="o">|</span> <span class="n">Xu</span> <span class="n">Xian</span>     <span class="o">|</span>  <span class="mi">27</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>    <span class="k">NULL</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">25</span> <span class="o">|</span> <span class="n">Sun</span> <span class="n">Dasheng</span> <span class="o">|</span> <span class="mi">100</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>    <span class="k">NULL</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+-------------+-----+--------+---------+-----------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="n">classid</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">空值判断不能使用=。</p>
</div>
<p>分组统计</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">courseid</span><span class="p">,</span><span class="k">avg</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">scores</span> <span class="k">group</span> <span class="k">by</span> <span class="n">courseid</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="o">|</span> <span class="n">courseid</span> <span class="o">|</span> <span class="k">avg</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span> <span class="mi">73</span><span class="p">.</span><span class="mi">6667</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span> <span class="mi">75</span><span class="p">.</span><span class="mi">2500</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span> <span class="mi">93</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">4</span> <span class="o">|</span> <span class="mi">57</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">5</span> <span class="o">|</span> <span class="mi">84</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">6</span> <span class="o">|</span> <span class="mi">84</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">7</span> <span class="o">|</span> <span class="mi">73</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="mi">7</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>分组统计后过滤</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">courseid</span><span class="p">,</span><span class="k">avg</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="k">from</span> <span class="n">scores</span> <span class="k">group</span> <span class="k">by</span> <span class="n">courseid</span> <span class="k">having</span> <span class="k">avg</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="o">|</span> <span class="n">courseid</span> <span class="o">|</span> <span class="k">avg</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="o">|</span>        <span class="mi">3</span> <span class="o">|</span> <span class="mi">93</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">5</span> <span class="o">|</span> <span class="mi">84</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">|</span>        <span class="mi">6</span> <span class="o">|</span> <span class="mi">84</span><span class="p">.</span><span class="mi">0000</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>连接</p>
<div class="highlight-SQL"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">st</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sc</span><span class="p">.</span><span class="n">score</span> <span class="k">from</span> <span class="n">students</span> <span class="k">as</span> <span class="n">st</span> <span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">scores</span> <span class="k">as</span> <span class="n">sc</span> <span class="k">on</span> <span class="n">st</span><span class="p">.</span><span class="n">stuid</span><span class="o">=</span><span class="n">sc</span><span class="p">.</span><span class="n">stuid</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="o">|</span> <span class="n">name</span>          <span class="o">|</span> <span class="n">score</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span>   <span class="o">|</span>    <span class="mi">77</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span>   <span class="o">|</span>    <span class="mi">93</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>    <span class="o">|</span>    <span class="mi">47</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>    <span class="o">|</span>    <span class="mi">97</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>     <span class="o">|</span>    <span class="mi">88</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>     <span class="o">|</span>    <span class="mi">75</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>     <span class="o">|</span>    <span class="mi">71</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>     <span class="o">|</span>    <span class="mi">89</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>     <span class="o">|</span>    <span class="mi">39</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>     <span class="o">|</span>    <span class="mi">63</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Qing</span>      <span class="o">|</span>    <span class="mi">96</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>        <span class="o">|</span>    <span class="mi">86</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>        <span class="o">|</span>    <span class="mi">83</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>     <span class="o">|</span>    <span class="mi">57</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>     <span class="o">|</span>    <span class="mi">93</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ren</span> <span class="n">Yingying</span>  <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yue</span> <span class="n">Lingshan</span>  <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yuan</span> <span class="n">Chengzhi</span> <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Wen</span> <span class="n">Qingqing</span>  <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Tian</span> <span class="n">Boguang</span>  <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lu</span> <span class="n">Wushuang</span>   <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Duan</span> <span class="n">Yu</span>       <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xu</span> <span class="n">Zhu</span>        <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Chong</span>     <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Hua</span> <span class="n">Rong</span>      <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xue</span> <span class="n">Baochai</span>   <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Diao</span> <span class="n">Chan</span>     <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Huang</span> <span class="n">Yueying</span> <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xiao</span> <span class="n">Qiao</span>     <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ma</span> <span class="n">Chao</span>       <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xu</span> <span class="n">Xian</span>       <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Sun</span> <span class="n">Dasheng</span>   <span class="o">|</span>  <span class="k">NULL</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="mi">32</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">05</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">st</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sc</span><span class="p">.</span><span class="n">score</span> <span class="k">from</span> <span class="n">students</span> <span class="k">as</span> <span class="n">st</span> <span class="k">right</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">scores</span> <span class="k">as</span> <span class="n">sc</span> <span class="k">on</span> <span class="n">st</span><span class="p">.</span><span class="n">stuid</span><span class="o">=</span><span class="n">sc</span><span class="p">.</span><span class="n">stuid</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="n">score</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span> <span class="o">|</span>    <span class="mi">77</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span> <span class="o">|</span>    <span class="mi">93</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>  <span class="o">|</span>    <span class="mi">47</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>  <span class="o">|</span>    <span class="mi">97</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>   <span class="o">|</span>    <span class="mi">88</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>   <span class="o">|</span>    <span class="mi">75</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>   <span class="o">|</span>    <span class="mi">71</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>   <span class="o">|</span>    <span class="mi">89</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>   <span class="o">|</span>    <span class="mi">39</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>   <span class="o">|</span>    <span class="mi">63</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Qing</span>    <span class="o">|</span>    <span class="mi">96</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>      <span class="o">|</span>    <span class="mi">86</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>      <span class="o">|</span>    <span class="mi">83</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>   <span class="o">|</span>    <span class="mi">57</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>   <span class="o">|</span>    <span class="mi">93</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="mi">15</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">st</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">sc</span><span class="p">.</span><span class="n">score</span> <span class="k">from</span> <span class="n">students</span> <span class="k">as</span> <span class="n">st</span>  <span class="k">inner</span> <span class="k">join</span> <span class="n">scores</span> <span class="k">as</span> <span class="n">sc</span> <span class="k">on</span> <span class="n">st</span><span class="p">.</span><span class="n">stuid</span><span class="o">=</span><span class="n">sc</span><span class="p">.</span><span class="n">stuid</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="n">score</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span> <span class="o">|</span>    <span class="mi">77</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Zhongyu</span> <span class="o">|</span>    <span class="mi">93</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>  <span class="o">|</span>    <span class="mi">47</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Potian</span>  <span class="o">|</span>    <span class="mi">97</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>   <span class="o">|</span>    <span class="mi">88</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>   <span class="o">|</span>    <span class="mi">75</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>   <span class="o">|</span>    <span class="mi">71</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>   <span class="o">|</span>    <span class="mi">89</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>   <span class="o">|</span>    <span class="mi">39</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Yu</span> <span class="n">Yutong</span>   <span class="o">|</span>    <span class="mi">63</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Shi</span> <span class="n">Qing</span>    <span class="o">|</span>    <span class="mi">96</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>      <span class="o">|</span>    <span class="mi">86</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Xi</span> <span class="n">Ren</span>      <span class="o">|</span>    <span class="mi">83</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>   <span class="o">|</span>    <span class="mi">57</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Lin</span> <span class="n">Daiyu</span>   <span class="o">|</span>    <span class="mi">93</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="mi">15</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>嵌套查询</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="n">MariaDB</span> <span class="p">[</span><span class="n">hellodb</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="n">age</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Xu Xian&#39;</span><span class="p">);</span>
<span class="o">+</span><span class="c1">-------+--------------+-----+--------+---------+-----------+</span>
<span class="o">|</span> <span class="n">StuID</span> <span class="o">|</span> <span class="n">Name</span>         <span class="o">|</span> <span class="n">Age</span> <span class="o">|</span> <span class="n">Gender</span> <span class="o">|</span> <span class="n">ClassID</span> <span class="o">|</span> <span class="n">TeacherID</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+--------------+-----+--------+---------+-----------+</span>
<span class="o">|</span>     <span class="mi">3</span> <span class="o">|</span> <span class="n">Xie</span> <span class="n">Yanke</span>    <span class="o">|</span>  <span class="mi">53</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>        <span class="mi">16</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">4</span> <span class="o">|</span> <span class="n">Ding</span> <span class="n">Dian</span>    <span class="o">|</span>  <span class="mi">32</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span>
<span class="o">|</span>     <span class="mi">6</span> <span class="o">|</span> <span class="n">Shi</span> <span class="n">Qing</span>     <span class="o">|</span>  <span class="mi">46</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">5</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">13</span> <span class="o">|</span> <span class="n">Tian</span> <span class="n">Boguang</span> <span class="o">|</span>  <span class="mi">33</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>       <span class="mi">2</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">25</span> <span class="o">|</span> <span class="n">Sun</span> <span class="n">Dasheng</span>  <span class="o">|</span> <span class="mi">100</span> <span class="o">|</span> <span class="n">M</span>      <span class="o">|</span>    <span class="k">NULL</span> <span class="o">|</span>      <span class="k">NULL</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------+--------------+-----+--------+---------+-----------+</span>
<span class="mi">5</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">03</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-WEB/index"></span><div class="section" id="web">
<h2>9. WEB<a class="headerlink" href="#web" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-WEB/nginx"></span><div class="section" id="nginx">
<h3>9.1. nginx<a class="headerlink" href="#nginx" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<span id="document-版本控制/index"></span><div class="section" id="id1">
<h2>10. 版本控制<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-版本控制/git"></span><div class="section" id="git">
<h3>10.1. git<a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-版本控制/gitlab"></span><div class="section" id="gitlab">
<h3>10.2. gitlab<a class="headerlink" href="#gitlab" title="Permalink to this headline">¶</a></h3>
</div>
<span id="document-版本控制/bitbucket"></span><div class="section" id="bitbucket">
<h3>10.3. bitbucket<a class="headerlink" href="#bitbucket" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, zhaojiedi1992.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'v0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>